<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5W8DZRW');</script>
<!-- End Google Tag Manager -->

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/_assets/styles.css?&amp;v=d50d4503e9ab9459a5648e3f93b94678">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content=""/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/reference/building-mpp-with-gradle.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->

    <title>使用 Gradle 构建多平台项目 - Kotlin 语言中文站</title>

    <script src="/_assets/common.js?&amp;v=07db2933540bff717bd26a0958883834"></script>
    <link rel="stylesheet" href="/_assets/common.css?&amp;v=09757e6174985083b2ba2b1c7b8989da"/>
</head>
<body class="">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5W8DZRW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

    <div class="global-header-panel banner-nav">
        <div class="g-layout">
<!--
<div class="global-nav banner-container">
    <a class="banner-text" href="https://www.jetbrains.com/promo/kotlin-heroes/" target="_blank">
        <div class="banner-item title">
            Kotlin Heroes 编程挑战赛
        </div>
        <div class="banner-item underline">
            参与！
        </div>
    </a>
    <div class="close-head-banner"></div>
</div>
-->        </div>
    </div>
<header class="global-header">
    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a> <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.3.70" target="_blank" class="global-header-logo__version">1.3.70</a>
<nav class="global-nav">
    <div class="nav-links">
            <a href="https://www.kotliner.cn/" class="nav-item  nav-item-external" target="_blank" >
                博客
            </a>
            <a href="https://discuss.kotliner.cn/" class="nav-item  nav-item-external" target="_blank" >
                论坛
            </a>
            <a href="/docs/reference/" class="nav-item ">
                学习
            </a>
            <a href="/community/" class="nav-item ">
                社区
            </a>
            <a href="https://play.kotlinlang.org" class="nav-item  nav-item-external" target="_blank" >
                演练
            </a>
    </div>
    <div class="search-button">
        <div class="icon"></div>
    </div>
</nav>        </div>
    </div>
</header>        <div class="g-layout global-content">
        <nav class="docs-nav">
                <div class="nav-item-wrap">
                        <a href="/docs/reference/" class="nav-item is_active">
                            <span class="nav-item-text">
                                语言指南
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/tutorials/" class="nav-item">
                            <span class="nav-item-text">
                                教程
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/books.html" class="nav-item">
                            <span class="nav-item-text">
                                图书
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/resources.html" class="nav-item">
                            <span class="nav-item-text">
                                更多资源
                            </span>
                        </a>
                </div>
        </nav>

    <div class="g-grid">

        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav class="side-tree-nav">
                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="概述">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">概述</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/server-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于服务器端开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/android-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 Android 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 JavaScript 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于原生开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/data-science-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于数据科学</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multiplatform.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="新特性">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">新特性</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.3 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew12.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.2 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew11.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.1 的新特性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="开始">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">开始</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-syntax.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本语法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/idioms.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">习惯用法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coding-conventions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="基础">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">基础</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-types.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/packages.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">包与导入</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/control-flow.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">控制流</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/returns.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">返回与跳转</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="类与对象">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">类与对象</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类与继承</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">属性与字段</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/interfaces.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">接口</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/visibility-modifiers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">可见性修饰符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/extensions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">扩展</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/data-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">数据类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sealed-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">密封类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/generics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">泛型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/nested-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">嵌套类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/enum-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">枚举类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/object-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">对象</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-aliases.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型别名</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegation.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegated-properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托属性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="函数与 Lambda 表达式">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">函数与 Lambda 表达式</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/lambdas.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Lambda 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联函数</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="集合">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">集合</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collections-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/constructing-collections.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">构造集合</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/iterators.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">迭代器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/ranges.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">区间与数列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sequences.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">序列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-transformations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-filtering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">过滤</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-plus-minus.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">加减操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-grouping.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">分组</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-parts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取集合的一部分</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-elements.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取单个元素</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-ordering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">排序</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-aggregate.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">聚合操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-write.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合写操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/list-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">List 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/set-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Set 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/map-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Map 相关操作</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="协程">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">协程</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutines-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程指南</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/basics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基础</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/cancellation-and-timeouts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取消与超时</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/composing-suspending-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">组合挂起函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutine-context-and-dispatchers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程上下文与调度器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/flow.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异步流</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/channels.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通道</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/exception-handling.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常处理与监督</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/shared-mutable-state-and-concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">共享的可变状态与并发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/select-expression.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Select 表达式（实验性的）</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="多平台程序设计">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">多平台程序设计</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/platform-specific-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台相关声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active ">
                <div class="marker"></div>
                <div class="text">以 Gradle 构建</div>
            </div>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="更多语言结构">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">更多语言结构</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multi-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">解构声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/typecasts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型检测与转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/this-expressions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">This 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/equality.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">相等性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/operator-overloading.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作符重载</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/null-safety.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">空安全</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/exceptions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/annotations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">注解</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/scope-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">作用域函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-safe-builders.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型安全的构建器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/opt-in-requirements.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Opt-in Requirements</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="核心库">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">核心库</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/jvm/stdlib/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">标准库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">kotlin.test</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="参考">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">参考</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/keyword-reference.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">关键字与操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/grammar.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">语法</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Java 互操作">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Java 互操作</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 Java</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Java 中调用 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="JavaScript">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">JavaScript</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-project-setup.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">搭建项目</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/dynamic-type.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">动态类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 JavaScript</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 中调用 Kotlin</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-modules.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 模块</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/javascript-dce.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript DCE</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="原生">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">原生</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">并发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/immutability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不可变性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/libraries.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/platform_libs.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/c_interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 C 语言互操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/objc_interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Objective-C 及 Swift 互操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/cocoapods.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">CocoaPods 集成</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/gradle_plugin.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Gradle 插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/debugging.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">调试</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="工具">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">工具</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-doc.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编写 Kotlin 代码文档</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kapt.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Kapt</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compiler-reference.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 编译器选项</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Gradle</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-maven.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Maven</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-ant.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Ant</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-osgi.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 与 OSGi</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compiler-plugins.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编译器插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/code-style-migration-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="演进">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">演进</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/kotlin-evolution.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 语言演进</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/components-stability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不同组件的稳定性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compatibility-guide-13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 1.3 的兼容性指南</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="常见问题">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">常见问题</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-java.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Java 比较</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-scala.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Scala 比较【官方已删除】</span>
            </a>
    </div>

    </div>

    </nav>


                <ul>
                  <li><a href="/docs/kotlin-docs.pdf" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/pdf/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（字大PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/epub/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（ePUB）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/mobi/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（Mobi）</span>
                  </a></li>
                </ul>
            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/reference/building-mpp-with-gradle.md"
   class="page-link-to-github"
   target="_blank"
   title="在 GitHub 上编辑本页">
        <i class="github-icon"></i>
        <span class="text">改进翻译</span>
</a>
                
<h1 id="使用-gradle-构建多平台项目">使用 Gradle 构建多平台项目</h1>
<blockquote class="note">
<p>多平台项目是 Kotlin 1.2 与 Kotlin 1.3 中的一个实验性特性。本文档中描述的所有语言<!--
-->与工具特性在未来的 Kotlin 版本中都可能会有所变化。</p>
</blockquote>
<p>本文档解释了 <a href="multiplatform.html">Kotlin 多平台项目</a>的结构，并描述了如何<!--
-->使用 Gradle 配置与构建这些项目。</p>
<h2 id="目录">目录</h2>
<ul>
<li><a href="#项目结构">项目结构</a></li>
<li><a href="#搭建一个多平台项目">搭建一个多平台项目</a></li>
<li><a href="#gradle-插件">Gradle 插件</a></li>
<li><a href="#设置目标">设置目标</a>
<ul>
<li><a href="#已支持平台">已支持平台</a></li>
<li><a href="#配置编译项">配置编译项</a></li>
</ul>
</li>
<li><a href="#配置源集">配置源集</a>
<ul>
<li><a href="#关联源集">关联源集</a></li>
<li><a href="#添加依赖">添加依赖</a></li>
<li><a href="#语言设置">语言设置</a></li>
</ul>
</li>
<li><a href="#默认项目布局">默认项目布局</a></li>
<li><a href="#运行测试">运行测试</a></li>
<li><a href="#发布多平台库">发布多平台库</a>
<ul>
<li><a href="#实验性的元数据发布模式">实验性的元数据发布模式</a></li>
<li><a href="#目标消歧义">目标消歧义</a></li>
</ul>
</li>
<li><a href="#jvm-目标平台中的-java-支持">JVM 目标平台中的 Java 支持</a></li>
<li><a href="#android-支持">Android 支持</a>
<ul>
<li><a href="#发布-android-库">发布 Android 库</a></li>
</ul>
</li>
<li><a href="#使用-kotlinnative-目标平台">使用 Kotlin/Native 目标平台</a>
<ul>
<li><a href="#目标快捷方式">目标快捷方式</a></li>
<li><a href="#构建最终原生二进制文件">构建最终原生二进制文件</a></li>
</ul>
</li>
</ul>
<h2 id="项目结构">项目结构</h2>
<p>Kotlin 多平台项目的布局由以下构建块构成：</p>
<ul>
<li>
<p><a href="#设置目标">目标</a>是构建的一部分，负责构建、测试<!--
-->及打包其中一个平台的完整软件。因此，多平台项目通常包含<!--
-->多个目标。</p>
</li>
<li>
<p>构建每个目标涉及一到多次编译 Kotlin 源代码。换句话说，一个目标可能有一到<!--
-->多个<a href="#配置编译项">编译项</a>。例如，一个编译项用于编译生产代码，另一个用于编译测试代码。</p>
</li>
<li>
<p>Kotlin 源代码会放到<a href="#配置源集">源集</a>中。除了 Kotlin 源文件与<!--
-->资源外，每个源集都可能有自己的依赖项。源集之间以<!--
--><em>“依赖”</em>关系构成了层次结构。源集本身是平台无关的，但是<!--
-->如果一个源集只面向单一平台编译，那么它可能包含平台相关代码与依赖项。</p>
</li>
</ul>
<p>每个编译项都有一个默认源集，是放置该编译项的源代码与依赖项的地<!--
-->方。默认源集还用于通过<!--
-->“依赖”关系将其他源集引到该编译项中。</p>
<p>以下是一个面向 JVM 与 JS 的项目的图示：</p>
<p><img alt="项目结构" src="/assets/images/reference/building-mpp-with-gradle/mpp-structure-default-jvm-js.png"/></p>
<p>这里有两个目标，即 <code>jvm</code> 与 <code>js</code>，每个目标都分别编译生产代码、测试代码，其中一些代码是共享的。
这种布局只是通过创建两个目标来实现的，并没有对编译项与源集进行额外配置<!--
-->：都是为相应目标<a href="#默认项目布局">默认创建</a>的。</p>
<p>在上述示例中，JVM 目标的生产源代码由其 <code>main</code> 编译项编译，其中<!--
-->包括来自 <code>jvmMain</code> 与 <code>commonMain</code>（由于<em>依赖</em>关系）的源代码与依赖项：</p>
<p><img alt="源集与编译项" src="/assets/images/reference/building-mpp-with-gradle/mpp-one-compilation.png"/></p>
<p>这里 <code>jvmMain</code> 源集为共享的 <code>commonMain</code> 源集中的预期 API 提供了<a href="platform-specific-declarations.html">平台相关实现</a><!--
-->。这就是在平台之间灵活共享代码、
按需使用平台相关实现的方式。</p>
<p>在后续部分，会详细描述这些概念以及将其配置到项目中的 DSL。</p>
<h2 id="搭建一个多平台项目">搭建一个多平台项目</h2>
<p>可以在 IDE 的 New Project - Kotlin 对话框下选择一个多平台项目模板<!--
-->来创建一个多平台项目。</p>
<p>例如，如果选择了“Kotlin (Multiplatform Library)”，会创建一个包含三个<!--
--><a href="#设置目标">目标</a>的库项目，其中一个用于 JVM，一个用于 JS，还有一个用于您正在使用的原生平台。
这些是在 <code>build.gradle</code> <!--
-->脚本中以下列方式配置的：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.70'
}

repositories {
    mavenCentral()
}

kotlin {
    jvm() // 使用默认名称 “jvm” 创建一个 JVM 目标
    js()  // 使用名称 “js” 创建一个 JS 目标
    mingwX64("mingw") // 使用名称 “mingw” 创建一个 Windows (MinGW X64) 目标
    
    sourceSets { /* …… */ }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    kotlin("multiplatform") version "1.3.70"
}

repositories {
    mavenCentral()
}

kotlin {
    jvm() // 使用默认名称 “jvm” 创建一个 JVM 目标
    js()  // 使用名称 “js” 创建一个 JS 目标
    mingwX64("mingw") // 使用名称 “mingw” 创建一个 Windows (MinGW X64) 目标

    sourceSets { /* …… */ }
}
</code></pre>
</div>
</div>
<p>这三个目标是通过预设函数 <code>jvm()</code>、<code>js()</code> 与 <code>mingwX64()</code> 创建的，它们提供了一些<!--
--><a href="#默认项目布局">默认项目布局</a>。每个<a href="#已支持平台">已支持平台</a>都有预设的函数。</p>
<p>然后配置<a href="#配置源集">源集</a>及其<a href="#添加依赖">依赖</a>，如下所示：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins { /* …… */ }

kotlin {
    /* 省略目标声明 */

    sourceSets {
        commonMain {
            dependencies {
                implementation kotlin('stdlib-common')
            }
        }
        commonTest {
            dependencies {
                implementation kotlin('test-common')
                implementation kotlin('test-annotations-common')
            }
        }

        // 仅用于 JVM 的源码及其依赖的默认源集
        // 或者使用 jvmMain { …… }
        jvm().compilations.main.defaultSourceSet {
            dependencies {
                implementation kotlin('stdlib-jdk8')
            }
        }
        // 仅用于 JVM 的测试及其依赖
        jvm().compilations.test.defaultSourceSet {
            dependencies {
                implementation kotlin('test-junit')
            }
        }

        js().compilations.main.defaultSourceSet  { /* …… */ }
        js().compilations.test.defaultSourceSet { /* …… */ }

        mingwX64('mingw').compilations.main.defaultSourceSet { /* …… */ }
        mingwX64('mingw').compilations.test.defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins { /* …… */ }

kotlin {
    /* 省略目标声明 */

    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(kotlin("stdlib-common"))
            }
        }
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test-common"))
                implementation(kotlin("test-annotations-common"))
            }
        }

        // 仅用于 JVM 的源码及其依赖的默认源集
        jvm().compilations["main"].defaultSourceSet {
            dependencies {
                implementation(kotlin("stdlib-jdk8"))
            }
        }
        // 仅用于 JVM 的测试及其依赖
        jvm().compilations["test"].defaultSourceSet {
            dependencies {
                implementation(kotlin("test-junit"))
            }
        }

        js().compilations["main"].defaultSourceSet  { /* …… */ }
        js().compilations["test"].defaultSourceSet { /* …… */ }

        mingwX64("mingw").compilations["main"].defaultSourceSet { /* …… */ }
        mingwX64("mingw").compilations["test"].defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<p>这些在上面配置的目标的生产与测试的源码<!--
-->都有各自的<a href="#默认项目布局">默认源集名称</a>。源集 <code>commonMain</code> 与 <code>commonTest</code> 将被分别包含在所有目标的生产与测试编译项中。
需要注意的是，公共源集 <code>commonMain</code> 与 <code>commonTest</code> 的依赖使用的都是公共构件，而<!--
-->平台库将转到特定目标的源集。</p>
<h2 id="gradle-插件">Gradle 插件</h2>
<p>Kotlin 多平台项目需要 Gradle 4.7 及以上版本，不支持旧版本的 Gradle。</p>
<p>如需在 Gradle 项目中从头开始设置多平台项目，首先要将
<code>kotlin-multiplatform</code> 插件应用到项目中，即在
<code>build.gradle</code> 文件的开头添加以下内容：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.70'
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    kotlin("multiplatform") version "1.3.70"
}
</code></pre>
</div>
</div>
<p>这会在顶层创建 <code>kotlin</code> 扩展。然后可以在构建脚本中访问该扩展，来：</p>
<ul>
<li>为多个平台<a href="#设置目标">设置目标</a>（默认不会创建目标）；</li>
<li><a href="#配置源集">配置源集</a>及其<a href="#添加依赖">依赖</a>；</li>
</ul>
<h2 id="设置目标">设置目标</h2>
<p>目标是构建的一部分，负责编译，测试与打包针对<!--
-->一个<a href="#已支持平台">已支持平台</a>的软件。</p>
<p>所有的目标可能共享一些源代码，也可能拥有平台专用的源代码。</p>
<p>由于平台的不同，目标也以不同的方式构建，并且拥有各个平台专用的<!--
-->设置。Gradle 插件捆绑了一些已支持平台的预设。</p>
<p>要创建一个目标，请使用其中一个预设函数，这些预置函数根据目标平台命名，并可选择<!--
-->接收一个目标名称与一个配置代码块：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() // 用默认名称 “jvm” 创建一个 JVM 目标
    js("nodeJs") // 用自定义名称 “nodeJs” 创建一个 JS 目标
        
    linuxX64("linux") {
        /* 在此处指定 “linux” 的其他设置 */
    }
}
</code></pre>
</div>
<p>如果存在，这些预置函数将返回一个现有的目标。这可以用于配置一个现有的目标：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    /* …… */

    // 配置 “jvm6” 目标的属性
    jvm("jvm6").attributes { /* …… */ }
}
</code></pre>
</div>
<p>注意目标平台与命名都很重要：如果一个目标作为 <code>jvm('jvm6')</code> 创建，使用 <code>jvm()</code> 将会<!--
-->创建一个单独的目标（使用默认名称 <code>jvm</code>）。如果用于创建该名称下的预设函数<!--
-->不同，将会报告一个错误。</p>
<p>从预置函数创建的目标将被添加到域对象集合 <code>kotlin.targets</code> 中，这可以用于<!--
-->通过名称访问它们或者配置所有目标：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm()
    js("nodeJs")

    println(targets.names) // 打印：[jvm, metadata, nodeJs]

    // 配置所有的目标，包括稍后添加的目标
    targets.all {
        compilations["main"].defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
<p>要从动态创建或访问多个预设中的多个目标，你可以使用 <code>targetFromPreset</code> 函数，
它接收一个接收预设（那些被包含在 <code>kotlin.presets</code> 域对象集合中的），以及可选的目标名称与配置的代码块。</p>
<p>例如，要为每一个 Kotlin/Native 支持的平台（见下文）创建目标，使用以下代码：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    presets.withType(org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTargetPreset).each {
        targetFromPreset(it) {
            /* 配置每个已创建的目标 */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">import org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTargetPreset

/* …… */

kotlin {
    presets.withType&lt;KotlinNativeTargetPreset&gt;().forEach {
        targetFromPreset(it) {
            /* 配置每个已创建的目标 */
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="已支持平台">已支持平台</h3>
<p>如上所示，对于以下目标平台，可以使用预设函数应用目标平台预设<!--
-->：</p>
<ul>
<li><code>jvm</code> 用于 Kotlin/JVM；</li>
<li><code>js</code> 用于 Kotlin/JS；</li>
<li>
<p><code>android</code> 用于 Android 应用程序与库。请注意在创建目标之前， 
 应该应用其中之一的 Android Gradle 插件；</p>
</li>
<li>
<p>Kotlin/Native 目标平台预设（参见下文<a href="#使用-kotlinnative-目标平台">备注</a>）：</p>
<ul>
<li><code>androidNativeArm32</code> 与 <code>androidNativeArm64</code> 用于 Android NDK；</li>
<li><code>iosArm32</code>、 <code>iosArm64</code>、 <code>iosX64</code> 用于 iOS；</li>
<li><code>watchosArm32</code>、 <code>watchosArm64</code>、 <code>watchosX86</code> 用于 watchOS；</li>
<li><code>tvosArm64</code>、 <code>tvosX64</code> 用于 tvOS；</li>
<li><code>linuxArm32Hfp</code>、 <code>linuxMips32</code>、 <code>linuxMipsel32</code>、 <code>linuxX64</code> 用于 Linux；</li>
<li><code>macosX64</code> 用于 MacOS；</li>
<li><code>mingwX64</code> 与 <code>mingwX86</code> 用于 Windows；</li>
<li><code>wasm32</code> 用于 WebAssembly。</li>
</ul>
<p>请注意，某些 Kotlin/Native 目标平台需要<a href="#使用-kotlinnative-目标平台">适宜的主机</a>来构建。</p>
</li>
</ul>
<p>某些目标平台可能需要附加配置。Android 与 iOS 示例请参见<!--
--><a href="/docs/tutorials/native/mpp-ios-android.html">多平台项目：iOS 与 Android</a> 教程。</p>
<h3 id="配置编译项">配置编译项</h3>
<p>构建目标需要一次或多次编译 Kotlin。目标的每次 Kotlin 编译项都可以用于<!--
-->不同的目的（例如生产代码，测试），并包含不同的<a href="#配置源集">源集</a>。
可以在 DSL 中访问目标的编译项，例如，配置<!--
--><a href="using-gradle.html#编译器选项">Kotlin 编译器选项</a>或者获取依赖项文件和编译项输出用来获取任务。</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm {
        compilations.main.kotlinOptions {
            // 为“main”编译项设置 Kotlin 编译器选项：
            jvmTarget = "1.8"
        }

        compilations.main.compileKotlinTask // 获取 Kotlin 任务“compileKotlinJvm”
        compilations.main.output // 获取 main 编译项输出
        compilations.test.runtimeDependencyFiles // 获取测试运行时路径
    }

    // 配置所有目标的所有编译项：
    targets.all {
        compilations.all {
            kotlinOptions {
                allWarningsAsErrors = true
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm {
        val main by compilations.getting {
            kotlinOptions {
                // 为“main”编译项设置 Kotlin 编译器选项：
                jvmTarget = "1.8"
            }

            compileKotlinTask // 获取 Kotlin 任务“compileKotlinJvm”
            output // 获取 main 编译项输出
        }

        compilations["test"].runtimeDependencyFiles // 获取测试运行时路径
    }

    // 配置所有目标的所有编译项：
    targets.all {
        compilations.all {
            kotlinOptions {
                allWarningsAsErrors = true
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>每个编译项都附带一个<a href="#配置源集">默认源集</a>，该默认源集<!--
-->存储特定于该编译项的源和依赖项。目标 <code>bar</code> 的编译项 <code>foo</code> 的默认源集的<!--
-->名称为 <code>barFoo</code>。也可以使用 <code>defaultSourceSet</code> 
从编译项中访问它：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() // 使用默认名称“jvm”创建一个 JVM 目标

    sourceSets {
        // “jvm”目标的“main”编译项的默认源集：
        jvmMain {
            /* …… */
        }
    }

    // 或者，从目标的编译项中访问它：
    jvm().compilations.main.defaultSourceSet {
        /* …… */
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm() // 使用默认名称“jvm”创建一个 JVM 目标

    sourceSets {
        // “jvm”目标的“main”编译项的默认源集：
        val jvmMain by getting {
            /* …… */
        }
    }

    // 或者，从目标的编译项中访问它：
    jvm().compilations["main"].defaultSourceSet {
        /* …… */
    }
}
</code></pre>
</div>
</div>
<p>为了收集参与编译项的所有源集，包括通过依赖关系添加的源集，可以<!--
-->使用属性 <code>allKotlinSourceSets</code>。</p>
<p>对于某些特定用例，可能需要创建自定义编译项。这可以在目标的 <code>compilations</code> 领域对象集合<!--
-->中完成。请注意，需要为所有自定义编译项手动设置依赖项，并且<!--
-->自定义编译项输出的使用取决于构建所有者。例如，对目标 <code>jvm()</code> 的集成测试的<!--
-->自定义编译项：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() {
        compilations.create('integrationTest') {
            defaultSourceSet {
                dependencies {
                    def main = compilations.main
                    // 根据 main 编译项的编译类路径和输出进行编译：
                    implementation(main.compileDependencyFiles + main.output.classesDirs)
                    implementation kotlin('test-junit')
                    /* …… */
                }
            }

            // 创建一个测试任务来运行此编译项产生的测试：
            tasks.create('jvmIntegrationTest', Test) {
                // 使用包含编译依赖项（包括“main”）的类路径运行测试，
                // 运行时依赖项以及此编译项的输出：
                classpath = compileDependencyFiles + runtimeDependencyFiles + output.allOutputs

                // 仅运行此编译项输出中的测试：        
                testClassesDirs = output.classesDirs
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm() {
        compilations {
            val main by getting

            val integrationTest by compilations.creating {
                defaultSourceSet {
                    dependencies {
                        // 根据 main 编译项的编译类路径和输出进行编译：
                        implementation(main.compileDependencyFiles + main.output.classesDirs)
                        implementation(kotlin("test-junit"))
                        /* …… */
                    }
                }

                // 创建一个测试任务来运行此编译项产生的测试：
                tasks.create&lt;Test&gt;("integrationTest") {
                    // 使用包含编译依赖项（包括“main”）的类路径运行测试，
                    // 运行时依赖项以及此编译项的输出：
                    classpath = compileDependencyFiles + runtimeDependencyFiles + output.allOutputs

                    // 仅运行此编译项输出中的测试：
                    testClassesDirs = output.classesDirs
                }
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>还要注意，默认情况下，自定义编译项的默认源集既不依赖于 <code>commonMain</code> 也不依赖于
<code>commonTest</code>。</p>
<h2 id="配置源集">配置源集</h2>
<p>Kotlin 源集是 Kotlin 源代码及其资源、依赖关系以及语言设置的集合，
一个源集可能会参与一个或多个<a href="#设置目标">目标</a>的 Kotlin 编译项。</p>
<p>源集不限于平台特定的或“共享的”；允许包含的内容取决于其用法：
添加到多个编译项中的源集仅限于通用语言特性及依赖项，仅由单个目标使用的源集<!--
-->可以具有平台特定的依赖项，并且其代码可能使用目标平台<!--
-->特定的语言特性。</p>
<p>默认情况下会创建并配置一些源集：<code>commonMain</code>、<code>commonTest</code> 和编译项的<!--
-->默认源集。 请参见<a href="#默认项目布局">默认项目布局</a>。</p>
<p>源集在 <code>kotlin { ... }</code> 扩展的 <code>sourceSets { ... }</code> 块内配置：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets { 
        foo { /* …… */ } // 创建或配置名称为 “foo” 的源集
        bar { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val foo by creating { /* …… */ } // 创建一个名为 “foo” 的新源集
        val bar by getting { /* …… */ } // 使用名称 “bar” 配置现有的源集
    }
}
</code></pre>
</div>
</div>
<blockquote class="note">
<p>注意：创建源集不会将其链接到任何目标。一些源集是<a href="#默认项目布局">预定义的</a>
因此默认情况下进行编译。但是，始终需要将自定义源集明确地定向到编译项。
请参见：<a href="#关联源集">关联源集</a>。</p>
</blockquote>
<p>源集名称区分大小写。在通过名称引用默认源集时，请确保源集的名称前缀<!--
-->与目标名称匹配，例如，目标 <code>iosX64</code> 的源集 <code>iosX64Main</code>。</p>
<p>源集本身是平台无关的，但是<!--
-->如果仅针对单个平台进行编译，则可以将其视为特定于平台的。因此，源集可以包含<!--
-->平台之间共享的公共代码或平台特定的代码。</p>
<p>每个源集都有 Kotlin 源代码的默认源目录：<code>src/&lt;源集名称&gt;/kotlin</code>。要将 Kotlin 源目录<!--
-->以及资源添加到源集中，请使用其 <code>kotlin</code> 与 <code>resources</code> <code>SourceDirectorySet</code>：</p>
<p>默认情况下，源集的文件存储在以下目录中：</p>
<ul>
<li>源文件：<code>src/&lt;source set name&gt;/kotlin</code></li>
<li>资源文件：<code>src/&lt;source set name&gt;/resources</code></li>
</ul>
<p>应该手动创建这些目录。</p>
<p>要将自定义 Kotlin 源目录和资源添加到源集中，请使用其 <code>kotlin</code> 与 <code>resources</code> <code>SourceDirectorySet</code>：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { 
    sourceSets { 
        commonMain {
            kotlin.srcDir('src')
            resources.srcDir('res')
        } 
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            kotlin.srcDir("src")
            resources.srcDir("res")
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="关联源集">关联源集</h3>
<p>Kotlin 源集可能与 <em>“depends on”</em> 关系有关，因而如果一个源集 <code>foo</code> 依赖于一个<!--
-->源集 <code>bar</code>，那么：</p>
<ul>
<li>
<p>每当为特定目标编译 <code>foo</code> 时，<code>bar</code> 也参与到编译中，并且还会编译成<!--
-->相同的目标二进制格式，例如 JVM 类文件或者 JS 代码；</p>
</li>
<li>
<p><code>foo</code> 源中的代码能 “看到” <code>bar</code> 的定义，包括 <code>internal</code> 的以及 <code>bar</code> 的<a href="#添加依赖">依赖</a>，即使是<!--
-->被指定为 <code>implementation</code> 的依赖；</p>
</li>
<li>
<p><code>foo</code> 可能包含针对 <code>bar</code> 的预期定义的<a href="platform-specific-declarations.html">特定平台的实现</a>；</p>
</li>
<li>
<p><code>bar</code> 的资源总是与 <code>foo</code> 的资源一起处理与复制；</p>
</li>
<li>
<p><code>foo</code> 与 <code>bar</code> 的语言应该是一致的；</p>
</li>
</ul>
<p>不允许源集间循环依赖。</p>
<p>源集 DSL 可以用于定义两个源集之间的联系：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain { /* …… */ }
        allJvm {
            dependsOn commonMain
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting { /* …… */ }
        val allJvm by creating {
            dependsOn(commonMain)
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<p>除了<a href="#默认项目布局">默认源集</a>外，还应将创建的自定义源集显式地包含在<!--
-->依赖关系层次结构中，以便于能够使用其他源集的定义，并且最重要的是能够参与到<!--
-->编译中。
大多数时候，它们需要 <code>dependsOn(commonMain)</code> 或 <code>dependsOn(commonTest)</code> 声明，并且一些默认的特定平台的<!--
-->源集应该直接或间接地<!--
-->依赖于自定义的源集</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { 
    mingwX64()
    linuxX64()

    sourceSets {
        // 带有两个目标测试的自定义源集
        desktopTest {
            dependsOn commonTest
            /* …… */
        }
        // 将 “windows” 的默认测试源集设置为依赖于 “desktopTest”
        mingwX64().compilations.test.defaultSourceSet {
            dependsOn desktopTest
            /* …… */
        }
        // 并且为其他目标做同样的工作：
        linuxX64().compilations.test.defaultSourceSet {
            dependsOn desktopTest
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    mingwX64()
    linuxX64()

    sourceSets {
        // 带有两个目标测试的自定义源集
        val desktopTest by creating {
            dependsOn(getByName("commonTest"))
            /* …… */
        }
        // 将 “windows” 的默认测试源集设置为依赖于 “desktopTest”
        mingwX64().compilations["test"].defaultSourceSet {
            dependsOn(desktopTest)
            /* …… */
        }
        // 并且为其他目标做同样的工作：
        linuxX64().compilations["test"].defaultSourceSet {
            dependsOn(desktopTest)
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="添加依赖">添加依赖</h3>
<p>为了添加依赖到源集中，需要在源集 DSL 中使用 <code>dependencies { …… }</code> 块，支持以下<!--
-->四种依赖：</p>
<ul>
<li>
<p><code>api</code> 依赖在编译项与运行时均会使用，并导出到库使用者。如果<!--
-->当前模块的公共 API 中使用了依赖中的任何类型，那么它应该是一个 <code>api</code> 依赖；</p>
</li>
<li>
<p><code>implementation</code> 依赖在当前模块的编译项与运行时均会使用，但不暴露<!--
-->给其他具有 <code>implementation</code> 依赖的模块的编译项。对于那种内部逻辑实现所需要的依赖，应该使用 <code>implementation</code>
依赖类型。如果模块是一个未发布的 endpoint 应用，它或许该<!--
-->使用 <code>implementation</code> 依赖而不是 <code>api</code> 依赖。</p>
</li>
<li>
<p><code>compileOnly</code> 依赖仅用于当前模块的编译项，并且在运行时与&lt;!—
-&gt;其他模块的编译项均不可用。这些依赖应该用于运行时具有第三方实现 API 中。</p>
</li>
<li>
<p><code>runtimeOnly</code> 依赖在运行时可用，但在任何模块的编译项都是不可见的。</p>
</li>
</ul>
<p>每个源集都可以通过以下方式指定依赖：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            dependencies {
                api 'com.example:foo-metadata:1.0'
            }
        }
        jvm6Main {
            dependencies {
                api 'com.example:foo-jvm6:1.0'
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        val commonMain by getting {
            dependencies {
                api("com.example:foo-metadata:1.0")
            }
        }
        val jvm6Main by getting {
            dependencies {
                api("com.example:foo-jvm6:1.0")
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>请注意，为了 IDE 能够正确地识别公共源的依赖，除了特定平台源集构件的依赖外，
公共源集还需要在
Kotlin 元数据包中具有相应的依赖。通常，
在使用一个已发布的库时（除非它与 Gradle 元数据一起发布，如下所述），
需要有一个后缀为 <code>-common</code> （如 <code>kotlin-stdlib-common</code>）或 <code>-metadata</code> 的构件。</p>
<p>然而，在另一个多平台项目中的 <code>project('……')</code> 依赖会被自动处理成一个<!--
-->合适的目标。在源集的依赖中指定单个 <code>project('……')</code> 依赖就足够了，
并且包含在源集中的编译将会接收到其项目的合适的特定平台的构件，
鉴于它具有兼容的目标：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            dependencies {
                // 包含源集 “commonMain” 的所有编译项
                // 会将依赖项解析为兼容的目标（如果有）：
                api project(':foo-lib')
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            dependencies {
                // 包含源集 “commonMain” 的所有编译项
                // 会将依赖项解析为兼容的目标（如果有）：
                api(project(":foo-lib"))
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>同样的，如果以实验性的<a href="#实验性的元数据发布模式">Gradle 元数据发布模式</a>发布了一个多平台库，并且该项目<!--
-->也设置为使用元数据，那么只需要为公共源集指定一次依赖。
除此以外，应该为每个特定平台的源集<!--
-->提供库的相应平台模块（除了公共模块），如上所示。</p>
<p>指定依赖的另一种方式是在顶层使用 Gradle 内置 DSL，其配置名称遵循<!--
-->模式 <code>&lt;源集名称&gt;&lt;依赖类型&gt;</code>：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">dependencies {
    commonMainApi 'com.example:foo-common:1.0'
    jvm6MainApi 'com.example:foo-jvm6:1.0'
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">dependencies {
    "commonMainApi"("com.example:foo-common:1.0")
    "jvm6MainApi"("com.example:foo-jvm6:1.0")
}
</code></pre>
</div>
</div>
<p>一些 Gradle 内置依赖（例如 <code>gradleApi()</code>、<code>localGroovy()</code>、或 <code>gradleTestKit()</code>）<!--
-->在源集依赖 DSL 中是不可用的。但是，你可以将它们添加到顶级依赖块中，如上所示。</p>
<p>可以使用 <code>kotlin("stdlib")</code> 表示法添加对 Kotlin 模块（例如 <code>kotlin-stdlib</code> 或 <code>kotlin-reflect</code>）的依赖，
这是 <code>"org.jetbrains.kotlin:kotlin-stdlib"</code> 的简写。</p>
<h3 id="语言设置">语言设置</h3>
<p>源集的语言设置可以通过以下方式指定：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            languageSettings {
                languageVersion = '1.3' // 可填：“1.0”、“1.1”、“1.2”、“1.3”
                apiVersion = '1.3' // 可填：“1.0”、“1.1”、“1.2”、“1.3”
                enableLanguageFeature('InlineClasses') // 语言特性名称
                useExperimentalAnnotation('kotlin.ExperimentalUnsignedTypes') // 注解的全限定名
                progressiveMode = true // 默认为 false
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            languageSettings.apply {
                languageVersion = "1.3" // 可填：“1.0”、“1.1”、“1.2”、“1.3”
                apiVersion = "1.3" // 可填：“1.0”、“1.1”、“1.2”、“1.3”
                enableLanguageFeature("InlineClasses") // 语言特性名称
                useExperimentalAnnotation("kotlin.ExperimentalUnsignedTypes") // 注解的全限定名
                progressiveMode = true // 默认为 false
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>可以一次性为所有源集配置语言设置：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin.sourceSets.all {
    languageSettings.progressiveMode = true
}
</code></pre>
</div>
<p>源集的语言设置会影响 IDE 识别源代码的方式。由于当前的限制，在
Gradle 构建中，只有构建的默认源集的语言设置会被使用，并且应用于<!--
-->参与编译的所有源代码。</p>
<p>检查语言设置是否相互依赖，以确保源集之间的一致性。即如果 <code>foo</code> 依赖于 <code>bar</code>：</p>
<ul>
<li><code>foo</code> 需设置高于或等于 <code>bar</code> 的 <code>languageVersion</code>；</li>
<li><code>foo</code> 需要启用所有 <code>bar</code> 启用的非稳定语言特性（对于错误修复特性则没有这种要求）；</li>
<li><code>foo</code> 需要使用所有 <code>bar</code> 使用的实验性注解；</li>
<li><code>apiVersion</code>、错误修复的语言特性 和 <code>progressiveMode</code> 可以被任意设置；</li>
</ul>
<h2 id="默认项目布局">默认项目布局</h2>
<p>默认情况下，每个项目都包含了两个源集，<code>commonMain</code> 与 <code>commonTest</code>，在其中可以放置应在<!--
-->所有目标平台之间共享的所有代码。这些源集会被分别添加到每个生产和测试编译项。</p>
<p>之后，当目标被添加时，将为其创建默认编译项：</p>
<ul>
<li>针对 JVM、JS 和原生目标的 <code>main</code> 与 <code>test</code> 编译项；</li>
<li>针对每个 <a href="https://developer.android.com/studio/build/build-variants">Android 构建版本</a>的编译项；</li>
</ul>
<p>对于每个编译项，在由 <code>&lt;目标名称&gt;&lt;编译项名称&gt;</code> 组成的名称下都有一个默认源集。这个默认源集<!--
-->参与编译，因此它应用于特定平台的代码与依赖，并且以依赖的方式将其他<!--
-->源集添加到编译项中。例如，一个有着
<code>jvm6</code> （JVM）与 <code>nodeJs</code>（JS）目标的项目将拥有源集：<code>commonMain</code>、<code>commonTest</code>、<code>jvm6Main</code>、<code>jvm6Test</code>、<code>nodeJsMain</code> 以及 <code>nodeJsTest</code>。</p>
<p>仅仅是默认源集就涵盖了很多用例，因此不需要自定义源集。</p>
<p>每个源集都默认拥有在 <code>src/&lt;源集名称&gt;/kotlin</code> 目录下的 Kotlin 源代码与在 <code>src/&lt;源集名称&gt;/resources</code> 目录下的资源。</p>
<p>在 Android 项目中，将为每个 <a href="https://developer.android.com/studio/build/#sourcesets">Android 源集</a>创建额外的 Kotlin 源集.
如果其 Android 目标的名称为 <code>foo</code>，那么其 Android 源集 <code>bar</code> 将获得一个对应的 Kotlin 源集 <code>fooBar</code>。
然而，Kotlin 编译项能够使用来自所有 <code>src/bar/java</code>、<code>src/bar/kotlin</code> 以及 <code>src/fooBar/kotlin</code>
目录的 Kotlin 源代码。而 Java 源代码则只能从上述第一个目录读取。</p>
<h2 id="运行测试">运行测试</h2>
<p>目前默认支持 JVM、Android、Linux、Windows 以及 macOS 在 Gradle 构建中运行测试；
JS 与其他 Kotlin/Native 目标<!--
-->需要手动配置以在适当的环境、模拟器或测试框架下运行测试。</p>
<p>将为每个适合测试的目标创建名为 <code>&lt;目标名称&gt;Test</code> 的测试任务。运行 <code>check</code> 任务以<!--
-->为所有目标运行测试。</p>
<p>由于 <code>commonTest</code> <a href="#默认项目布局">默认源集</a>被添加到所有测试编译项中，所以会将所有目标平台<!--
-->上所需的测试和测试工具放在此处。</p>
<p><a href="https://kotlinlang.org/api/latest/kotlin.test/index.html"><code>kotlin.test</code> API</a>对于多平台测试是可用的。
添加 <code>kotlin-test-common</code> 与 <code>kotlin-test-annotations-common</code> 依赖到 <code>commonTest</code> 以在<!--
-->公共测试中使用断言函数（例如 <code>kotlin.test.assertTrue(……)</code>
以及 <code>@Test</code>/<code>@Ignore</code>/<code>@BeforeTest</code>/<code>@AfterTest</code> 注解）</p>
<p>对于 JVM 目标，将 <code>kotlin-test-junit</code> 或 <code>kotlin-test-testng</code> 用于相应的断言器实现和<!--
-->注解映射。</p>
<p>对于 Kotlin/JS 目标，把 <code>kotlin-test-js</code> 添加为测试依赖。至此，将创建针对 Kotlin/JS 的测试任务，但默认情况下并不会运行测试；
应该手动配置它们以使用 JavaScript 测试框架运行测试。</p>
<p>Kotlin/Native 目标不需要额外测试依赖，并且内置了 <code>kotlin.test</code> API 的实现。</p>
<h2 id="发布多平台库">发布多平台库</h2>
<blockquote class="note">
<p>目标平台集合由多平台库作者定义，并且他们应该为库提供所有特定平台的实现。
不支持为多平台库添加用户端的新目标。</p>
</blockquote>
<p>来自多平台项目的库构建可以通过 <a href="https://docs.gradle.org/current/userguide/publishing_maven.html"><code>maven-publish</code> Gradle 插件</a><!--
-->发布到 Maven 仓库，这个插件可通过<!--
-->以下方式应用：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    /* …… */
    id("maven-publish")
}
</code></pre>
</div>
<p>一个库也需要在项目中设置 <code>group</code> 与 <code>version</code> 字段：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins { /* …… */ }

group = "com.example.my.library"
version = "0.0.1"
</code></pre>
</div>
<p>与发布一个普通的 Kotlin/JVM 或 Java 项目相比，并没有必要通过 <code>publishing { …… }</code> DSL
来手动创建一个发布项。将为可在当前主机<!--
-->构建的每个目标自动创建发布项，但 Android 目标除外，Android 目标需要额外的步骤来配置<!--
-->发布，参见<a href="#发布-android-库">发布 Android 库</a>。</p>
<p>通过在 <code>publishing { …… }</code> DSL 中的 <code>repositories</code> 块添加将被发布的库的仓库。
如 <a href="https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:repositories">Maven Publish Plugin. Repositories</a> 所述。</p>
<p>默认构件 ID 遵循模式 <code>&lt;项目名称&gt;-&lt;小写的目标名称&gt;</code>，例如对于项目 <code>sample-lib</code> 中<!--
-->名为 <code>nodeJs</code> 的目标，为 <code>sample-lib-nodejs</code>。</p>
<p>默认情况下，将为每个发布项中添加源代码 JAR（除了它的主构件）。源代码 JAR 包含了<!--
-->目标主编译项所使用的源代码。如果你还需要发布文档构件（例如
Javadoc JAR），则需要手动配置其构建并且将其作为构件添加到相关发布项中，如<!--
-->下所示。</p>
<p>此外，会默认添加名为 <code>metadata</code> 的额外发布项，它包含序列化的 Kotlin
定义并且被 IDE 用于分析多平台库。
这个发布项的默认构件 ID 的形式为 <code>&lt;项目名称&gt;-metadata</code>。</p>
<p>可以更改 Maven 坐标，并且可以为在
<code>targets { …… }</code> 块或 <code>publishing { …… }</code> DSL 中的发布项添加额外的构件文件：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm('jvm6') {
        mavenPublication { // 为目标 “jvm6” 设置发布项
            // 默认的 artifactId 为 “foo-jvm6”，修改它：
            artifactId = 'foo-jvm'
            // 添加 docs JAR 构件（应是一个自定义任务）：
            artifact(jvmDocsJar)
        }
    }
}

// 使用 `publishing { …… }` DSL 来配置发布项是可选的：
publishing {
    publications {
        jvm6 { /* 为目标 “jvm6” 设置发布项 */ }
        metadata { /* 为 Kotlin 元数据设置发布项 */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm("jvm6") {
        mavenPublication { // 为目标 “jvm6” 设置发布项
            // 默认的 artifactId 为 “foo-jvm6”，修改它：
            artifactId = "foo-jvm"
            // 添加 docs JAR 构件（应是一个自定义任务）：
            artifact(jvmDocsJar)
        }
    }
}

// 使用 `publishing { …… }` DSL 来配置发布项是可选的：
publishing {
    publications.withType&lt;MavenPublication&gt;().apply {
        val jvm6 by getting { /* 为目标 “jvm6” 设置发布项 */ }
        val metadata by getting { /* 为 Kotlin 元数据设置发布项 */ }
    }
}
</code></pre>
</div>
</div>
<p>由于 Kotlin/Native 的汇编构件需要多次构建才能在不同的主机平台运行，所以发布<!--
-->包含 Kotlin/Native 目标的多平台库需要使用同一套主机进行。为了避免<!--
-->重复发布能在多个平台
（例如 JVM、JS、Kotlin 元数据以及 WebAssembly）上构建的模块，可以将这些模块的发布任务配置为<!--
-->有条件地运行。</p>
<p>这个简化的例子确保了 JVM、JS 与 Kotlin 元数据的发布仅在命令行中传递
<code>-PisLinux=true</code> 到构建时上传：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm()
    js()
    mingwX64()
    linuxX64()

    // 注意 Kotlin 元数据也在这里。
    // 由于 mingwx64() 目标在 Linux 构建中不兼容而被自动跳过。
    configure([targets["metadata"], jvm(), js()]) {
        mavenPublication { targetPublication -&gt;
            tasks.withType(AbstractPublishToMaven)
                .matching { it.publication == targetPublication }
                .all { onlyIf { findProperty("isLinux") == "true" } }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm()
    js()
    mingwX64()
    linuxX64()

    // 注意 Kotlin 元数据也在这里。
    // 由于 mingwx64() 目标在 Linux 构建中不兼容而被自动跳过。
    configure(listOf(metadata(), jvm(), js())) {
        mavenPublication {
            val targetPublication = this@mavenPublication
            tasks.withType&lt;AbstractPublishToMaven&gt;()
                .matching { it.publication == targetPublication }
                .all { onlyIf { findProperty("isLinux") == "true" } }
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="实验性的元数据发布模式">实验性的元数据发布模式</h3>
<p>Gradle 模块元数据提供了丰富的发布与解析依赖项的特性，这些特性用于 Kotlin
多平台项目来为构建作者简化依赖配置。特别是多平台库的发布项<!--
-->可能包含一个特殊的 “根” 模块，它基于整个库，并且<!--
-->在添加为依赖项时自动解析到适当的特定平台构件中，如下所述。</p>
<p>Gradle 5.3 或更高的版本，依赖项解析期间总是使用模块元数据，但在默认情况下，发布项不会<!--
-->包含任何模块元数据。为了启用发布模块元数据，需要添加
<code>enableFeaturePreview("GRADLE_METADATA")</code> 到根项目的 <code>settings.gradle</code> 文件。对于更旧的 Gradle 版本，
模块元数据的使用也需要这个。</p>
<blockquote class="note">
<p>注意通过 Gradle 5.3 或更高版本发布的模块元数据不能被低于
5.3 的 Gradle 所读取。</p>
</blockquote>
<p>随着启用 Gradle 元数据，一个额外的名为 <code>kotlinMultiplatform</code> 的 “根” 发布项将添加到项目的<!--
-->发布项中。这个发布项的默认构件 ID 与没有任何额外后缀的项目名称相匹配。
为了配置这个发布项，可以通过 <code>maven-publish</code> 插件的 <code>publishing { …… }</code> DSL 访问：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { /* …… */ }

publishing {
    publications {
        kotlinMultiplatform {
            artifactId = "foo"
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin { /* …… */ }

publishing {
    publications {
        val kotlinMultiplatform by getting {
            artifactId = "foo"
        }
    }
}
</code></pre>
</div>
</div>
<p>这个发布项没有包含任何构件并且仅将其他发布项引用为它的变体。然而，
如果仓库需要，则可能需要提供源代码和文档构件。在这种情况下，在发布项的 scope 中<!--
-->通过使用 <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/publish/maven/MavenPublication.html#artifact-java.lang.Object-"><code>artifact(...)</code></a> 
添加那些构件， 如上所示访问。</p>
<p>如果库拥有一个 “根” 发布项，用户可以在公共源集中指定对整个库的单个依赖，
并且将为每个包含这个依赖项的编译项（如果有）选择一个合适的特定平台版本。
考虑一个为 JVM 与 JS 编译并且与
“根” 发布项一起发布的 <code>sample-lib</code> 库：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm('jvm6')
    js('nodeJs')

    sourceSets {
        commonMain {
            dependencies {
                // 这单个依赖将解析到适当的目标模块，
                // 例如，对于 JVM 解析为 `sample-lib-jvm6`，而对于 JS 解析为 `sample-lib-js`：
                api 'com.example:sample-lib:1.0'
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm("jvm6")
    js("nodeJs")

    sourceSets {
        val commonMain by getting {
            dependencies {
                // 这单个依赖将解析到适当的目标模块，
                // 例如，对于 JVM 解析为 `sample-lib-jvm6`，而对于 JS 解析为 `sample-lib-js`：
                api("com.example:sample-lib:1.0")
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>这需要使用者的 Gradle 构建可以读取 Gradle 模块元数据，要么使用 Gradle 5.3+，要么<!--
-->在 <code>settings.gradle</code> 中通过 <code>enableFeaturePreview("GRADLE_METADATA")</code> 显式地启用它</p>
<h3 id="目标消歧义">目标消歧义</h3>
<p>在一个多平台库中，对于单个平台可能拥有多个目标。例如，这些目标<!--
-->可能提供了相同的 API，并且在运行时调用的实现库中有所不同，例如测试框架或日志解决方案。</p>
<p>然而，对这种多平台库的依赖可能存在歧义，并且可能因为没有<!--
-->充足的信息来决定选择哪个目标，从而导致解析的失败。</p>
<p>解决的方法是用自定义属性标记目标, Gradle 会根据它来解析依赖项。
但是，库的作者与用户必须同时给目标加上自定义属性，
并且库作者有责任将属性与可能的值传达给使用者。</p>
<p>添加属性对库作者和用户来说是对称的。例如，考虑一个<!--
-->在两个目标中分别支持了 JUnit 和 TestNG 的测试库。库作者需要为这两个<!--
-->目标添加属性，如下：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">def testFrameworkAttribute = Attribute.of('com.example.testFramework', String)

kotlin {
    jvm('junit') {
        attributes.attribute(testFrameworkAttribute, 'junit')
    }
    jvm('testng') {
        attributes.attribute(testFrameworkAttribute, 'testng')
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val testFrameworkAttribute = Attribute.of("com.example.testFramework", String::class.java)

kotlin {
    jvm("junit") {
        attributes.attribute(testFrameworkAttribute, "junit")
    }
    jvm("testng") {
        attributes.attribute(testFrameworkAttribute, "testng")
    }
}
</code></pre>
</div>
</div>
<p>用户可能只需要给产生歧义的单个目标添加属性。</p>
<p>如果将依赖项被添加到自定义的配置项中（而不是<!--
-->通过插件创建的配置项之一）时出现了相同的歧义，你可以通过相同的方式将属性添加到配置项中：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">def testFrameworkAttribute = Attribute.of('com.example.testFramework', String)

configurations {
    myConfiguration {
        attributes.attribute(testFrameworkAttribute, 'junit')
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val testFrameworkAttribute = Attribute.of("com.example.testFramework", String::class.java)

configurations {
    val myConfiguration by creating {
        attributes.attribute(testFrameworkAttribute, "junit")
    }
}
</code></pre>
</div>
</div>
<h2 id="jvm-目标平台中的-java-支持">JVM 目标平台中的 Java 支持</h2>
<p>This feature is available since Kotlin 1.3.40.</p>
<p>By default, a JVM target ignores Java sources and only compiles Kotlin source files.
To include Java sources in the compilations of a JVM target, or to apply a Gradle plugin that requires the
<code>java</code> plugin to work, you need to explicitly enable Java support for the target:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm {
        withJava()
    }
}
</code></pre>
</div>
<p>This will apply the Gradle <code>java</code> plugin and configure the target to cooperate with it.
Note that just applying the Java plugin without specifying <code>withJava()</code> in a JVM
target will have no effect on the target.</p>
<p>The file system locations for the Java sources are different from  the <code>java</code> plugin's defaults.
The Java source files need to be placed in the sibling directories of the Kotlin source
roots. For example, if the JVM target has the default name <code>jvm</code>, the paths are:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>src
├── jvmMain
│   ├── java // production Java sources
│   ├── kotlin
│   └── resources
├── jvmTest
│   ├── java // test Java sources
│   ├── kotlin
…   └── resources
</code></pre>
</div>
<p>The common source sets cannot include Java sources.</p>
<p>Due to the current limitations, some tasks configured by the Java plugin are disabled, and the corresponding tasks added
by the Kotlin plugin are used instead:</p>
<ul>
<li><code>jar</code> is disabled in favor of the target's JAR task (e.g. <code>jvmJar</code>)</li>
<li><code>test</code> is disabled, and the target's test task is used (e.g. <code>jvmTest</code>)</li>
<li><code>*ProcessResources</code> tasks are disabled, and the resources are processed by the equivalent tasks of the compilations</li>
</ul>
<p>The publication of this target is handled by the Kotlin plugin and doesn't require the steps that are specific to the
Java plugin, such as manually creating a publication and configuring it as <code>from(components.java)</code>.</p>
<h2 id="android-支持">Android 支持</h2>
<p>Kotlin Multiplatform projects support the Android platform by providing the <code>android</code> preset.
Creating an Android target requires that one of the Android Gradle plugins, like <code>com.android.application</code> or
<code>com.android.library</code> is manually applied to the project. Only one Android target may be created per Gradle subproject:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id("com.android.library")
    id("org.jetbrains.kotlin.multiplatform").version("1.3.70")
}

android { /* …… */ }

kotlin {
    android { // Create the Android target
        // Provide additional configuration if necessary
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    id("com.android.library")
    kotlin("multiplatform").version("1.3.70")
}

android { /* …… */ }

kotlin {
    android { // Create the Android target
        // Provide additional configuration if necessary
    }
}
</code></pre>
</div>
</div>
<p>An Android target's compilations created by default are tied to <a href="https://developer.android.com/studio/build/build-variants">Android build variants</a>:
for each build variant, a Kotlin compilation is created under the same name.</p>
<p>Then, for each <a href="https://developer.android.com/studio/build/build-variants#sourcesets">Android source set</a> compiled by
the variants, a Kotlin source set is created under that source set name
prepended by the target name, like Kotlin source set <code>androidDebug</code> for an Android source set <code>debug</code> and the Kotlin target
named <code>android</code>. These Kotlin source sets are added to the variants compilations accordingly.</p>
<p>The default source set <code>commonMain</code> is added to each production (application or library) variant's compilation. The
<code>commonTest</code> source set is, similarly, added to the compilations of unit test and instrumented test variants.</p>
<p>Annotation processing with <a href="/docs/reference/kapt.html">kapt</a> is also supported but, due to the current limitations,
it requires that the Android target is created before the <code>kapt</code> dependencies are configured, which needs
to be done in a top-level <code>dependencies { ... }</code> block rather than within Kotlin source sets dependencies.</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// ...

kotlin {
    android { /* …… */ }
}

dependencies {
    kapt("com.my.annotation:processor:1.0.0")
}
</code></pre>
</div>
<h3 id="发布-android-库">发布 Android 库</h3>
<p>To publish an Android library as a part of a multiplatform library, one needs to
<a href="#发布多平台库">setup publishing for the library</a> and provide additional configuration for the
Android library target.</p>
<p>By default, no artifacts of an Android library are published. To publish artifacts produced by a set of
<a href="https://developer.android.com/studio/build/build-variants">Android variants</a>, specify the variant names in the Android
target block as follows:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    android {
        publishLibraryVariants("release", "debug")
    }
}
</code></pre>
</div>
<p>The example above will work for Android libraries with no product flavors. For a library with product flavors, the
variant names also contain the flavors, like <code>fooBarDebug</code> or <code>fooBazRelease</code>.</p>
<p>Note that if a library consumer defines variants that are missing in the library, they need to provide
<a href="https://developer.android.com/studio/build/dependencies#resolve_matching_errors">matching fallbacks</a>. For example, if
a library does not have or does not publish a <code>staging</code> build type, it will be necessary to provide a fallback for the
consumers who have such a build type, specifying at least one of the build types that the library publishes:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">android {
    buildTypes {
        staging {
            // ...
            matchingFallbacks = ['release', 'debug']
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">android {
    buildTypes {
        val staging by creating {
            // ...
            matchingFallbacks = listOf("release", "debug")
        }
    }
}
</code></pre>
</div>
</div>
<p>Similarly, a library consumer may need to provide matching fallbacks for custom product flavors if some are missing in
the library publications.</p>
<p>There is an option to publish variants grouped by the product flavor, so that the outputs of the different build
types are placed in a single module, with the build type becoming a classifier for the artifacts (the release build
type is still published with no classifier). This mode is disabled by default and can be enabled as follows:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-groovy">kotlin {
    android {
        publishLibraryVariantsGroupedByFlavor = true
    }
}
</code></pre>
</div>
<p>It is not recommended to publish variants grouped by the product flavor in case they have different dependencies, as
those will be merged into one dependencies list.</p>
<h2 id="使用-kotlinnative-目标平台">使用 Kotlin/Native 目标平台</h2>
<p>重要的是，注意某些 <a href="#已支持平台">Kotlin/Native 目标</a>仅能在适当的主机上被编译：</p>
<ul>
<li>Linux MIPS 目标（<code>linuxMips32</code> 与 <code>linuxMipsel32</code>）需要一台 Linux 主机。其他 Linux 目标则可以在任意受支持的主机上编译。</li>
<li>Windows 目标需要一台 Windows 主机；</li>
<li>macOS 与 iOS 目标只能在 macOS 主机上编译；</li>
<li>64 位的 Android 原生目标需要一台 Linux 或 macOS 主机。32 位的 Android 原生目标则可以在任意受支持的主机上编译。</li>
</ul>
<p>当前主机不支持的目标在构建期间会被忽略，因此也不会发布。库作者可能希望在目标库平台所需的不同主机上<!--
-->进行构建和发布。</p>
<h3 id="目标快捷方式">目标快捷方式</h3>
<p>一些原生目标经常一同创建，并且使用相同的源代码。例如，iOS 设备与模拟器<!--
-->的构建由不同的目标（分别是 <code>iosArm64</code> 与 <code>iosX64</code>）表示，但它们的源代码通常是相同的。
多平台项目模型中来表示这种共享代码的一个经典方式是创建一个中间<!--
-->源集（<code>iosMain</code>），并且在它和平台源集之间配置链接：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">sourceSets{
    iosMain {
        dependsOn(commonMain)
        iosDeviceMain.dependsOn(it)
        iosSimulatorMain.dependsOn(it)
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val commonMain by sourceSets.getting
val iosDeviceMain by sourceSets.getting
val iosSimulatorMain by sourceSets.getting

val iosMain by sourceSets.creating {
    dependsOn(commonMain)
    iosDeviceMain.dependsOn(this)
    iosSimulatorMain.dependsOn(this)
}
</code></pre>
</div>
</div>
<p>自 1.3.60 起，<code>kotlin-multiplaform</code> 插件提供了自动化这些配置的快捷方式：它们使用户<!--
-->可以通过单个 DSL 方法来创建一组目标以及公共源集。</p>
<p>可用快捷方式有这些：</p>
<ul>
<li><code>ios</code> 为 <code>iosArm64</code> 与 <code>iosX64</code> 创建目标。</li>
<li><code>watchos</code> 为 <code>watchosArm32</code>、<code>watchosArm64</code> 以及 <code>watchosX86</code> 创建目标。</li>
<li><code>tvos</code> 为 <code>tvosArm64</code> 与 <code>tvosX64</code> 创建目标。</li>
</ul>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// 为 iOS 创建两个目标。
// 创建公共源集：iosMain 与 iosTest。
ios {
    // 配置目标。
    // 注意：将会为每个目标调用这个 lambda。
}

// 你也可以指定一个名称前缀来创建目标。
// 公共源集也将会有一个前缀：
// anotherIosMain 与 anotherIosTest。
ios("anotherIos")
</code></pre>
</div>
<h3 id="构建最终原生二进制文件">构建最终原生二进制文件</h3>
<p>By default, a Kotlin/Native target is compiled down to a <code>*.klib</code> library artifact, which can be consumed by Kotlin/Native itself as a
dependency but cannot be executed or used as a native library. To declare final native binaries like executables or shared libraries a <code>binaries</code>
property of a native target is used. This property represents a collection of native binaries built for this target in addition to the
default <code>*.klib</code> artifact and provides a set of methods for declaring and configuring them.</p>
<p>Note that the <code>kotlin-multiplaform</code> plugin doesn't create any production binaries by default. The only binary available by default
is a debug executable allowing one to run tests from the <code>test</code> compilation.</p>
<h4 id="declaring-binaries">Declaring binaries</h4>
<p>A set of factory methods is used for declaring elements of the <code>binaries</code> collection. These methods allow one to specify what kinds of binaries are to be created and configure them. The following binary kinds are supported (note that not all the kinds are available for
all native platforms):</p>
<table>
<thead>
<tr>
<th><strong>Factory method</strong></th>
<th><strong>Binary kind</strong></th>
<th><strong>Available for</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>executable</code></td>
<td>a product executable</td>
<td>all native targets</td>
</tr>
<tr>
<td><code>test</code></td>
<td>a test executable</td>
<td>all native targets</td>
</tr>
<tr>
<td><code>sharedLib</code></td>
<td>a shared native library</td>
<td>all native targets except <code>wasm32</code></td>
</tr>
<tr>
<td><code>staticLib</code></td>
<td>a static native library</td>
<td>all native targets except <code>wasm32</code></td>
</tr>
<tr>
<td><code>framework</code></td>
<td>an Objective-C framework</td>
<td>macOS, iOS, watchOS, and tvOS targets only</td>
</tr>
</tbody>
</table>
<p>Each factory method exists in several versions. Consider them by example of the <code>executable</code> method. All the same versions are available
for all other factory methods.</p>
<p>The simplest version doesn't require any additional parameters and creates one binary for each build type.
Currently there a two build types available: <code>DEBUG</code> (produces a not optimized binary with a debug information) and <code>RELEASE</code> (produces
an optimized binary without debug information). Consequently the following snippet creates two executable binaries: debug and release.</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    linuxX64 { // Use your target instead.
        binaries {
            executable {
                // Binary configuration.
            }
        }
    }
}
</code></pre>
</div>
<p>A lambda expression accepted by the <code>executable</code> method in the example above is applied to each binary created and allows one to configure the binary
(see the <a href="#configuring-binaries">corresponding section</a>). Note that this lambda can be dropped if there is no need for additional configuration:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable()
}
</code></pre>
</div>
<p>It is possible to specify which build types will be used to create binaries and which won't. In the following example only debug executable is created.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable([DEBUG]) {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable(listOf(DEBUG)) {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<p>Finally the last factory method version allows customizing the binary name.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable('foo', [DEBUG]) {
        // Binary configuration.
    }

    // It's possible to drop the list of build types (all the available build types will be used in this case).
    executable('bar') {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable("foo", listOf(DEBUG)) {
        // Binary configuration.
    }

    // It's possible to drop the list of build types (all the available build types will be used in this case).
    executable("bar") {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<p>The first argument in this example allows one to set a name prefix for the created binaries which is used to access them in the buildscript (see the <a href="#accessing-binaries">"Accessing binaries"</a> section).
Also this prefix is used as a default name for the binary file. For example on Windows the sample above produces files <code>foo.exe</code> and <code>bar.exe</code>.</p>
<h4 id="accessing-binaries">Accessing binaries</h4>
<p>The binaries DSL allows not only creating binaries but also accessing already created ones to configure them or get their properties
(e.g. path to an output file). The <code>binaries</code> collection implements the
<a href="https://docs.gradle.org/current/javadoc/org/gradle/api/DomainObjectSet.html"><code>DomainObjectSet</code></a> interface and provides methods like
<code>all</code> or <code>matching</code> allowing configuring groups of elements.</p>
<p>Also it's possible to get a certain element of the collection. There are two ways to do this. First, each binary has a unique
name. This name is based on the name prefix (if it's specified), build type and binary kind according to the following pattern:
<code>&lt;optional-name-prefix&gt;&lt;build-type&gt;&lt;binary-kind&gt;</code>, e.g. <code>releaseFramework</code> or <code>testDebugExecutable</code>.</p>
<blockquote>
<p>Note: static and shared libraries has suffixes <code>static</code> and <code>shared</code> respectively, e.g. <code>fooDebugStatic</code> or <code>barReleaseShared</code></p>
</blockquote>
<p>This name can be used to access the binary:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">// Fails if there is no such a binary.
binaries['fooDebugExecutable']
binaries.fooDebugExecutable
binaries.getByName('fooDebugExecutable')

 // Returns null if there is no such a binary.
binaries.findByName('fooDebugExecutable')
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// Fails if there is no such a binary.
binaries["fooDebugExecutable"]
binaries.getByName("fooDebugExecutable")

 // Returns null if there is no such a binary.
binaries.findByName("fooDebugExecutable")
</code></pre>
</div>
</div>
<p>The second way is using typed getters. These getters allow one to access a binary of a certain type by its name prefix and build type.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">// Fails if there is no such a binary.
binaries.getExecutable('foo', DEBUG)
binaries.getExecutable(DEBUG)          // Skip the first argument if the name prefix isn't set.
binaries.getExecutable('bar', 'DEBUG') // You also can use a string for build type.

// Similar getters are available for other binary kinds:
// getFramework, getStaticLib and getSharedLib.

// Returns null if there is no such a binary.
binaries.findExecutable('foo', DEBUG)

// Similar getters are available for other binary kinds:
// findFramework, findStaticLib and findSharedLib.
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// Fails if there is no such a binary.
binaries.getExecutable("foo", DEBUG)
binaries.getExecutable(DEBUG)          // Skip the first argument if the name prefix isn't set.
binaries.getExecutable("bar", "DEBUG") // You also can use a string for build type.

// Similar getters are available for other binary kinds:
// getFramework, getStaticLib and getSharedLib.

// Returns null if there is no such a binary.
binaries.findExecutable("foo", DEBUG)

// Similar getters are available for other binary kinds:
// findFramework, findStaticLib and findSharedLib.
</code></pre>
</div>
</div>
<blockquote class="note">
<p>Before 1.3.40, both test and product executables were represented by the same binary type. Thus to access the default test binary created by the plugin, the following line was used:</p>
<pre><code>binaries.getExecutable("test", "DEBUG")
</code></pre>
<p>Since 1.3.40, test executables are represented by a separate binary type and have their own getter. To access the default test binary, use:</p>
<pre><code>binaries.getTest("DEBUG")
</code></pre>
</blockquote>
<h4 id="configuring-binaries">Configuring binaries</h4>
<p>Binaries have a set of properties allowing one to configure them. The following options are available:</p>
<ul>
<li><strong>Compilation.</strong> Each binary is built on basis of some compilation available in the same target. The default value of this parameter depends
 on the binary type: <code>Test</code> binaries are based on the <code>test</code> compilation while other binaries - on the <code>main</code> compilation.</li>
<li><strong>Linker options.</strong> Options passed to a system linker during binary building. One can use this setting for linking against some native library.</li>
<li><strong>Output file name.</strong> By default the output file name is based on binary name prefix or, if the name prefix isn't specified, on a project name.
 But it's possible to configure the output file name independently using the <code>baseName</code> property. Note that final file name will be formed
 by adding system-dependent prefix and postfix to this base name. E.g. a <code>libfoo.so</code> is produced for a Linux shared library with the base name <code>foo</code>.</li>
<li><strong>Entry point</strong> (for executable binaries only). By default the entry point for Kotlin/Native programs is a <code>main</code> function located in the root
 package. This setting allows one to change this default and use a custom function as an entry point. For example it can be used to move the <code>main</code>
 function from the root package.</li>
<li><strong>Access to the output file.</strong></li>
<li><strong>Access to a link task.</strong></li>
<li><strong>Access to a run task</strong> (for executable binaries only). The <code>kotlin-multiplatform</code> plugin creates run tasks for all executable binaries of host
 platforms (Windows, Linux and macOS). Names of such tasks are based on binary names, e.g. <code>runReleaseExecutable&lt;target-name&gt;</code>
 or <code>runFooDebugExecutable&lt;target-name&gt;</code>. A run task can be accessed using the <code>runTask</code> property of an executable binary.</li>
<li><strong>Framework type</strong> (only for Objective-C frameworks). By default a framework built by Kotlin/Native contains a dynamic library. But it's possible
 to replace it with a static library.</li>
</ul>
<p>The following example shows how to use these settings.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable('my_executable', [RELEASE]) {
        // Build a binary on the basis of the test compilation.
        compilation = compilations.test

        // Custom command line options for the linker.
        linkerOpts = ['-L/lib/search/path', '-L/another/search/path', '-lmylib']

        // Base name for the output file.
        baseName = 'foo'

        // Custom entry point function.
        entryPoint = 'org.example.main'

        // Accessing the output file.
        println("Executable path: ${outputFile.absolutePath}")

        // Accessing the link task.
        linkTask.dependsOn(additionalPreprocessingTask)

        // Accessing the run task.
        // Note that the runTask is null for non-host platforms.
        runTask?.dependsOn(prepareForRun)
    }

    framework('my_framework' [RELEASE]) {
        // Include a static library instead of a dynamic one into the framework.
        isStatic = true
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable("my_executable", listOf(RELEASE)) {
        // Build a binary on the basis of the test compilation.
        compilation = compilations["test"]

        // Custom command line options for the linker.
        linkerOpts = mutableListOf("-L/lib/search/path", "-L/another/search/path", "-lmylib")

        // Base name for the output file.
        baseName = "foo"

        // Custom entry point function.
        entryPoint = "org.example.main"

        // Accessing the output file.
        println("Executable path: ${outputFile.absolutePath}")

        // Accessing the link task.
        linkTask.dependsOn(additionalPreprocessingTask)

        // Accessing the run task.
        // Note that the runTask is null for non-host platforms.
        runTask?.dependsOn(prepareForRun)
    }

    framework("my_framework" listOf(RELEASE)) {
        // Include a static library instead of a dynamic one into the framework.
        isStatic = true
    }
}
</code></pre>
</div>
</div>
<h4 id="exporting-dependencies-to-binaries">Exporting dependencies to binaries</h4>
<p>When building an Objective-C framework or a native library (shared or static), it is often necessary to pack not just the
classes of the current project, but also the classes of some of its dependencies. The Binaries DSL allows one to specify
which dependencies will be exported to a binary using the <code>export</code> method. Note that only API dependencies of a corresponding source set can be exported.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        macosMain.dependencies {
            // Will be exported.
            api project(':dependency')
            api 'org.example:exported-library:1.0'

            // Will not be exported.
            api 'org.example:not-exported-library:1.0'
        }
    }

    macosX64("macos").binaries {
        framework {
            export project(':dependency')
            export 'org.example:exported-library:1.0'
        }

        sharedLib {
            // It's possible to export different sets of dependencies to different binaries.
            export project(':dependency')
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        macosMain.dependencies {
            // Will be exported.
            api(project(":dependency"))
            api("org.example:exported-library:1.0")

            // Will not be exported.
            api("org.example:not-exported-library:1.0")
        }
    }

    macosX64("macos").binaries {
        framework {
            export(project(":dependency"))
            export("org.example:exported-library:1.0")
        }

        sharedLib {
            // It's possible to export different sets of dependencies to different binaries.
            export(project(':dependency'))
        }
    }
}
</code></pre>
</div>
</div>
<blockquote>
<p>As shown in this example, maven dependency also can be exported. But due to current limitations of Gradle metadata such a dependency
should be either a platform one (e.g. <code>kotlinx-coroutines-core-native_debug_macos_x64</code> instead of <code>kotlinx-coroutines-core-native</code>)
or be exported transitively (see below).</p>
</blockquote>
<p>By default, export works non-transitively. If a library <code>foo</code> depending on library <code>bar</code> is exported, only methods of <code>foo</code> will
be added in the output framework. This behaviour can be changed by the <code>transitiveExport</code> flag.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    framework {
        export project(':dependency')
        // Export transitively.
        transitiveExport = true
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    framework {
        export(project(":dependency"))
        // Export transitively.
        transitiveExport = true
    }
}
</code></pre>
</div>
</div>
<h4 id="building-universal-frameworks">Building universal frameworks</h4>
<p>By default, an Objective-C framework produced by Kotlin/Native supports only one platform. However, such frameworks can be merged
into a single universal (fat) binary using the <code>lipo</code> utility. Particularly, such an operation makes sense for 32-bit and 64-bit iOS
frameworks. In this case the resulting universal framework can be used on both 32-bit and 64-bit devices.</p>
<p>The Gradle plugin provides a separate task that creates a universal framework for iOS targets from several regular ones.
The example below shows how to use this task. Note that the fat framework must have the same base name as the initial frameworks.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">import org.jetbrains.kotlin.gradle.tasks.FatFrameworkTask

kotlin {
    // Create and configure the targets.
    targets {
        iosArm32("ios32")
        iosArm64("ios64")

        configure([ios32, ios64]) {
            binaries.framework {
                baseName = "my_framework"
            }
        }
    }

    // Create a task building a fat framework.
    task debugFatFramework(type: FatFrameworkTask) {
        // The fat framework must have the same base name as the initial frameworks.
        baseName = "my_framework"

        // The default destination directory is '&lt;build directory&gt;/fat-framework'.
        destinationDir = file("$buildDir/fat-framework/debug")

        // Specify the frameworks to be merged.
        from(
            targets.ios32.binaries.getFramework("DEBUG"),
            targets.ios64.binaries.getFramework("DEBUG")
        )
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">import org.jetbrains.kotlin.gradle.tasks.FatFrameworkTask

kotlin {
    // Create and configure the targets.
    val ios32 = iosArm32("ios32")
    val ios64 = iosArm64("ios64")

    configure(listOf(ios32, ios64)) {
        binaries.framework {
            baseName = "my_framework"
        }
    }

    // Create a task building a fat framework.
    tasks.create("debugFatFramework", FatFrameworkTask::class) {
        // The fat framework must have the same base name as the initial frameworks.
        baseName = "my_framework"

        // The default destination directory is '&lt;build directory&gt;/fat-framework'.
        destinationDir = buildDir.resolve("fat-framework/debug")

        // Specify the frameworks to be merged.
        from(
            ios32.binaries.getFramework("DEBUG"),
            ios64.binaries.getFramework("DEBUG")
        )
    }
}
</code></pre>
</div>
</div>
<h3 id="cinterop-support">CInterop support</h3>
<p>Since Kotlin/Native provides <a href="native/c_interop.html">interoperability with native languages</a>,
there is a DSL allowing one to configure this feature for a specific compilation.</p>
<p>A compilation can interact with several native libraries. Interoperability with each of them can be configured in
the <code>cinterops</code> block of the compilation:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    linuxX64 { // Replace with a target you need.
        compilations.main {
            cinterops {
                myInterop {
                    // Def-file describing the native API.
                    // The default path is src/nativeInterop/cinterop/&lt;interop-name&gt;.def
                    defFile project.file("def-file.def")

                    // Package to place the Kotlin API generated.
                    packageName 'org.sample'

                    // Options to be passed to compiler by cinterop tool.
                    compilerOpts '-Ipath/to/headers'

                    // Directories for header search (an analogue of the -I&lt;path&gt; compiler option).
                    includeDirs.allHeaders("path1", "path2")

                    // Additional directories to search headers listed in the 'headerFilter' def-file option.
                    // -headerFilterAdditionalSearchPrefix command line option analogue.
                    includeDirs.headerFilterOnly("path1", "path2")

                    // A shortcut for includeDirs.allHeaders.
                    includeDirs("include/directory", "another/directory")
                }

                anotherInterop { /* …… */ }
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    linuxX64 {  // Replace with a target you need.
        compilations.getByName("main") {
            val myInterop by cinterops.creating {
                // Def-file describing the native API.
                // The default path is src/nativeInterop/cinterop/&lt;interop-name&gt;.def
                defFile(project.file("def-file.def"))

                // Package to place the Kotlin API generated.
                packageName("org.sample")

                // Options to be passed to compiler by cinterop tool.
                compilerOpts("-Ipath/to/headers")

                // Directories to look for headers.
                includeDirs.apply {
                    // Directories for header search (an analogue of the -I&lt;path&gt; compiler option).
                    allHeaders("path1", "path2")

                    // Additional directories to search headers listed in the 'headerFilter' def-file option.
                    // -headerFilterAdditionalSearchPrefix command line option analogue.
                    headerFilterOnly("path1", "path2")
                }
                // A shortcut for includeDirs.allHeaders.
                includeDirs("include/directory", "another/directory")
            }

            val anotherInterop by cinterops.creating { /* …… */ }
        }
    }
}

</code></pre>
</div>
</div>
<p>Often it's necessary to specify target-specific linker options for a binary which uses a native library. It can by done
using the <code>linkerOpts</code> property of the binary. See the <a href="#configuring-binaries">Configuring binaries</a> section for details.</p>

        </article>
    </div>
        </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">
            <ul class="terms-social">
                <li class="terms-social__item terms-social__item_blog">
                    <a target="_blank" class="link" href="http://blog.jetbrains.com/kotlin">博客</a>
                </li>
                <li class="terms-social__item terms-social__item_forum">
                    <a target="_blank" class="link" href="https://discuss.kotlinlang.org">论坛</a>
                </li>
                <li class="terms-social__item terms-social__item_bug-tracker">
                    <a target="_blank" class="link" href="https://youtrack.jetbrains.com/issues/KT">问题跟踪</a>
                </li>
                <li class="terms-social__item terms-social__item_github">
                    <a target="_blank" class="link" href="https://github.com/JetBrains/kotlin">Github</a>
                </li>
                <li class="terms-social__item terms-social__item_twitter">
                    <a target="_blank" class="link" href="https://twitter.com/kotlin">Twitter</a>
                </li>
            </ul>
            <div class="global-footer-container">
                <div class="global-footer-row">
                        <p class="terms-para"><a class="terms-kit"
                              href="/contribute.html">为 Kotlin 做贡献</a></p>
                        <p class="terms-para"><a class="terms-kit"
                              href=/assets/kotlin-media-kit.pdf>宣传资料</a></p>
                    <div class="terms-copyright">
                        采用 <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache
                        2
                        授权许可</a>
                    </div>

                    <div class="terms-foundation">
                        Kotlin 商标受 <a
                            href="/foundation/kotlin-foundation.html">Kotlin 基金会</a>保护
                    </div>
                </div>
                <div class="global-footer-row">
                    <div class="terms-sponsor">
                        由 <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains jetbrains-logo _logo-jetbrains"
                                                      target="_blank">JetBrains</a> 赞助及开发；
                        由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、
                        <a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a>、
                        <a href="https://github.com/qiaoyuang" class="testimonial-company-link" target="_blank" rel="nofollow">Yuang Qiao</a>
                        &nbsp;<a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
                    </div>
                </div>
            </div>
        </div>
    </div>

</footer>
    <script src="/_assets/reference.js?&amp;v=f9da3703940597a05a36e798f03b0585"></script>
    <link rel="stylesheet" href="/_assets/reference.css?&amp;v=f414e05382b5610c35f35ce50b245906">
<div class="search-popup _hidden" tabindex="1000">
    <div class="search-popup__content">
        <div class="search-popup__controls">
            <div class="search-popup__input"></div>
            <div class="search-popup__close">
                <div class="search-popup__close-icon-wrapper">
                    <div class="search-popup__close-icon"></div>
                </div>
                <div class="search-popup__close-text">esc</div>
            </div>
        </div>
        <div class="search-popup__results"></div>
    </div>
</div></body>
</html>