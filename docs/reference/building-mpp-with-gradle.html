<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5W8DZRW');</script>
<!-- End Google Tag Manager -->

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content=""/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/reference/building-mpp-with-gradle.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->

    <title>使用 Gradle 构建多平台项目 - Kotlin 语言中文站</title>

    <script src="/_assets/common.js"></script>
    <link rel="stylesheet" href="/_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5W8DZRW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

    <div class="global-header-panel banner-nav">
        <div class="g-layout">
<div class="global-nav banner-container">
    <a class="banner-text" href="https://kotlinconf.com/registration" target="_blank">
        <div class="banner-item title">
           KotlinConf 直播
        </div>
        <div class="banner-item underline">
            注册
        </div>
    </a>
    <div class="close-head-banner"></div>
</div>        </div>
    </div>
<header class="global-header">
    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav class="global-nav">
    <div class="nav-links">
            <a href="https://www.kotliner.cn/" class="nav-item">
                博客
            </a>
            <a href="https://discuss.kotliner.cn/" class="nav-item">
                论坛
            </a>
            <a href="/docs/reference/" class="nav-item">
                学习
            </a>
            <a href="/community/" class="nav-item">
                社区
            </a>
            <a href="https://play.kotlinlang.org" class="nav-item">
                在线试用
            </a>
    </div>

    <div class="search-button">
        <div class="icon"></div>
    </div>
</nav>        </div>
    </div>


    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">
        <nav class="docs-nav">
                <div class="nav-item-wrap">
                        <a href="/docs/reference/" class="nav-item is_active">
                            <span class="nav-item-text">
                                参考
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/tutorials/" class="nav-item">
                            <span class="nav-item-text">
                                教程
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/books.html" class="nav-item">
                            <span class="nav-item-text">
                                图书
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/resources.html" class="nav-item">
                            <span class="nav-item-text">
                                更多资源
                            </span>
                        </a>
                </div>
        </nav>

    <div class="g-grid">

        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav class="side-tree-nav">
                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="概述">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">概述</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/server-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于服务器端开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/android-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 Android 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 JavaScript 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于原生开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/data-science-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于数据科学</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multiplatform.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew11.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.1 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew12.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.2 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.3 的新特性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="开始">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">开始</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-syntax.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本语法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/idioms.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">习惯用法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coding-conventions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="基础">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">基础</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-types.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/packages.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">包与导入</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/control-flow.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">控制流</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/returns.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">返回与跳转</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="类与对象">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">类与对象</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类与继承</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">属性与字段</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/interfaces.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">接口</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/visibility-modifiers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">可见性修饰符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/extensions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">扩展</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/data-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">数据类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sealed-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">密封类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/generics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">泛型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/nested-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">嵌套类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/enum-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">枚举类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/object-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">对象</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-aliases.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型别名</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegation.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegated-properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托属性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="函数与 Lambda 表达式">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">函数与 Lambda 表达式</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/lambdas.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Lambda 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联函数</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="集合">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">集合</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collections-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/constructing-collections.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">构造集合</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/iterators.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">迭代器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/ranges.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">区间与数列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sequences.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">序列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-transformations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-filtering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">过滤</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-plus-minus.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">加减操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-grouping.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">分组</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-parts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取集合的一部分</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-elements.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取单个元素</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-ordering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">排序</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-aggregate.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">聚合操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-write.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合写操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/list-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">List 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/set-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Set 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/map-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Map 相关操作</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="多平台程序设计">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">多平台程序设计</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/platform-specific-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台相关声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active ">
                <div class="marker"></div>
                <div class="text">以 Gradle 构建</div>
            </div>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="其他">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">其他</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multi-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">解构声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/typecasts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型检测与转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/this-expressions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">This 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/equality.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">相等性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/operator-overloading.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作符重载</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/null-safety.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">空安全</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/exceptions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/annotations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">注解</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/scope-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">作用域函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-safe-builders.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型安全的构建器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/experimental.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">实验性 API 标记</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="核心库">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">核心库</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/jvm/stdlib/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">标准库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">kotlin.test</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="参考">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">参考</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/keyword-reference.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">关键字与操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/grammar.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">语法</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Java 互操作">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Java 互操作</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 Java</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Java 中调用 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="JavaScript">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">JavaScript</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/dynamic-type.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">动态类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 JavaScript</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 中调用 Kotlin</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-modules.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 模块</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/javascript-dce.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript DCE</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="原生">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">原生</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">并发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/immutability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不可变性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/libraries.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/platform_libs.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/c_interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 C 语言互操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/objc_interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Objective-C 及 Swift 互操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/cocoapods.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">CocoaPods 集成</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/gradle_plugin.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Gradle 插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/debugging.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">调试</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="协程">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">协程</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutines-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程指南</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/basics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基础</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/cancellation-and-timeouts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取消与超时</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/composing-suspending-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">组合挂起函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutine-context-and-dispatchers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程上下文与调度器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/flow.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异步流</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/channels.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通道</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/exception-handling.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常处理与监督</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/shared-mutable-state-and-concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">共享的可变状态与并发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/select-expression.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Select 表达式（实验性的）</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="工具">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">工具</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-doc.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编写 Kotlin 代码文档</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kapt.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Kapt</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compiler-reference.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 编译器选项</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Gradle</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-maven.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Maven</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-ant.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Ant</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-osgi.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 与 OSGi</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compiler-plugins.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编译器插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/code-style-migration-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="演进">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">演进</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/kotlin-evolution.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 语言演进</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/components-stability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不同组件的稳定性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compatibility-guide-13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 1.3 的兼容性指南</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="常见问题">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">常见问题</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-java.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Java 比较</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-scala.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Scala 比较【官方已删除】</span>
            </a>
    </div>

    </div>

    </nav>


                <ul>
                  <li><a href="/docs/kotlin-docs.pdf" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/pdf/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（字大PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/epub/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（ePUB）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/mobi/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（Mobi）</span>
                  </a></li>
                </ul>
            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/reference/building-mpp-with-gradle.md"
   class="page-link-to-github"
   target="_blank"
   title="在 GitHub 上编辑本页">
        <i class="github-icon"></i>
        <span class="text">改进翻译</span>
</a>
                
<h1 id="使用-gradle-构建多平台项目">使用 Gradle 构建多平台项目</h1>
<blockquote class="note">
<p>多平台项目是 Kotlin 1.2 与 Kotlin 1.3 中的一个实验性特性。本文档中描述的所有语言<!--
-->与工具特性在未来的 Kotlin 版本中都可能会有所变化。</p>
</blockquote>
<p>本文档解释了 <a href="multiplatform.html">Kotlin 多平台项目</a>的结构，并描述了如何<!--
-->使用 Gradle 配置与构建这些项目。</p>
<h2 id="目录">目录</h2>
<ul>
<li><a href="#项目结构">项目结构</a></li>
<li><a href="#搭建一个多平台项目">搭建一个多平台项目</a></li>
<li><a href="#gradle-插件">Gradle 插件</a></li>
<li><a href="#设置目标">设置目标</a>
<ul>
<li><a href="#已支持平台">已支持平台</a></li>
<li><a href="#配置编译项">配置编译项</a></li>
</ul>
</li>
<li><a href="#配置源集">配置源集</a>
<ul>
<li><a href="#关联源集">关联源集</a></li>
<li><a href="#添加依赖">添加依赖</a></li>
<li><a href="#语言设置">语言设置</a></li>
</ul>
</li>
<li><a href="#默认项目布局">默认项目布局</a></li>
<li><a href="#运行测试">运行测试</a></li>
<li><a href="#发布多平台库">发布多平台库</a></li>
<li><a href="#jvm-目标平台中的-java-支持">JVM 目标平台中的 Java 支持</a></li>
<li><a href="#android-支持">Android 支持</a>
<ul>
<li><a href="#发布-android-库">发布 Android 库</a></li>
</ul>
</li>
<li><a href="#使用-kotlinnative-目标平台">使用 Kotlin/Native 目标平台</a>
<ul>
<li><a href="#目标快捷方式">目标快捷方式</a></li>
<li><a href="#构建最终原生二进制文件">构建最终原生二进制文件</a></li>
</ul>
</li>
</ul>
<h2 id="项目结构">项目结构</h2>
<p>Kotlin 多平台项目的布局由以下构建块构成：</p>
<ul>
<li>
<p><a href="#设置目标">目标</a>是构建的一部分，负责构建、测试<!--
-->及打包其中一个平台的完整软件。因此，多平台项目通常包含<!--
-->多个目标。</p>
</li>
<li>
<p>构建每个目标涉及一到多次编译 Kotlin 源代码。换句话说，一个目标可能有一到<!--
-->多个<a href="#配置编译项">编译项</a>。例如，一个编译项用于编译生产代码，另一个用于编译测试代码。</p>
</li>
<li>
<p>Kotlin 源代码会放到<a href="#配置源集">源集</a>中。除了 Kotlin 源文件与<!--
-->资源外，每个源集都可能有自己的依赖项。源集之间以<!--
--><em>“依赖于”</em>关系构成了层次结构。源集本身是平台无关的，但是<!--
-->如果一个源集只面向单一平台编译，那么它可能包含平台相关代码与依赖项。</p>
</li>
</ul>
<p>每个编译项都有一个默认源集，是放置该编译项的源代码与依赖项的地<!--
-->方。默认源集还用于通过<!--
-->“依赖于”关系将其他源集引到该编译项中。</p>
<p>以下是一个面向 JVM 与 JS 的项目的图示：</p>
<p><img alt="项目结构" src="/assets/images/reference/building-mpp-with-gradle/mpp-structure-default-jvm-js.png"/></p>
<p>这里有两个目标，即 <code>jvm</code> 与 <code>js</code>，每个目标都分别编译生产代码、测试代码，其中一些代码是共享的。
这种布局只是通过创建两个目标来实现的，并没有对编译项与源集进行额外配置<!--
-->：都是为相应目标<a href="#默认项目布局">默认创建</a>的。</p>
<p>在上述示例中，JVM 目标的生产源代码由其 <code>main</code> 编译项编译，其中<!--
-->包括来自 <code>jvmMain</code> 与 <code>commonMain</code>（由于<em>依赖于</em>关系）的源代码与依赖项：</p>
<p><img alt="源集与编译项" src="/assets/images/reference/building-mpp-with-gradle/mpp-one-compilation.png"/></p>
<p>这里 <code>jvmMain</code> 源集为共享的 <code>commonMain</code> 源集中的预期 API 提供了<a href="platform-specific-declarations.html">平台相关实现</a><!--
-->。这就是在平台之间灵活共享代码、
按需使用平台相关实现的方式。</p>
<p>在后续部分，会详细描述这些概念以及将其配置到项目中的 DSL。</p>
<h2 id="搭建一个多平台项目">搭建一个多平台项目</h2>
<p>可以在 IDE 的 New Project - Kotlin 对话框下选择一个多平台项目模板<!--
-->来创建一个多平台项目。</p>
<p>例如，如果选择了“Kotlin (Multiplatform Library)”，会创建一个包含三个<!--
--><a href="#设置目标">目标</a>的库项目，其中一个用于 JVM，一个用于 JS，还有一个用于您正在使用的原生平台。
这些是在 <code>build.gradle</code> <!--
-->脚本中以下列方式配置的：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.61'
}

repositories {
    mavenCentral()
}

kotlin {
    jvm() // 使用默认名称 “jvm” 创建一个 JVM 目标
    js()  // 使用名称 “js” 创建一个 JS 目标
    mingwX64("mingw") // 使用名称 “mingw” 创建一个 Windows (MinGW X64) 目标
    
    sourceSets { /* …… */ }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    kotlin("multiplatform") version "1.3.61"
}

repositories {
    mavenCentral()
}

kotlin {
    jvm() // 使用默认名称 “jvm” 创建一个 JVM 目标
    js()  // 使用名称 “js” 创建一个 JS 目标
    mingwX64("mingw") // 使用名称 “mingw” 创建一个 Windows (MinGW X64) 目标

    sourceSets { /* …… */ }
}
</code></pre>
</div>
</div>
<p>这三个目标是通过预设函数 <code>jvm()</code>、<code>js()</code> 与 <code>mingwX64()</code> 创建的，它们提供了一些<!--
--><a href="#默认项目布局">默认项目布局</a>。每个<a href="#已支持平台">已支持平台</a>都有预设的函数。</p>
<p>然后配置<a href="#配置源集">源集</a>及其<a href="#添加依赖">依赖</a>，如下所示：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins { /* …… */ }

kotlin {
    /* 省略目标声明 */

    sourceSets {
        commonMain {
            dependencies {
                implementation kotlin('stdlib-common')
            }
        }
        commonTest {
            dependencies {
                implementation kotlin('test-common')
                implementation kotlin('test-annotations-common')
            }
        }

        // 仅用于 JVM 的源码及其依赖的默认源集
        // 或者使用 jvmMain { …… }
        jvm().compilations.main.defaultSourceSet {
            dependencies {
                implementation kotlin('stdlib-jdk8')
            }
        }
        // 仅用于 JVM 的测试及其依赖
        jvm().compilations.test.defaultSourceSet {
            dependencies {
                implementation kotlin('test-junit')
            }
        }

        js().compilations.main.defaultSourceSet  { /* …… */ }
        js().compilations.test.defaultSourceSet { /* …… */ }

        mingwX64('mingw').compilations.main.defaultSourceSet { /* …… */ }
        mingwX64('mingw').compilations.test.defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins { /* …… */ }

kotlin {
    /* 省略目标声明 */

    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(kotlin("stdlib-common"))
            }
        }
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test-common"))
                implementation(kotlin("test-annotations-common"))
            }
        }

        // 仅用于 JVM 的源码及其依赖的默认源集
        jvm().compilations["main"].defaultSourceSet {
            dependencies {
                implementation(kotlin("stdlib-jdk8"))
            }
        }
        // 仅用于 JVM 的测试及其依赖
        jvm().compilations["test"].defaultSourceSet {
            dependencies {
                implementation(kotlin("test-junit"))
            }
        }

        js().compilations["main"].defaultSourceSet  { /* …… */ }
        js().compilations["test"].defaultSourceSet { /* …… */ }

        mingwX64("mingw").compilations["main"].defaultSourceSet { /* …… */ }
        mingwX64("mingw").compilations["test"].defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<p>这些在上面配置的目标的生产与测试的源码<!--
-->都有各自的<a href="#默认项目布局">默认源集名称</a>。源集 <code>commonMain</code> 与 <code>commonTest</code> 将被分别包含在所有目标的生产与测试编译项中。
需要注意的是，公共源集 <code>commonMain</code> 与 <code>commonTest</code> 的依赖使用的都是公共构件，而<!--
-->平台库将转到特定目标的源集。</p>
<h2 id="gradle-插件">Gradle 插件</h2>
<p>Kotlin 多平台项目需要 Gradle 4.7 及以上版本，不支持旧版本的 Gradle。</p>
<p>如需在 Gradle 项目中从头开始设置多平台项目，首先要将
<code>kotlin-multiplatform</code> 插件应用到项目中，即在
<code>build.gradle</code> 文件的开头添加以下内容：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.61'
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    kotlin("multiplatform") version "1.3.61"
}
</code></pre>
</div>
</div>
<p>这会在顶层创建 <code>kotlin</code> 扩展。然后可以在构建脚本中访问该扩展，来：</p>
<ul>
<li>为多个平台<a href="#设置目标">设置目标</a>（默认不会创建目标）；</li>
<li><a href="#配置源集">配置源集</a>及其<a href="#添加依赖">依赖</a>；</li>
</ul>
<h2 id="设置目标">设置目标</h2>
<p>目标构建的一部分，负责编译，测试与打包针对<!--
-->一个<a href="#已支持平台">已支持平台</a>的软件。</p>
<p>所有的目标可能共享一些源代码，也可能拥有平台专用的源代码。</p>
<p>由于平台的不同，目标也以不同的方式构建，并且拥有各个平台专用的<!--
-->设置。Gradle 插件捆绑了一些已支持平台的预设。</p>
<p>要创建一个目标，请使用其中一个预设函数，这些预置函数根据目标平台命名，并可选择<!--
-->接收一个目标名称与一个配置代码块：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() // 用默认名称 “jvm” 创建一个 JVM 目标
    js("nodeJs") // 用自定义名称 “nodeJs” 创建一个 JS 目标
        
    linuxX64("linux") {
        /* 在此处指定 “linux” 的其他设置 */
    }
}
</code></pre>
</div>
<p>如果存在，这些预置函数将返回一个现有的目标。这可以用于配置一个现有的目标：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    /* …… */

    // 配置 “jvm6” 目标的属性
    jvm("jvm6").attributes { /* …… */ }
}
</code></pre>
</div>
<p>注意目标平台与命名都很重要：如果一个目标作为 <code>jvm('jvm6')</code> 创建，使用 <code>jvm()</code> 将会<!--
-->创建一个单独的目标（使用默认名称 <code>jvm</code>）。如果用于创建该名称下的预设函数<!--
-->不同，将会报告一个错误。</p>
<p>从预置函数创建的目标将被添加到域对象集合 <code>kotlin.targets</code> 中，这可以用于<!--
-->通过名称访问它们或者配置所有目标：</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm()
    js("nodeJs")

    println(targets.names) // 打印：[jvm, metadata, nodeJs]

    // 配置所有的目标，包括稍后添加的目标
    targets.all {
        compilations["main"].defaultSourceSet { /* …… */ }
    }
}
</code></pre>
</div>
<p>要从动态创建或访问多个预设中的多个目标，你可以使用 <code>targetFromPreset</code> 函数，
它接收一个接收预设（那些被包含在 <code>kotlin.presets</code> 域对象集合中的），以及可选的目标名称与配置的代码块。</p>
<p>例如，要为每一个 Kotlin/Native 支持的平台（见下文）创建目标，使用以下代码：</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    presets.withType(org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTargetPreset).each {
        targetFromPreset(it) {
            /* 配置每个已创建的目标 */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">import org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTargetPreset

/* …… */

kotlin {
    presets.withType&lt;KotlinNativeTargetPreset&gt;().forEach {
        targetFromPreset(it) {
            /* 配置每个已创建的目标 */
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="已支持平台">已支持平台</h3>
<p>如上所示，对于以下目标平台，可以使用预设函数应用目标平台预设<!--
-->：</p>
<ul>
<li><code>jvm</code> 用于 Kotlin/JVM；</li>
<li><code>js</code> 用于 Kotlin/JS；</li>
<li>
<p><code>android</code> 用于 Android 应用程序与库。请注意在创建目标之前， 
 应该应用其中之一的 Android Gradle 插件；</p>
</li>
<li>
<p>Kotlin/Native 目标平台预设（参见下文<a href="#使用-kotlinnative-目标平台">备注</a>）：</p>
<ul>
<li><code>androidNativeArm32</code> 与 <code>androidNativeArm64</code> 用于 Android NDK；</li>
<li><code>iosArm32</code>、 <code>iosArm64</code>、 <code>iosX64</code> 用于 iOS；</li>
<li><code>watchosArm32</code>、 <code>watchosArm64</code>、 <code>watchosX86</code> 用于 watchOS；</li>
<li><code>tvosArm64</code>、 <code>tvosX64</code> 用于 tvOS；</li>
<li><code>linuxArm32Hfp</code>、 <code>linuxMips32</code>、 <code>linuxMipsel32</code>、 <code>linuxX64</code> 用于 Linux；</li>
<li><code>macosX64</code> 用于 MacOS；</li>
<li><code>mingwX64</code> 与 <code>mingwX86</code> 用于 Windows；</li>
<li><code>wasm32</code> 用于 WebAssembly。</li>
</ul>
<p>请注意，某些 Kotlin/Native 目标平台需要<a href="#使用-kotlinnative-目标平台">适宜的主机</a>来构建。</p>
</li>
</ul>
<p>某些目标平台可能需要附加配置。Android 与 iOS 示例请参见<!--
--><a href="/docs/tutorials/native/mpp-ios-android.html">多平台项目：iOS 与 Android</a> 教程。</p>
<h3 id="配置编译项">配置编译项</h3>
<p>Building a target requires compiling Kotlin once or multiple times. Each Kotlin compilation of a target may serve a
different purpose (e.g. production code, tests) and incorporate different <a href="#配置源集">source sets</a>.
The compilations of a target may be accessed in the DSL, for example, to get the tasks, configure
<a href="using-gradle.html#编译器选项">the Kotlin compiler options</a> or get the dependency files and compilation outputs:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm {
        compilations.main.kotlinOptions {
            // Setup the Kotlin compiler options for the 'main' compilation:
            jvmTarget = "1.8"
        }

        compilations.main.compileKotlinTask // get the Kotlin task 'compileKotlinJvm'
        compilations.main.output // get the main compilation output
        compilations.test.runtimeDependencyFiles // get the test runtime classpath
    }

    // Configure all compilations of all targets:
    targets.all {
        compilations.all {
            kotlinOptions {
                allWarningsAsErrors = true
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm {
        val main by compilations.getting {
            kotlinOptions {
                // Setup the Kotlin compiler options for the 'main' compilation:
                jvmTarget = "1.8"
            }

            compileKotlinTask // get the Kotlin task 'compileKotlinJvm'
            output // get the main compilation output
        }

        compilations["test"].runtimeDependencyFiles // get the test runtime classpath
    }

    // Configure all compilations of all targets:
    targets.all {
        compilations.all {
            kotlinOptions {
                allWarningsAsErrors = true
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>Each compilation is accompanied by a default <a href="#配置源集">source set</a>, which is created automatically
and should be used for sources and dependencies that are specific to that compilation. The default source set for a
compilation <code>foo</code> of a target <code>bar</code> has the name <code>barFoo</code>. It can also be accessed from a compilation using
<code>defaultSourceSet</code>:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() // Create a JVM target with the default name 'jvm'

    sourceSets {
        // The default source set for the 'main` compilation of the 'jvm' target:
        jvmMain {
            /* …… */
        }
    }

    // Alternatively, access it from the target's compilation:
    jvm().compilations.main.defaultSourceSet {
        /* …… */
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm() // Create a JVM target with the default name 'jvm'

    sourceSets {
        // The default source set for the 'main` compilation of the 'jvm' target:
        val jvmMain by getting {
            /* …… */
        }
    }

    // Alternatively, access it from the target's compilation:
    jvm().compilations["main"].defaultSourceSet {
        /* …… */
    }
}
</code></pre>
</div>
</div>
<p>To collect all source sets participating in a compilation, including those added via the depends-on relation, one can
use the property <code>allKotlinSourceSets</code>.</p>
<p>For some specific use cases, creating a custom compilation may be required. This can be done within the target's <code>compilations</code>
domain object collection. Note that the dependencies need to be set up manually for all custom compilations, and the
usage of a custom compilation's outputs is up to the build author. For example, consider a custom compilation for integration tests
of a <code>jvm()</code> target:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm() {
        compilations.create('integrationTest') {
            defaultSourceSet {
                dependencies {
                    def main = compilations.main
                    // Compile against the main compilation's compile classpath and outputs:
                    implementation(main.compileDependencyFiles + main.output.classesDirs)
                    implementation kotlin('test-junit')
                    /* …… */
                }
            }

            // Create a test task to run the tests produced by this compilation:
            tasks.create('jvmIntegrationTest', Test) {
                // Run the tests with the classpath containing the compile dependencies (including 'main'),
                // runtime dependencies, and the outputs of this compilation:
                classpath = compileDependencyFiles + runtimeDependencyFiles + output.allOutputs

                // Run only the tests from this compilation's outputs:
                testClassesDirs = output.classesDirs
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm() {
        compilations {
            val main by getting

            val integrationTest by compilations.creating {
                defaultSourceSet {
                    dependencies {
                        // Compile against the main compilation's compile classpath and outputs:
                        implementation(main.compileDependencyFiles + main.output.classesDirs)
                        implementation(kotlin("test-junit"))
                        /* …… */
                    }
                }

                // Create a test task to run the tests produced by this compilation:
                tasks.create&lt;Test&gt;("integrationTest") {
                    // Run the tests with the classpath containing the compile dependencies (including 'main'),
                    // runtime dependencies, and the outputs of this compilation:
                    classpath = compileDependencyFiles + runtimeDependencyFiles + output.allOutputs

                    // Run only the tests from this compilation's outputs:
                    testClassesDirs = output.classesDirs
                }
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>Also note that the default source set of a custom compilation depends on neither <code>commonMain</code> nor <code>commonTest</code> by
default.</p>
<h2 id="配置源集">配置源集</h2>
<p>A Kotlin source set is a collection of Kotlin sources, along with their resources, dependencies, and language settings,
which may take part in Kotlin compilations of one or more <a href="#设置目标">targets</a>.</p>
<p>A source set is not bound to be platform-specific or "shared"; what it's allowed to contain depends on its usage:
a source set added to multiple compilations is limited to the common language features and dependencies, while a source
set that is only used by a single target can have platform-specific dependencies, and its code may use language
features specific to that target's platform.</p>
<p>Some source sets are created and configured by default: <code>commonMain</code>, <code>commonTest</code>, and the default source sets for the
 compilations. See <a href="#默认项目布局">默认项目布局</a>.</p>
<p>The source sets are configured within a <code>sourceSets { ... }</code> block of the <code>kotlin { ... }</code> extension:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets { 
        foo { /* …… */ } // create or configure a source set by the name 'foo' 
        bar { /* …… */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val foo by creating { /* …… */ } // create a new source set by the name 'foo'
        val bar by getting { /* …… */ } // configure an existing source set by the name 'bar'
    }
}
</code></pre>
</div>
</div>
<blockquote class="note">
<p>Note: creating a source set does not link it to any target. Some source sets are <a href="#默认项目布局">predefined</a>
and thus compiled by default. However, custom source sets always need to be explicitly directed to the compilations. 
See: <a href="#关联源集">关联源集</a>.</p>
</blockquote>
<p>The source set names are case-sensitive. When referring to a default source set by its name, make sure the name prefix
matches a target's name, for example, a source set <code>iosX64Main</code> for a target <code>iosX64</code>.</p>
<p>A source set by itself is platform-agnostic, but
it can be considered platform-specific if it is only compiled for a single platform. A source set can, therefore, contain either
common code shared between the platforms or platform-specific code.</p>
<p>Each source set has a default source directory for Kotlin sources: <code>src/&lt;source set name&gt;/kotlin</code>. To add Kotlin source
directories and resources to a source set, use its <code>kotlin</code> and <code>resources</code> <code>SourceDirectorySet</code>s:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { 
    sourceSets { 
        commonMain {
            kotlin.srcDir('src')
            resources.srcDir('res')
        } 
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            kotlin.srcDir("src")
            resources.srcDir("res")
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="关联源集">关联源集</h3>
<p>Kotlin source sets may be connected with the <em>'depends on'</em> relation, so that if a source set <code>foo</code>  depends on a
source set <code>bar</code> then:</p>
<ul>
<li>
<p>whenever <code>foo</code> is compiled for a certain target, <code>bar</code> takes part in that compilation as well and is also compiled 
into the same target binary form, such as JVM class files or JS code;</p>
</li>
<li>
<p>sources of <code>foo</code> 'see' the declarations of <code>bar</code>, including the <code>internal</code> ones, and the <a href="#添加依赖">dependencies</a> of <code>bar</code>, even those
 specified as <code>implementation</code> dependencies;</p>
</li>
<li>
<p><code>foo</code> may contain <a href="platform-specific-declarations.html">platform-specific implementations</a> for the expected declarations of <code>bar</code>;</p>
</li>
<li>
<p>the resources of <code>bar</code> are always processed and copied along with the resources of <code>foo</code>;</p>
</li>
<li>
<p>the <a href="#语言设置">语言设置</a> of <code>foo</code> and <code>bar</code> should be consistent;</p>
</li>
</ul>
<p>Circular source set dependencies are prohibited.</p>
<p>The source sets DSL can be used to define these connections between the source sets:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain { /* …… */ }
        allJvm {
            dependsOn commonMain
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting { /* …… */ }
        val allJvm by creating {
            dependsOn(commonMain)
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<p>Custom source sets created in addition to the <a href="#默认项目布局">default ones</a> should be explicitly included into
 the dependencies hierarchy to be able to use declarations from other source sets and, most importantly, to take part 
 in compilations. 
Most often, they need a <code>dependsOn(commonMain)</code> or <code>dependsOn(commonTest)</code> statement, and some of the default platform-specific
 source sets should depend on the custom ones, 
 directly or indirectly:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { 
    mingwX64()
    linuxX64()

    sourceSets {
        // custom source set with tests for the two targets
        desktopTest {
            dependsOn commonTest
            /* …… */
        }
        // Make the 'windows' default test source set for depend on 'desktopTest'
        mingwX64().compilations.test.defaultSourceSet {
            dependsOn desktopTest
            /* …… */
        }
        // And do the same for the other target:
        linuxX64().compilations.test.defaultSourceSet {
            dependsOn desktopTest
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    mingwX64()
    linuxX64()

    sourceSets {
        // custom source set with tests for the two targets
        val desktopTest by creating {
            dependsOn(getByName("commonTest"))
            /* …… */
        }
        // Make the 'windows' default test source set for depend on 'desktopTest'
        mingwX64().compilations["test"].defaultSourceSet {
            dependsOn(desktopTest)
            /* …… */
        }
        // And do the same for the other target:
        linuxX64().compilations["test"].defaultSourceSet {
            dependsOn(desktopTest)
            /* …… */
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="添加依赖">添加依赖</h3>
<p>To add a dependency to a source set, use a <code>dependencies { ... }</code> block of the source sets DSL. Four kinds of dependencies
are supported:</p>
<ul>
<li>
<p><code>api</code> dependencies are used both during compilation and at runtime and are exported to library consumers. If any types
from a dependency are used in the public API of the current module, then it should be an <code>api</code> dependency;</p>
</li>
<li>
<p><code>implementation</code> dependencies are used during compilation and at runtime for the current module, but are not exposed for compilation 
of other modules depending on the one with the <code>implementation</code> dependency. The<code>implementation</code> dependency kind should be used for 
dependencies needed for the internal logic of a module. If a module is an endpoint application which is not published, it may
use <code>implementation</code> dependencies instead of <code>api</code> ones.</p>
</li>
<li>
<p><code>compileOnly</code> dependencies are only used for compilation of the current module and are available neither at runtime nor during compilation
of other modules. These dependencies should be used for APIs which have a third-party implementation available at runtime.</p>
</li>
<li>
<p><code>runtimeOnly</code> dependencies are available at runtime but are not visible during compilation of any module.</p>
</li>
</ul>
<p>Dependencies are specified per source set as follows:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            dependencies {
                api 'com.example:foo-metadata:1.0'
            }
        }
        jvm6Main {
            dependencies {
                api 'com.example:foo-jvm6:1.0'
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        val commonMain by getting {
            dependencies {
                api("com.example:foo-metadata:1.0")
            }
        }
        val jvm6Main by getting {
            dependencies {
                api("com.example:foo-jvm6:1.0")
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>Note that for the IDE to correctly analyze the dependencies of the common sources, the common source sets need to have 
corresponding dependencies on the Kotlin metadata packages in addition to the platform-specific artifact dependencies 
of the platform-specific source sets. Usually, an artifact with a suffix 
<code>-common</code> (as in <code>kotlin-stdlib-common</code>) or <code>-metadata</code> is required when using a published library (unless it is 
published with Gradle metadata, as described below).</p>
<p>However, a <code>project('...')</code> dependency on another multiplatform project is resolved to an appropriate target
automatically. It is enough to specify a single <code>project('...')</code> dependency in a source set's dependencies, 
and the compilations that include the source set will receive a corresponding platform-specific artifact of 
that project, given that it has a compatible target:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            dependencies {
                // All of the compilations that include source set 'commonMain'
                // will get this dependency resolved to a compatible target, if any:
                api project(':foo-lib')
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            dependencies {
                // All of the compilations that include source set 'commonMain'
                // will get this dependency resolved to a compatible target, if any:
                api(project(":foo-lib"))
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>Likewise, if a multiplatform library is published in the experimental <a href="#experimental-metadata-publishing-mode">Gradle metadata publishing mode</a> and the project 
is set up to consume the metadata as well, then it is enough to specify a dependency only once, for the common source set. 
Otherwise, each platform-specific source set should be 
provided with a corresponding platform module of the library, in addition to the common module, as shown above.</p>
<p>An alternative way to specify the dependencies is to use the Gradle built-in DSL at the top level with the configuration names following the 
pattern <code>&lt;sourceSetName&gt;&lt;DependencyKind&gt;</code>:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">dependencies {
    commonMainApi 'com.example:foo-common:1.0'
    jvm6MainApi 'com.example:foo-jvm6:1.0'
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">dependencies {
    "commonMainApi"("com.example:foo-common:1.0")
    "jvm6MainApi"("com.example:foo-jvm6:1.0")
}
</code></pre>
</div>
</div>
<p>Some of the Gradle built-in dependencies, like <code>gradleApi()</code>, <code>localGroovy()</code>, or <code>gradleTestKit()</code> are not available
in the source sets dependency DSL. You can, however, add them within the top-level dependency block, as shown above.</p>
<p>A dependency on a Kotlin module like <code>kotlin-stdlib</code> or <code>kotlin-reflect</code> may be added with the notation <code>kotlin("stdlib")</code>,
which is a shorthand for <code>"org.jetbrains.kotlin:kotlin-stdlib"</code>.</p>
<h3 id="语言设置">语言设置</h3>
<p>The language settings for a source set can be specified as follows:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        commonMain {
            languageSettings {
                languageVersion = '1.3' // possible values: '1.0', '1.1', '1.2', '1.3'
                apiVersion = '1.3' // possible values: '1.0', '1.1', '1.2', '1.3'
                enableLanguageFeature('InlineClasses') // language feature name
                useExperimentalAnnotation('kotlin.ExperimentalUnsignedTypes') // annotation FQ-name
                progressiveMode = true // false by default
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        val commonMain by getting {
            languageSettings.apply {
                languageVersion = "1.3" // possible values: '1.0', '1.1', '1.2', '1.3'
                apiVersion = "1.3" // possible values: '1.0', '1.1', '1.2', '1.3'
                enableLanguageFeature("InlineClasses") // language feature name
                useExperimentalAnnotation("kotlin.ExperimentalUnsignedTypes") // annotation FQ-name
                progressiveMode = true // false by default
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>It is possible to configure the language settings of all source sets at once:</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin.sourceSets.all {
    languageSettings.progressiveMode = true
}
</code></pre>
</div>
<p>Language settings of a source set affect how the sources are analyzed in the IDE. Due to the current limitations, in a
Gradle build, only the language settings of the compilation's default source set are used and are applied to all of the
sources participating in the compilation.</p>
<p>The language settings are checked for consistency between source sets depending on each other. Namely, if <code>foo</code> depends on <code>bar</code>:</p>
<ul>
<li><code>foo</code> should set <code>languageVersion</code> that is greater than or equal to that of <code>bar</code>;</li>
<li><code>foo</code> should enable all unstable language features that <code>bar</code> enables (there's no such requirement for bugfix features);</li>
<li><code>foo</code> should use all experimental annotations that <code>bar</code> uses;</li>
<li><code>apiVersion</code>, bugfix language features, and <code>progressiveMode</code> can be set arbitrarily;</li>
</ul>
<h2 id="默认项目布局">默认项目布局</h2>
<p>By default, each project contains two source sets, <code>commonMain</code> and <code>commonTest</code>, where one can place all the code that should be 
shared between all of the target platforms. These source sets are added to each production and test compilation, respectively.</p>
<p>Then, once a target is added, default compilations are created for it:</p>
<ul>
<li><code>main</code> and <code>test</code> compilations for JVM, JS, and Native targets;</li>
<li>a compilation per <a href="https://developer.android.com/studio/build/build-variants">Android build variant</a>, for Android targets;</li>
</ul>
<p>For each compilation, there is a default source set under the name composed as <code>&lt;targetName&gt;&lt;CompilationName&gt;</code>. This default source
set participates in the compilation, and thus it should be used for the platform-specific code and dependencies, and for adding other source
 sets to the compilation by the means of 'depends on'. For example, a project with
targets <code>jvm6</code> (JVM) and <code>nodeJs</code> (JS) will have source sets: <code>commonMain</code>, <code>commonTest</code>, <code>jvm6Main</code>, <code>jvm6Test</code>, <code>nodeJsMain</code>, <code>nodeJsTest</code>.</p>
<p>Numerous use cases are covered by just the default source sets and don't require custom source sets.</p>
<p>Each source set by default has its Kotlin sources under <code>src/&lt;sourceSetName&gt;/kotlin</code> directory and the resources under <code>src/&lt;sourceSetName&gt;/resources</code>.</p>
<p>In Android projects, additional Kotlin source sets are created for each <a href="https://developer.android.com/studio/build/#sourcesets">Android source set</a>.
If the Android target has a name <code>foo</code>, the Android source set <code>bar</code> gets a Kotlin source set counterpart <code>fooBar</code>.
The Kotlin compilations, however, are able to consume Kotlin sources from all of the directories <code>src/bar/java</code>,
<code>src/bar/kotlin</code>, and <code>src/fooBar/kotlin</code>. Java sources are only read from the first of these directories.</p>
<h2 id="运行测试">运行测试</h2>
<p>Running tests in a Gradle build is currently supported by default for JVM, Android, Linux, Windows and macOS; 
JS and other Kotlin/Native targets
need to be manually configured to run the tests with an appropriate environment, an emulator or a test framework.</p>
<p>A test task is created under the name <code>&lt;targetName&gt;Test</code> for each target that is suitable for testing. Run the <code>check</code> task to run 
the tests for all targets.</p>
<p>As the <code>commonTest</code> <a href="#默认项目布局">default source set</a> is added to all test compilations, tests and test tools that are needed
on all target platforms may be placed there.</p>
<p>The <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html"><code>kotlin.test</code> API</a> is available for multiplatform tests.
Add the <code>kotlin-test-common</code> and <code>kotlin-test-annotations-common</code> dependencies to <code>commonTest</code> to use the assertion
functions like <code>kotlin.test.assertTrue(...)</code>
and <code>@Test</code>/<code>@Ignore</code>/<code>@BeforeTest</code>/<code>@AfterTest</code> annotations in the common tests.</p>
<p>For JVM targets, use <code>kotlin-test-junit</code> or <code>kotlin-test-testng</code> for the corresponding asserter implementation and
annotations mapping.</p>
<p>For Kotlin/JS targets, add <code>kotlin-test-js</code> as a test dependency. At this point, test tasks for Kotlin/JS are created 
but do not run tests by default; they should be manually configured to run the tests with a JavaScript test framework.</p>
<p>Kotlin/Native targets do not require additional test dependencies, and the <code>kotlin.test</code> API implementations are built-in.</p>
<h2 id="发布多平台库">发布多平台库</h2>
<blockquote class="note">
<p>The set of target platforms is defined by a multiplatform library author, and they should provide all of the platform-specific implementations for the library. 
Adding new targets for a multiplatform library at the consumer's side is not supported.</p>
</blockquote>
<p>A library built from a multiplatform project may be published to a Maven repository with the
<a href="https://docs.gradle.org/current/userguide/publishing_maven.html"><code>maven-publish</code> Gradle plugin</a>, which can be applied as
follows:</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    /* …… */
    id("maven-publish")
}
</code></pre>
</div>
<p>A library also needs <code>group</code> and <code>version</code> to be set in the project:</p>
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins { /* …… */ }

group = "com.example.my.library"
version = "0.0.1"
</code></pre>
</div>
<p>Compared to publishing a plain Kotlin/JVM or Java project, there is no need to create publications manually
via the <code>publishing { ... }</code> DSL. The publications are automatically created for each of the targets that can be
built on the current host, except for the Android target, which needs an additional step to configure
publishing, see <a href="#发布-android-库">发布 Android 库</a>.</p>
<p>The repositories where the library will be published are added via the <code>repositories</code> block in the <code>publishing { ... }</code>
DSL, as explained in <a href="https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:repositories">Maven Publish Plugin. Repositories</a>.</p>
<p>The default artifact IDs follow the pattern <code>&lt;projectName&gt;-&lt;targetNameToLowerCase&gt;</code>, for example <code>sample-lib-nodejs</code>
for a target named <code>nodeJs</code> in a project <code>sample-lib</code>.</p>
<p>By default, a sources JAR is added to each publication in addition to its main artifact. The sources JAR contains the
sources used by the <code>main</code> compilation of the target. If you also need to publish a documentation artifact (like a
Javadoc JAR), you need to configure its build manually and add it as an artifact to the relevant publications, as shown
below.</p>
<p>Also, an additional publication under the name <code>metadata</code> is added by default which contains serialized Kotlin
declarations and is used by the IDE to analyze multiplatform libraries.
The default artifact ID of this publication is formed as <code>&lt;projectName&gt;-metadata</code>.</p>
<p>The Maven coordinates can be altered and additional artifact files may be added to the publications within the
<code>targets { ... }</code> block or the <code>publishing { ... }</code> DSL:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm('jvm6') {
        mavenPublication { // Setup the publication for the target 'jvm6'
            // The default artifactId was 'foo-jvm6', change it:
            artifactId = 'foo-jvm'
            // Add a docs JAR artifact (it should be a custom task):
            artifact(jvmDocsJar)
        }
    }
}

// Alternatively, configure the publications with the `publishing { ... }` DSL:
publishing {
    publications {
        jvm6 { /* Setup the publication for target 'jvm6' */ }
        metadata { /* Setup the publication for Kotlin metadata */ }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm("jvm6") {
        mavenPublication { // Setup the publication for the target 'jvm6'
            // The default artifactId was 'foo-jvm6', change it:
            artifactId = "foo-jvm"
            // Add a docs JAR artifact (it should be a custom task):
            artifact(jvmDocsJar)
        }
    }
}

// Alternatively, configure the publications with the `publishing { ... }` DSL:
publishing {
    publications.withType&lt;MavenPublication&gt;().apply {
        val jvm6 by getting { /* Setup the publication for target 'jvm6' */ }
        val metadata by getting { /* Setup the publication for Kotlin metadata */ }
    }
}
</code></pre>
</div>
</div>
<p>As assembling Kotlin/Native artifacts requires several builds to run on different host platforms, publishing a
multiplatform library that includes Kotlin/Native targets needs to be done with that same set of host machines. To avoid
duplicate publications of modules that can be built on more than one of the platforms
(like JVM, JS, Kotlin metadata, WebAssembly), the publishing tasks for these modules may be configured to run
conditionally.</p>
<p>This simplified example ensures that the JVM, JS, and Kotlin metadata publications are only uploaded when
<code>-PisLinux=true</code> is passed to the build in the command line:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm()
    js()
    mingwX64()
    linuxX64()

    // Note that the Kotlin metadata is here, too.
    // The mingwx64() target is automatically skipped as incompatible in Linux builds.
    configure([targets["metadata"], jvm(), js()]) {
        mavenPublication { targetPublication -&gt;
            tasks.withType(AbstractPublishToMaven)
                .matching { it.publication == targetPublication }
                .all { onlyIf { findProperty("isLinux") == "true" } }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm()
    js()
    mingwX64()
    linuxX64()

    // Note that the Kotlin metadata is here, too.
    // The mingwx64() target is automatically skipped as incompatible in Linux builds.
    configure(listOf(metadata(), jvm(), js())) {
        mavenPublication {
            val targetPublication = this@mavenPublication
            tasks.withType&lt;AbstractPublishToMaven&gt;()
                .matching { it.publication == targetPublication }
                .all { onlyIf { findProperty("isLinux") == "true" } }
        }
    }
}
</code></pre>
</div>
</div>
<h3 id="experimental-metadata-publishing-mode">Experimental metadata publishing mode</h3>
<p>Gradle module metadata provides rich publishing and dependency resolution features that are used in Kotlin
multiplatform projects to simplify dependencies configuration for build authors. In particular, the publications of a
multiplatform library may include a special 'root' module that stands for the whole library and is automatically
resolved to the appropriate platform-specific artifacts when added as a dependency, as described below.</p>
<p>In Gradle 5.3 and above, the module metadata is always used during dependency resolution, but publications don't
include any module metadata by default. To enable module metadata publishing, add
<code>enableFeaturePreview("GRADLE_METADATA")</code> to the root project's <code>settings.gradle</code> file. With older Gradle versions,
this is also required for module metadata consumption.</p>
<blockquote class="note">
<p>Note that the module metadata published by Gradle 5.3 and above cannot be read by Gradle versions older
than 5.3.</p>
</blockquote>
<p>With Gradle metadata enabled, an additional 'root' publication named <code>kotlinMultiplatform</code> is added to the project's
publications. The default artifact ID of this publication matches the project name without any additional suffix.
To configure this publication, access it via the <code>publishing { ... }</code> DSL of the <code>maven-publish</code> plugin:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin { /* …… */ }

publishing {
    publications {
        kotlinMultiplatform {
            artifactId = "foo"
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin { /* …… */ }

publishing {
    publications {
        val kotlinMultiplatform by getting {
            artifactId = "foo"
        }
    }
}
</code></pre>
</div>
</div>
<p>This publication does not include any artifacts and only references the other publications as its variants. However, it
may need the sources and documentation artifacts if that is required by the repository. In that case, add those artifacts
by using <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/publish/maven/MavenPublication.html#artifact-java.lang.Object-"><code>artifact(...)</code></a>
in the publication's scope, which is accessed as shown above.</p>
<p>If a library has a 'root' publication, the consumer may specify a single dependency on the library as a whole in a
 common source set, and a corresponding platform-specific variant will be chosen, if available, for each of the
 compilations that include this dependency. Consider a <code>sample-lib</code> library built for the JVM and JS and published with
 a 'root' publication:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    jvm('jvm6')
    js('nodeJs')

    sourceSets {
        commonMain {
            dependencies {
                // This single dependency is resolved to the appropriate target modules,
                // for example, `sample-lib-jvm6` for JVM, `sample-lib-js` for JS:
                api 'com.example:sample-lib:1.0'
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm("jvm6")
    js("nodeJs")

    sourceSets {
        val commonMain by getting {
            dependencies {
                // This single dependency is resolved to the appropriate target modules,
                // for example, `sample-lib-jvm6` for JVM, `sample-lib-js` for JS:
                api("com.example:sample-lib:1.0")
            }
        }
    }
}
</code></pre>
</div>
</div>
<p>This requires that the consumer's Gradle build can read Gradle module metadata, either using Gradle 5.3+ or explicitly
enabling it by <code>enableFeaturePreview("GRADLE_METADATA")</code> in <code>settings.gradle</code>.</p>
<h3 id="disambiguating-targets">Disambiguating targets</h3>
<p>It is possible to have more than one target for a single platform in a multiplatform library. For example, these targets
may provide the same API and differ in the libraries they cooperate with at runtime, like testing frameworks or logging solutions.</p>
<p>However, dependencies on such a multiplatform library may be ambiguous and may thus fail to resolve because there is not
enough information to decide which of the targets to choose.</p>
<p>The solution is to mark the targets with a custom attribute, which is taken into account by Gradle during dependency
resolution. This, however, must be done on both the library author and the consumer sides,
and it's the library author's responsibility to communicate the attribute and its possible values to the consumers.</p>
<p>Adding attributes is done symmetrically, to both the library and the consumer projects. For example, consider a testing
library that supports both JUnit and TestNG in the two targets. The library author needs to add an attribute to both
targets as follows:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">def testFrameworkAttribute = Attribute.of('com.example.testFramework', String)

kotlin {
    jvm('junit') {
        attributes.attribute(testFrameworkAttribute, 'junit')
    }
    jvm('testng') {
        attributes.attribute(testFrameworkAttribute, 'testng')
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val testFrameworkAttribute = Attribute.of("com.example.testFramework", String::class.java)

kotlin {
    jvm("junit") {
        attributes.attribute(testFrameworkAttribute, "junit")
    }
    jvm("testng") {
        attributes.attribute(testFrameworkAttribute, "testng")
    }
}
</code></pre>
</div>
</div>
<p>The consumer may only need to add the attribute to a single target where the ambiguity arises.</p>
<p>If the same kind of ambiguity arises when a dependency is added to a custom configuration rather than one of the
configurations created by the plugin, you can add the attributes to the configuration in the same way:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">def testFrameworkAttribute = Attribute.of('com.example.testFramework', String)

configurations {
    myConfiguration {
        attributes.attribute(testFrameworkAttribute, 'junit')
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val testFrameworkAttribute = Attribute.of("com.example.testFramework", String::class.java)

configurations {
    val myConfiguration by creating {
        attributes.attribute(testFrameworkAttribute, "junit")
    }
}
</code></pre>
</div>
</div>
<h2 id="jvm-目标平台中的-java-支持">JVM 目标平台中的 Java 支持</h2>
<p>This feature is available since Kotlin 1.3.40.</p>
<p>By default, a JVM target ignores Java sources and only compiles Kotlin source files.
To include Java sources in the compilations of a JVM target, or to apply a Gradle plugin that requires the
<code>java</code> plugin to work, you need to explicitly enable Java support for the target:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    jvm {
        withJava()
    }
}
</code></pre>
</div>
<p>This will apply the Gradle <code>java</code> plugin and configure the target to cooperate with it.
Note that just applying the Java plugin without specifying <code>withJava()</code> in a JVM
target will have no effect on the target.</p>
<p>The file system locations for the Java sources are different from  the <code>java</code> plugin's defaults.
The Java source files need to be placed in the sibling directories of the Kotlin source
roots. For example, if the JVM target has the default name <code>jvm</code>, the paths are:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>src
├── jvmMain
│   ├── java // production Java sources
│   ├── kotlin
│   └── resources
├── jvmTest
│   ├── java // test Java sources
│   ├── kotlin
…   └── resources
</code></pre>
</div>
<p>The common source sets cannot include Java sources.</p>
<p>Due to the current limitations, some tasks configured by the Java plugin are disabled, and the corresponding tasks added
by the Kotlin plugin are used instead:</p>
<ul>
<li><code>jar</code> is disabled in favor of the target's JAR task (e.g. <code>jvmJar</code>)</li>
<li><code>test</code> is disabled, and the target's test task is used (e.g. <code>jvmTest</code>)</li>
<li><code>*ProcessResources</code> tasks are disabled, and the resources are processed by the equivalent tasks of the compilations</li>
</ul>
<p>The publication of this target is handled by the Kotlin plugin and doesn't require the steps that are specific to the
Java plugin, such as manually creating a publication and configuring it as <code>from(components.java)</code>.</p>
<h2 id="android-支持">Android 支持</h2>
<p>Kotlin Multiplatform projects support the Android platform by providing the <code>android</code> preset.
Creating an Android target requires that one of the Android Gradle plugins, like <code>com.android.application</code> or
<code>com.android.library</code> is manually applied to the project. Only one Android target may be created per Gradle subproject:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">plugins {
    id("com.android.library")
    id("org.jetbrains.kotlin.multiplatform").version("1.3.61")
}

android { /* …… */ }

kotlin {
    android { // Create the Android target
        // Provide additional configuration if necessary
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">plugins {
    id("com.android.library")
    kotlin("multiplatform").version("1.3.61")
}

android { /* …… */ }

kotlin {
    android { // Create the Android target
        // Provide additional configuration if necessary
    }
}
</code></pre>
</div>
</div>
<p>An Android target's compilations created by default are tied to <a href="https://developer.android.com/studio/build/build-variants">Android build variants</a>:
for each build variant, a Kotlin compilation is created under the same name.</p>
<p>Then, for each <a href="https://developer.android.com/studio/build/build-variants#sourcesets">Android source set</a> compiled by
the variants, a Kotlin source set is created under that source set name
prepended by the target name, like Kotlin source set <code>androidDebug</code> for an Android source set <code>debug</code> and the Kotlin target
named <code>android</code>. These Kotlin source sets are added to the variants compilations accordingly.</p>
<p>The default source set <code>commonMain</code> is added to each production (application or library) variant's compilation. The
<code>commonTest</code> source set is, similarly, added to the compilations of unit test and instrumented test variants.</p>
<p>Annotation processing with <a href="/docs/reference/kapt.html">kapt</a> is also supported but, due to the current limitations,
it requires that the Android target is created before the <code>kapt</code> dependencies are configured, which needs
to be done in a top-level <code>dependencies { ... }</code> block rather than within Kotlin source sets dependencies.</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// ...

kotlin {
    android { /* …… */ }
}

dependencies {
    kapt("com.my.annotation:processor:1.0.0")
}
</code></pre>
</div>
<h3 id="发布-android-库">发布 Android 库</h3>
<p>To publish an Android library as a part of a multiplatform library, one needs to
<a href="#发布多平台库">setup publishing for the library</a> and provide additional configuration for the
Android library target.</p>
<p>By default, no artifacts of an Android library are published. To publish artifacts produced by a set of
<a href="https://developer.android.com/studio/build/build-variants">Android variants</a>, specify the variant names in the Android
target block as follows:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    android {
        publishLibraryVariants("release", "debug")
    }
}
</code></pre>
</div>
<p>The example above will work for Android libraries with no product flavors. For a library with product flavors, the
variant names also contain the flavors, like <code>fooBarDebug</code> or <code>fooBazRelease</code>.</p>
<p>Note that if a library consumer defines variants that are missing in the library, they need to provide
<a href="https://developer.android.com/studio/build/dependencies#resolve_matching_errors">matching fallbacks</a>. For example, if
a library does not have or does not publish a <code>staging</code> build type, it will be necessary to provide a fallback for the
consumers who have such a build type, specifying at least one of the build types that the library publishes:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">android {
    buildTypes {
        staging {
            // ...
            matchingFallbacks = ['release', 'debug']
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">android {
    buildTypes {
        val staging by creating {
            // ...
            matchingFallbacks = listOf("release", "debug")
        }
    }
}
</code></pre>
</div>
</div>
<p>Similarly, a library consumer may need to provide matching fallbacks for custom product flavors if some are missing in
the library publications.</p>
<p>There is an option to publish variants grouped by the product flavor, so that the outputs of the different build
types are placed in a single module, with the build type becoming a classifier for the artifacts (the release build
type is still published with no classifier). This mode is disabled by default and can be enabled as follows:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-groovy">kotlin {
    android {
        publishLibraryVariantsGroupedByFlavor = true
    }
}
</code></pre>
</div>
<p>It is not recommended to publish variants grouped by the product flavor in case they have different dependencies, as
those will be merged into one dependencies list.</p>
<h2 id="使用-kotlinnative-目标平台">使用 Kotlin/Native 目标平台</h2>
<p>It is important to note that some of the <a href="#已支持平台">Kotlin/Native targets</a> may only be built with an appropriate host machine:</p>
<ul>
<li>Linux MIPS targets (<code>linuxMips32</code> and <code>linuxMipsel32</code>) require a Linux host. Other Linux targets can be built on any supported host;</li>
<li>Windows targets require a Windows host;</li>
<li>macOS and iOS targets can only be built on a macOS host;</li>
<li>The 64-bit Android Native target require a Linux or macOS host. The 32-bit Android Native target can be built on any supported host.</li>
</ul>
<p>A target that is not supported by the current host is ignored during build and therefore not published. A library author may want to set up
builds and publishing from different hosts as required by the library target platforms.</p>
<h3 id="目标快捷方式">目标快捷方式</h3>
<p>Some native targets are often created together and use the same sources. For example, building for an iOS device and a simulator
is represented by different targets (<code>iosArm64</code> and <code>iosX64</code> respectively) but their source codes are usually the same.
A canonical way to express such shared code in the multiplatform project model is creating an intermediate
source set (<code>iosMain</code>) and configuring links between it and the platform source sets:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">sourceSets{
    iosMain {
        dependsOn(commonMain)
        iosDeviceMain.dependsOn(it)
        iosSimulatorMain.dependsOn(it)
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">val commonMain by sourceSets.getting
val iosDeviceMain by sourceSets.getting
val iosSimulatorMain by sourceSets.getting

val iosMain by sourceSets.creating {
    dependsOn(commonMain)
    iosDeviceMain.dependsOn(this)
    iosSimulatorMain.dependsOn(this)
}
</code></pre>
</div>
</div>
<p>Since 1.3.60, the <code>kotlin-multiplaform</code> plugin provides shortcuts that automate such a configuration: they let users
create a group of targets along with a common source set for them with a single DSL method.</p>
<p>The following shortcuts are available:</p>
<ul>
<li><code>ios</code> creates targets for <code>iosArm64</code> and <code>iosX64</code>.</li>
<li><code>watchos</code> creates targets for  <code>watchosArm32</code>, <code>watchosArm64</code>, and <code>watchosX86</code>.</li>
<li><code>tvos</code> creates targets for  <code>tvosArm64</code> and <code>tvosX64</code>.</li>
</ul>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// Create two targets for iOS.
// Create common source sets: iosMain and iosTest.
ios {
    // Configure targets.
    // Note: this lambda will be called for each target.
}

// You can also specify a name prefix for created targets.
// Common source sets will also have this prefix:
// anotherIosMain and anotherIosTest.
ios("anotherIos")
</code></pre>
</div>
<h3 id="构建最终原生二进制文件">构建最终原生二进制文件</h3>
<p>By default, a Kotlin/Native target is compiled down to a <code>*.klib</code> library artifact, which can be consumed by Kotlin/Native itself as a
dependency but cannot be executed or used as a native library. To declare final native binaries like executables or shared libraries a <code>binaries</code>
property of a native target is used. This property represents a collection of native binaries built for this target in addition to the
default <code>*.klib</code> artifact and provides a set of methods for declaring and configuring them.</p>
<p>Note that the <code>kotlin-multiplaform</code> plugin doesn't create any production binaries by default. The only binary available by default
is a debug executable allowing one to run tests from the <code>test</code> compilation.</p>
<h4 id="declaring-binaries">Declaring binaries</h4>
<p>A set of factory methods is used for declaring elements of the <code>binaries</code> collection. These methods allow one to specify what kinds of binaries are to be created and configure them. The following binary kinds are supported (note that not all the kinds are available for
all native platforms):</p>
<table>
<thead>
<tr>
<th><strong>Factory method</strong></th>
<th><strong>Binary kind</strong></th>
<th><strong>Available for</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>executable</code></td>
<td>a product executable</td>
<td>all native targets</td>
</tr>
<tr>
<td><code>test</code></td>
<td>a test executable</td>
<td>all native targets</td>
</tr>
<tr>
<td><code>sharedLib</code></td>
<td>a shared native library</td>
<td>all native targets except <code>wasm32</code></td>
</tr>
<tr>
<td><code>staticLib</code></td>
<td>a static native library</td>
<td>all native targets except <code>wasm32</code></td>
</tr>
<tr>
<td><code>framework</code></td>
<td>an Objective-C framework</td>
<td>macOS, iOS, watchOS, and tvOS targets only</td>
</tr>
</tbody>
</table>
<p>Each factory method exists in several versions. Consider them by example of the <code>executable</code> method. All the same versions are available
for all other factory methods.</p>
<p>The simplest version doesn't require any additional parameters and creates one binary for each build type.
Currently there a two build types available: <code>DEBUG</code> (produces a not optimized binary with a debug information) and <code>RELEASE</code> (produces
an optimized binary without debug information). Consequently the following snippet creates two executable binaries: debug and release.</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    linuxX64 { // Use your target instead.
        binaries {
            executable {
                // Binary configuration.
            }
        }
    }
}
</code></pre>
</div>
<p>A lambda expression accepted by the <code>executable</code> method in the example above is applied to each binary created and allows one to configure the binary
(see the <a href="#configuring-binaries">corresponding section</a>). Note that this lambda can be dropped if there is no need for additional configuration:</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable()
}
</code></pre>
</div>
<p>It is possible to specify which build types will be used to create binaries and which won't. In the following example only debug executable is created.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable([DEBUG]) {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable(listOf(DEBUG)) {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<p>Finally the last factory method version allows customizing the binary name.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable('foo', [DEBUG]) {
        // Binary configuration.
    }

    // It's possible to drop the list of build types (all the available build types will be used in this case).
    executable('bar') {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable("foo", listOf(DEBUG)) {
        // Binary configuration.
    }

    // It's possible to drop the list of build types (all the available build types will be used in this case).
    executable("bar") {
        // Binary configuration.
    }
}
</code></pre>
</div>
</div>
<p>The first argument in this example allows one to set a name prefix for the created binaries which is used to access them in the buildscript (see the <a href="#accessing-binaries">"Accessing binaries"</a> section).
Also this prefix is used as a default name for the binary file. For example on Windows the sample above produces files <code>foo.exe</code> and <code>bar.exe</code>.</p>
<h4 id="accessing-binaries">Accessing binaries</h4>
<p>The binaries DSL allows not only creating binaries but also accessing already created ones to configure them or get their properties
(e.g. path to an output file). The <code>binaries</code> collection implements the
<a href="https://docs.gradle.org/current/javadoc/org/gradle/api/DomainObjectSet.html"><code>DomainObjectSet</code></a> interface and provides methods like
<code>all</code> or <code>matching</code> allowing configuring groups of elements.</p>
<p>Also it's possible to get a certain element of the collection. There are two ways to do this. First, each binary has a unique
name. This name is based on the name prefix (if it's specified), build type and binary kind according to the following pattern:
<code>&lt;optional-name-prefix&gt;&lt;build-type&gt;&lt;binary-kind&gt;</code>, e.g. <code>releaseFramework</code> or <code>testDebugExecutable</code>.</p>
<blockquote>
<p>Note: static and shared libraries has suffixes <code>static</code> and <code>shared</code> respectively, e.g. <code>fooDebugStatic</code> or <code>barReleaseShared</code></p>
</blockquote>
<p>This name can be used to access the binary:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">// Fails if there is no such a binary.
binaries['fooDebugExecutable']
binaries.fooDebugExecutable
binaries.getByName('fooDebugExecutable')

 // Returns null if there is no such a binary.
binaries.findByName('fooDebugExecutable')
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// Fails if there is no such a binary.
binaries["fooDebugExecutable"]
binaries.getByName("fooDebugExecutable")

 // Returns null if there is no such a binary.
binaries.findByName("fooDebugExecutable")
</code></pre>
</div>
</div>
<p>The second way is using typed getters. These getters allow one to access a binary of a certain type by its name prefix and build type.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">// Fails if there is no such a binary.
binaries.getExecutable('foo', DEBUG)
binaries.getExecutable(DEBUG)          // Skip the first argument if the name prefix isn't set.
binaries.getExecutable('bar', 'DEBUG') // You also can use a string for build type.

// Similar getters are available for other binary kinds:
// getFramework, getStaticLib and getSharedLib.

// Returns null if there is no such a binary.
binaries.findExecutable('foo', DEBUG)

// Similar getters are available for other binary kinds:
// findFramework, findStaticLib and findSharedLib.
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">// Fails if there is no such a binary.
binaries.getExecutable("foo", DEBUG)
binaries.getExecutable(DEBUG)          // Skip the first argument if the name prefix isn't set.
binaries.getExecutable("bar", "DEBUG") // You also can use a string for build type.

// Similar getters are available for other binary kinds:
// getFramework, getStaticLib and getSharedLib.

// Returns null if there is no such a binary.
binaries.findExecutable("foo", DEBUG)

// Similar getters are available for other binary kinds:
// findFramework, findStaticLib and findSharedLib.
</code></pre>
</div>
</div>
<blockquote class="note">
<p>Before 1.3.40, both test and product executables were represented by the same binary type. Thus to access the default test binary created by the plugin, the following line was used:</p>
<pre><code>binaries.getExecutable("test", "DEBUG")
</code></pre>
<p>Since 1.3.40, test executables are represented by a separate binary type and have their own getter. To access the default test binary, use:</p>
<pre><code>binaries.getTest("DEBUG")
</code></pre>
</blockquote>
<h4 id="configuring-binaries">Configuring binaries</h4>
<p>Binaries have a set of properties allowing one to configure them. The following options are available:</p>
<ul>
<li><strong>Compilation.</strong> Each binary is built on basis of some compilation available in the same target. The default value of this parameter depends
 on the binary type: <code>Test</code> binaries are based on the <code>test</code> compilation while other binaries - on the <code>main</code> compilation.</li>
<li><strong>Linker options.</strong> Options passed to a system linker during binary building. One can use this setting for linking against some native library.</li>
<li><strong>Output file name.</strong> By default the output file name is based on binary name prefix or, if the name prefix isn't specified, on a project name.
 But it's possible to configure the output file name independently using the <code>baseName</code> property. Note that final file name will be formed
 by adding system-dependent prefix and postfix to this base name. E.g. a <code>libfoo.so</code> is produced for a Linux shared library with the base name <code>foo</code>.</li>
<li><strong>Entry point</strong> (for executable binaries only). By default the entry point for Kotlin/Native programs is a <code>main</code> function located in the root
 package. This setting allows one to change this default and use a custom function as an entry point. For example it can be used to move the <code>main</code>
 function from the root package.</li>
<li><strong>Access to the output file.</strong></li>
<li><strong>Access to a link task.</strong></li>
<li><strong>Access to a run task</strong> (for executable binaries only). The <code>kotlin-multiplatform</code> plugin creates run tasks for all executable binaries of host
 platforms (Windows, Linux and macOS). Names of such tasks are based on binary names, e.g. <code>runReleaseExecutable&lt;target-name&gt;</code>
 or <code>runFooDebugExecutable&lt;target-name&gt;</code>. A run task can be accessed using the <code>runTask</code> property of an executable binary.</li>
<li><strong>Framework type</strong> (only for Objective-C frameworks). By default a framework built by Kotlin/Native contains a dynamic library. But it's possible
 to replace it with a static library.</li>
</ul>
<p>The following example shows how to use these settings.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    executable('my_executable', [RELEASE]) {
        // Build a binary on the basis of the test compilation.
        compilation = compilations.test

        // Custom command line options for the linker.
        linkerOpts = ['-L/lib/search/path', '-L/another/search/path', '-lmylib']

        // Base name for the output file.
        baseName = 'foo'

        // Custom entry point function.
        entryPoint = 'org.example.main'

        // Accessing the output file.
        println("Executable path: ${outputFile.absolutePath}")

        // Accessing the link task.
        linkTask.dependsOn(additionalPreprocessingTask)

        // Accessing the run task.
        // Note that the runTask is null for non-host platforms.
        runTask?.dependsOn(prepareForRun)
    }

    framework('my_framework' [RELEASE]) {
        // Include a static library instead of a dynamic one into the framework.
        isStatic = true
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    executable("my_executable", listOf(RELEASE)) {
        // Build a binary on the basis of the test compilation.
        compilation = compilations["test"]

        // Custom command line options for the linker.
        linkerOpts = mutableListOf("-L/lib/search/path", "-L/another/search/path", "-lmylib")

        // Base name for the output file.
        baseName = "foo"

        // Custom entry point function.
        entryPoint = "org.example.main"

        // Accessing the output file.
        println("Executable path: ${outputFile.absolutePath}")

        // Accessing the link task.
        linkTask.dependsOn(additionalPreprocessingTask)

        // Accessing the run task.
        // Note that the runTask is null for non-host platforms.
        runTask?.dependsOn(prepareForRun)
    }

    framework("my_framework" listOf(RELEASE)) {
        // Include a static library instead of a dynamic one into the framework.
        isStatic = true
    }
}
</code></pre>
</div>
</div>
<h4 id="exporting-dependencies-in-frameworks">Exporting dependencies in frameworks</h4>
<p>When building an Objective-C framework, it is often necessary to pack not just the classes of the current project,
but also the classes of some of its dependencies. The Binaries DSL allows one to specify which dependencies will be exported
in the framework using the <code>export</code> method.  Note that only API dependencies of a corresponding source set can be exported.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    sourceSets {
        macosMain.dependencies {
            // Will be exported in the framework.
            api project(':dependency')
            api 'org.example:exported-library:1.0'

            // Will not be exported in the framework.
            api 'org.example:not-exported-library:1.0'
        }
    }

    macosX64("macos").binaries {
        framework {
            export project(':dependency')
            export 'org.example:exported-library:1.0'
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    sourceSets {
        macosMain.dependencies {
            // Will be exported in the framework.
            api(project(":dependency"))
            api("org.example:exported-library:1.0")

            // Will not be exported in the framework.
            api("org.example:not-exported-library:1.0")
        }
    }

    macosX64("macos").binaries {
        framework {
            export(project(":dependency"))
            export("org.example:exported-library:1.0")
        }
    }
}
</code></pre>
</div>
</div>
<blockquote>
<p>As shown in this example, maven dependency also can be exported. But due to current limitations of Gradle metadata such a dependency
should be either a platform one (e.g. <code>kotlinx-coroutines-core-native_debug_macos_x64</code> instead of <code>kotlinx-coroutines-core-native</code>)
or be exported transitively (see below).</p>
</blockquote>
<p>By default, export works non-transitively. If a library <code>foo</code> depending on library <code>bar</code> is exported, only methods of <code>foo</code> will
be added in the output framework. This behaviour can by changed by the <code>transitiveExport</code> flag.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">binaries {
    framework {
        export project(':dependency')
        // Export transitively.
        transitiveExport = true
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
    framework {
        export(project(":dependency"))
        // Export transitively.
        transitiveExport = true
    }
}
</code></pre>
</div>
</div>
<h4 id="building-universal-frameworks">Building universal frameworks</h4>
<p>By default, an Objective-C framework produced by Kotlin/Native supports only one platform. However, such frameworks can be merged
into a single universal (fat) binary using the <code>lipo</code> utility. Particularly, such an operation makes sense for 32-bit and 64-bit iOS
frameworks. In this case the resulting universal framework can be used on both 32-bit and 64-bit devices.</p>
<p>The Gradle plugin provides a separate task that creates a universal framework for iOS targets from several regular ones.
The example below shows how to use this task. Note that the fat framework must have the same base name as the initial frameworks.</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">import org.jetbrains.kotlin.gradle.tasks.FatFrameworkTask

kotlin {
    // Create and configure the targets.
    targets {
        iosArm32("ios32")
        iosArm64("ios64")

        configure([ios32, ios64]) {
            binaries.framework {
                baseName = "my_framework"
            }
        }
    }

    // Create a task building a fat framework.
    task debugFatFramework(type: FatFrameworkTask) {
        // The fat framework must have the same base name as the initial frameworks.
        baseName = "my_framework"

        // The default destination directory is '&lt;build directory&gt;/fat-framework'.
        destinationDir = file("$buildDir/fat-framework/debug")

        // Specify the frameworks to be merged.
        from(
            targets.ios32.binaries.getFramework("DEBUG"),
            targets.ios64.binaries.getFramework("DEBUG")
        )
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">import org.jetbrains.kotlin.gradle.tasks.FatFrameworkTask

kotlin {
    // Create and configure the targets.
    val ios32 = iosArm32("ios32")
    val ios64 = iosArm64("ios64")

    configure(listOf(ios32, ios64)) {
        binaries.framework {
            baseName = "my_framework"
        }
    }

    // Create a task building a fat framework.
    tasks.create("debugFatFramework", FatFrameworkTask::class) {
        // The fat framework must have the same base name as the initial frameworks.
        baseName = "my_framework"

        // The default destination directory is '&lt;build directory&gt;/fat-framework'.
        destinationDir = buildDir.resolve("fat-framework/debug")

        // Specify the frameworks to be merged.
        from(
            ios32.binaries.getFramework("DEBUG"),
            ios64.binaries.getFramework("DEBUG")
        )
    }
}
</code></pre>
</div>
</div>
<h3 id="cinterop-support">CInterop support</h3>
<p>Since Kotlin/Native provides <a href="native/c_interop.html">interoperability with native languages</a>,
there is a DSL allowing one to configure this feature for a specific compilation.</p>
<p>A compilation can interact with several native libraries. Interoperability with each of them can be configured in
the <code>cinterops</code> block of the compilation:</p>
<div class="multi-language-sample" data-lang="groovy">
<div class="sample" mode="groovy" theme="idea">
<pre><code class="language-groovy">kotlin {
    linuxX64 { // Replace with a target you need.
        compilations.main {
            cinterops {
                myInterop {
                    // Def-file describing the native API.
                    // The default path is src/nativeInterop/cinterop/&lt;interop-name&gt;.def
                    defFile project.file("def-file.def")

                    // Package to place the Kotlin API generated.
                    packageName 'org.sample'

                    // Options to be passed to compiler by cinterop tool.
                    compilerOpts '-Ipath/to/headers'

                    // Directories for header search (an analogue of the -I&lt;path&gt; compiler option).
                    includeDirs.allHeaders("path1", "path2")

                    // Additional directories to search headers listed in the 'headerFilter' def-file option.
                    // -headerFilterAdditionalSearchPrefix command line option analogue.
                    includeDirs.headerFilterOnly("path1", "path2")

                    // A shortcut for includeDirs.allHeaders.
                    includeDirs("include/directory", "another/directory")
                }

                anotherInterop { /* …… */ }
            }
        }
    }
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">kotlin {
    linuxX64 {  // Replace with a target you need.
        compilations.getByName("main") {
            val myInterop by cinterops.creating {
                // Def-file describing the native API.
                // The default path is src/nativeInterop/cinterop/&lt;interop-name&gt;.def
                defFile(project.file("def-file.def"))

                // Package to place the Kotlin API generated.
                packageName("org.sample")

                // Options to be passed to compiler by cinterop tool.
                compilerOpts("-Ipath/to/headers")

                // Directories to look for headers.
                includeDirs.apply {
                    // Directories for header search (an analogue of the -I&lt;path&gt; compiler option).
                    allHeaders("path1", "path2")

                    // Additional directories to search headers listed in the 'headerFilter' def-file option.
                    // -headerFilterAdditionalSearchPrefix command line option analogue.
                    headerFilterOnly("path1", "path2")
                }
                // A shortcut for includeDirs.allHeaders.
                includeDirs("include/directory", "another/directory")
            }

            val anotherInterop by cinterops.creating { /* …… */ }
        }
    }
}

</code></pre>
</div>
</div>
<p>Often it's necessary to specify target-specific linker options for a binary which uses a native library. It can by done
using the <code>linkerOpts</code> property of the binary. See the <a href="#configuring-binaries">Configuring binaries</a> section for details.</p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="global-footer-container">
                <div class="global-footer-row">
                    <div class="terms-copyright">
                        采用 <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache
                        2
                        授权许可</a>
                    </div>

                    <div class="terms-foundation">
                        Kotlin 商标受 <a
                            href="/foundation/kotlin-foundation.html">Kotlin 基金会</a>保护
                    </div>
                    <a class="terms-kit"
                            href=/assets/kotlin-media-kit.pdf>宣传资料</a>
                </div>
                <div class="global-footer-row">
                    <div class="terms-sponsor">
                        由 <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains"
                                                      target="_blank">JetBrains</a> 赞助及开发；
                        由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、
                        <a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a>、
                        <a href="https://github.com/qiaoyuang" class="testimonial-company-link" target="_blank" rel="nofollow">Yuang Qiao</a>
                        &nbsp;<a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
                    </div>
                </div>
            </div>
        </div>
    </div>

</footer>
    <script src="/_assets/reference.js"></script>
    <link rel="stylesheet" href="/_assets/reference.css">
<div class="search-popup _hidden" tabindex="1000">
    <div class="search-popup__content">
        <div class="search-popup__controls">
            <div class="search-popup__input"></div>
            <div class="search-popup__close">
                <div class="search-popup__close-icon-wrapper">
                    <div class="search-popup__close-icon"></div>
                </div>
                <div class="search-popup__close-text">esc</div>
            </div>
        </div>
        <div class="search-popup__results"></div>
    </div>
</div></body>
</html>