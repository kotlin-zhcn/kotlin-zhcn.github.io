<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5W8DZRW');</script>
<!-- End Google Tag Manager -->

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content=""/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/reference/native/c_interop.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->

    <title>与 C 语言互操作 - Kotlin 语言中文站</title>

    <script src="/_assets/common.js"></script>
    <link rel="stylesheet" href="/_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5W8DZRW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

<header class="global-header">
    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav class="global-nav">
    <div class="nav-links">
            <a href="https://www.kotliner.cn/" class="nav-item">
                博客
            </a>
            <a href="https://discuss.kotliner.cn/" class="nav-item">
                论坛
            </a>
            <a href="/docs/reference/" class="nav-item">
                学习
            </a>
            <a href="/community/" class="nav-item">
                社区
            </a>
            <a href="https://play.kotlinlang.org" class="nav-item">
                在线试用
            </a>
    </div>

    <div class="search-button">
        <div class="icon"></div>
    </div>
</nav>        </div>
    </div>


    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">
        <nav class="docs-nav">
                <div class="nav-item-wrap">
                        <a href="/docs/reference/" class="nav-item is_active">
                            <span class="nav-item-text">
                                参考
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/tutorials/" class="nav-item">
                            <span class="nav-item-text">
                                教程
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/books.html" class="nav-item">
                            <span class="nav-item-text">
                                书籍
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/resources.html" class="nav-item">
                            <span class="nav-item-text">
                                更多资源
                            </span>
                        </a>
                </div>
        </nav>

    <div class="g-grid">

        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav class="side-tree-nav">
                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="概述">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">概述</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/server-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于服务器端开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/android-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 Android 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于 JavaScript 开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 用于原生开发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multiplatform.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew11.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.1 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew12.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.2 的新特性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/whatsnew13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">1.3 的新特性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="开始">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">开始</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-syntax.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基础语法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/idioms.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">习惯用法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coding-conventions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="基础">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">基础</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/basic-types.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/packages.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">包与导入</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/control-flow.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">控制流</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/returns.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">返回与跳转</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="类与对象">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">类与对象</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类与继承</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">属性与字段</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/interfaces.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">接口</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/visibility-modifiers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">可见性修饰符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/extensions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">扩展</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/data-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">数据类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sealed-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">密封类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/generics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">泛型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/nested-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">嵌套类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/enum-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">枚举类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/object-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">对象</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-aliases.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型别名</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegation.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/delegated-properties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">委托属性</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="函数与 Lambda 表达式">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">函数与 Lambda 表达式</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/lambdas.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Lambda 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/inline-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">内联函数</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="集合">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">集合</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collections-overview.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/constructing-collections.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">构造集合</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/iterators.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">迭代器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/ranges.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">区间与数列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/sequences.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">序列</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作概述</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-transformations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-filtering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">过滤</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-plus-minus.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">加减操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-grouping.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">分组</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-parts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取集合的一部分</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-elements.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取单个元素</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-ordering.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">排序</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-aggregate.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">聚合操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/collection-write.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合写操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/list-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">List 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/set-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Set 相关操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/map-operations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Map 相关操作</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="多平台程序设计">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">多平台程序设计</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/platform-specific-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台相关声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/building-mpp-with-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Gradle 构建</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="其他">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">其他</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/multi-declarations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">解构声明</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/typecasts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型检查与转换</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/this-expressions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">This 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/equality.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">相等性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/operator-overloading.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">操作符重载</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/null-safety.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">空安全</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/exceptions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/annotations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">注解</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/scope-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">作用域函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/type-safe-builders.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类型安全的构建器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/experimental.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">实验性 API 标记</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="核心库">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">核心库</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/jvm/stdlib/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">标准库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">kotlin.test</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="参考">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">参考</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/keyword-reference.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">关键字与操作符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/grammar.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">语法</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Java 互操作">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Java 互操作</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 Java</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/java-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Java 中调用 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="JavaScript">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">JavaScript</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/dynamic-type.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">动态类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 中调用 JavaScript</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-to-kotlin-interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 中调用 Kotlin</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-modules.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 模块</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/js-reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript 反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/javascript-dce.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JavaScript DCE</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="原生">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">原生</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">并发</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/immutability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不可变性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/libraries.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/platform_libs.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">平台库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active ">
                <div class="marker"></div>
                <div class="text">与 C 语言互操作</div>
            </div>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/objc_interop.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Objective-C 及 Swift 互操作</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/cocoapods.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">CocoaPods 集成</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/gradle_plugin.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Gradle 插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/debugging.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">调试</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/native/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="协程">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">协程</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutines-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程指南</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/basics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基础</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/cancellation-and-timeouts.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">取消与超时</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/channels.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通道</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/composing-suspending-functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">组合挂起函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/coroutine-context-and-dispatchers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程上下文与调度器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/exception-handling.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常处理</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/select-expression.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Select 表达式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/coroutines/shared-mutable-state-and-concurrency.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">共享的可变状态与并发</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="工具">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">工具</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-doc.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编写 Kotlin 代码文档</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kapt.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Kapt</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Gradle</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-maven.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Maven</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/using-ant.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用 Ant</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/kotlin-osgi.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 与 OSGi</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compiler-plugins.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编译器插件</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/code-style-migration-guide.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编码规范</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="演进">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">演进</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/kotlin-evolution.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 语言演进</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/evolution/components-stability.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">不同组件的稳定性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/compatibility-guide-13.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 1.3 的兼容性指南</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="常见问题">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">常见问题</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/faq.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">FAQ</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-java.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Java 比较</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/reference/comparison-to-scala.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 Scala 比较【官方已删除】</span>
            </a>
    </div>

    </div>

    </nav>


                <ul>
                  <li><a href="/docs/kotlin-docs.pdf" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/pdf/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（字大PDF）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/epub/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（ePUB）</span>
                  </a></li>
                  <li><a href="https://www.gitbook.com/download/mobi/book/hltj/kotlin-reference-chinese" class="reference-pdf-link">
                    <span class="icon"></span>
                    <span class="text">完整 Kotlin 参考（Mobi）</span>
                  </a></li>
                </ul>
            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-native-cn.git/edit/v1.2.0-fixes/INTEROP.md"
   class="page-link-to-github"
   target="_blank"
   title="在 GitHub 上编辑本页">
        <i class="github-icon"></i>
        <span class="text">编辑本页</span>
</a>
                
<h1 id="kotlinnative-互操作"><em>Kotlin/Native</em> 互操作</h1>
<h2 id="introduction">Introduction</h2>
<p><em>Kotlin/Native</em> follows the general tradition of Kotlin to provide excellent
existing platform software interoperability. In the case of a native platform,
the most important interoperability target is a C library. So <em>Kotlin/Native</em>
comes with a <code>cinterop</code> tool, which can be used to quickly generate
everything needed to interact with an external library.</p>
<p>The following workflow is expected when interacting with the native library.</p>
<ul>
<li>create a <code>.def</code> file describing what to include into bindings</li>
<li>use the <code>cinterop</code> tool to produce Kotlin bindings</li>
<li>run <em>Kotlin/Native</em> compiler on an application to produce the final executable</li>
</ul>
<p>The interoperability tool analyses C headers and produces a "natural" mapping of
the types, functions, and constants into the Kotlin world. The generated stubs can be
imported into an IDE for the purpose of code completion and navigation.</p>
<p>Interoperability with Swift/Objective-C is provided too and covered in a
separate document <a href="objc_interop.html">OBJC_INTEROP.md</a>.</p>
<h2 id="platform-libraries">Platform libraries</h2>
<p>Note that in many cases there's no need to use custom interoperability library creation mechanisms described below,
as for APIs available on the platform standardized bindings called <a href="platform_libs.html">platform libraries</a>
could be used. For example, POSIX on Linux/macOS platforms, Win32 on Windows platform, or Apple frameworks
on macOS/iOS are available this way.</p>
<h2 id="simple-example">Simple example</h2>
<p>Install libgit2 and prepare stubs for the git library:</p>
<div class="sample" mode="shell" theme="idea">
<pre><code class="language-bash">
cd samples/gitchurn
../../dist/bin/cinterop -def src/main/c_interop/libgit2.def \
 -compilerOpts -I/usr/local/include -o libgit2
</code></pre>
</div>
<p>Compile the client:</p>
<div class="sample" mode="shell" theme="idea">
<pre><code class="language-bash">../../dist/bin/kotlinc src/main/kotlin \
 -library libgit2 -o GitChurn
</code></pre>
</div>
<p>Run the client:</p>
<div class="sample" mode="shell" theme="idea">
<pre><code class="language-bash">./GitChurn.kexe ../..
</code></pre>
</div>
<h2 id="creating-bindings-for-a-new-library">Creating bindings for a new library</h2>
<p>To create bindings for a new library, start by creating a <code>.def</code> file.
Structurally it's a simple property file, which looks like this:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">headers = png.h
headerFilter = png.h
package = png
</code></pre>
</div>
<p>Then run the <code>cinterop</code> tool with something like this (note that for host libraries that are not included
in the sysroot search paths, headers may be needed):</p>
<div class="sample" mode="shell" theme="idea">
<pre><code class="language-bash">cinterop -def png.def -compilerOpts -I/usr/local/include -o png
</code></pre>
</div>
<p>This command will produce a <code>png.klib</code> compiled library and
<code>png-build/kotlin</code> directory containing Kotlin source code for the library.</p>
<p>If the behavior for a certain platform needs to be modified, you can use a format like
<code>compilerOpts.osx</code> or <code>compilerOpts.linux</code> to provide platform-specific values
to the options.</p>
<p>Note, that the generated bindings are generally platform-specific, so if you are developing for
multiple targets, the bindings need to be regenerated.</p>
<p>After the generation of bindings, they can be used by the IDE as a proxy view of the
native library.</p>
<p>For a typical Unix library with a config script, the <code>compilerOpts</code> will likely contain
the output of a config script with the <code>--cflags</code> flag (maybe without exact paths).</p>
<p>The output of a config script with <code>--libs</code> will be passed as a <code>-linkedArgs</code> <code>kotlinc</code>
flag value (quoted) when compiling.</p>
<h3 id="selecting-library-headers">Selecting library headers</h3>
<p>When library headers are imported to a C program with the <code>#include</code> directive,
all of the headers included by these headers are also included in the program.
So all header dependencies are included in generated stubs as well.</p>
<p>This behavior is correct but it can be very inconvenient for some libraries. So
it is possible to specify in the <code>.def</code> file which of the included headers are to
be imported. The separate declarations from other headers can also be imported
in case of direct dependencies.</p>
<h4 id="filtering-headers-by-globs">Filtering headers by globs</h4>
<p>It is possible to filter headers by globs. The <code>headerFilter</code> property value
from the <code>.def</code> file is treated as a space-separated list of globs. If the
included header matches any of the globs, then the declarations from this header
are included into the bindings.</p>
<p>The globs are applied to the header paths relative to the appropriate include
path elements, e.g. <code>time.h</code> or <code>curl/curl.h</code>. So if the library is usually
included with <code>#include &lt;SomeLibrary/Header.h&gt;</code>, then it would probably be
correct to filter headers with</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">headerFilter = SomeLibrary/**
</code></pre>
</div>
<p>If a <code>headerFilter</code> is not specified, then all headers are included.</p>
<h4 id="filtering-by-module-maps">Filtering by module maps</h4>
<p>Some libraries have proper <code>module.modulemap</code> or <code>module.map</code> files in its
headers. For example, macOS and iOS system libraries and frameworks do.
The <a href="https://clang.llvm.org/docs/Modules.html#module-map-language">module map file</a>
describes the correspondence between header files and modules. When the module
maps are available, the headers from the modules that are not included directly
can be filtered out using the experimental <code>excludeDependentModules</code> option of the
<code>.def</code> file:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">headers = OpenGL/gl.h OpenGL/glu.h GLUT/glut.h
compilerOpts = -framework OpenGL -framework GLUT
excludeDependentModules = true
</code></pre>
</div>
<p>When both <code>excludeDependentModules</code> and <code>headerFilter</code> are used, they are
applied as an intersection.</p>
<h3 id="c-compiler-and-linker-options">C compiler and linker options</h3>
<p>Options passed to the C compiler (used to analyze headers, such as preprocessor definitions) and the linker
(used to link final executables) can be passed in the definition file as <code>compilerOpts</code> and <code>linkerOpts</code>
respectively. For example</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">compilerOpts = -DFOO=bar
linkerOpts = -lpng
</code></pre>
</div>
<p>Target-specific options, only applicable to the certain target can be specified as well, such as</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c"> compilerOpts = -DBAR=bar
 compilerOpts.linux_x64 = -DFOO=foo1
 compilerOpts.mac_x64 = -DFOO=foo2
</code></pre>
</div>
<p>and so, C headers on Linux will be analyzed with <code>-DBAR=bar -DFOO=foo1</code> and on macOS with <code>-DBAR=bar -DFOO=foo2</code>.
Note that any definition file option can have both common and the platform-specific part.</p>
<h3 id="adding-custom-declarations">Adding custom declarations</h3>
<p>Sometimes it is required to add custom C declarations to the library before
generating bindings (e.g., for <a href="#macros">macros</a>). Instead of creating an
additional header file with these declarations, you can include them directly
to the end of the <code>.def</code> file, after a separating line, containing only the
separator sequence <code>---</code>:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">headers = errno.h

---

static inline int getErrno() {
    return errno;
}
</code></pre>
</div>
<p>Note that this part of the <code>.def</code> file is treated as part of the header file, so
functions with the body should be declared as <code>static</code>.
The declarations are parsed after including the files from the <code>headers</code> list.</p>
<h3 id="including-static-library-in-your-klib">Including static library in your klib</h3>
<p>Sometimes it is more convenient to ship a static library with your product,
rather than assume it is available within the user's environment.
To include a static library into <code>.klib</code> use <code>staticLibrary</code> and <code>libraryPaths</code>
clauses. For example:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">staticLibraries = libfoo.a 
libraryPaths = /opt/local/lib /usr/local/opt/curl/lib
</code></pre>
</div>
<p>When given the above snippet the <code>cinterop</code> tool will search <code>libfoo.a</code> in 
<code>/opt/local/lib</code> and <code>/usr/local/opt/curl/lib</code>, and if it is found include the 
library binary into <code>klib</code>.</p>
<p>When using such <code>klib</code> in your program, the library is linked automatically.</p>
<h2 id="using-bindings">Using bindings</h2>
<h3 id="basic-interop-types">Basic interop types</h3>
<p>All the supported C types have corresponding representations in Kotlin:</p>
<ul>
<li>Signed, unsigned integral, and floating point types are mapped to their
Kotlin counterpart with the same width.</li>
<li>Pointers and arrays are mapped to <code>CPointer&lt;T&gt;?</code>.</li>
<li>Enums can be mapped to either Kotlin enum or integral values, depending on
heuristics and the <a href="#definition-file-hints">definition file hints</a>.</li>
<li>Structs / unions are mapped to types having fields available via the dot notation,
i.e. <code>someStructInstance.field1</code>.</li>
<li><code>typedef</code> are represented as <code>typealias</code>.</li>
</ul>
<p>Also, any C type has the Kotlin type representing the lvalue of this type,
i.e., the value located in memory rather than a simple immutable self-contained
value. Think C++ references, as a similar concept.
For structs (and <code>typedef</code>s to structs) this representation is the main one
and has the same name as the struct itself, for Kotlin enums it is named
<code>${type}Var</code>, for <code>CPointer&lt;T&gt;</code> it is <code>CPointerVar&lt;T&gt;</code>, and for most other
types it is <code>${type}Var</code>.</p>
<p>For types that have both representations, the one with a "lvalue" has a mutable
<code>.value</code> property for accessing the value.</p>
<h4 id="pointer-types">Pointer types</h4>
<p>The type argument <code>T</code> of <code>CPointer&lt;T&gt;</code> must be one of the "lvalue" types
described above, e.g., the C type <code>struct S*</code> is mapped to <code>CPointer&lt;S&gt;</code>,
<code>int8_t*</code> is mapped to <code>CPointer&lt;int_8tVar&gt;</code>, and <code>char**</code> is mapped to
<code>CPointer&lt;CPointerVar&lt;ByteVar&gt;&gt;</code>.</p>
<p>C null pointer is represented as Kotlin's <code>null</code>, and the pointer type
<code>CPointer&lt;T&gt;</code> is not nullable, but the <code>CPointer&lt;T&gt;?</code> is. The values of this
type support all the Kotlin operations related to handling <code>null</code>, e.g. <code>?:</code>, <code>?.</code>,
<code>!!</code> etc.:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val path = getenv("PATH")?.toKString() ?: ""
</code></pre>
</div>
<p>Since the arrays are also mapped to <code>CPointer&lt;T&gt;</code>, it supports the <code>[]</code> operator
for accessing values by index:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">fun shift(ptr: CPointer&lt;BytePtr&gt;, length: Int) {
    for (index in 0 .. length - 2) {
        ptr[index] = ptr[index + 1]
    }
}
</code></pre>
</div>
<p>The <code>.pointed</code> property for <code>CPointer&lt;T&gt;</code> returns the lvalue of type <code>T</code>,
pointed by this pointer. The reverse operation is <code>.ptr</code>: it takes the lvalue
and returns the pointer to it.</p>
<p><code>void*</code> is mapped to <code>COpaquePointer</code> – the special pointer type which is the
supertype for any other pointer type. So if the C function takes <code>void*</code>, then
the Kotlin binding accepts any <code>CPointer</code>.</p>
<p>Casting a pointer (including <code>COpaquePointer</code>) can be done with
<code>.reinterpret&lt;T&gt;</code>, e.g.:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val intPtr = bytePtr.reinterpret&lt;IntVar&gt;()
</code></pre>
</div>
<p>or</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val intPtr: CPointer&lt;IntVar&gt; = bytePtr.reinterpret()
</code></pre>
</div>
<p>As is with C, these reinterpret casts are unsafe and can potentially lead to
subtle memory problems in the application.</p>
<p>Also there are unsafe casts between <code>CPointer&lt;T&gt;?</code> and <code>Long</code> available,
provided by the <code>.toLong()</code> and <code>.toCPointer&lt;T&gt;()</code> extension methods:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val longValue = ptr.toLong()
val originalPtr = longValue.toCPointer&lt;T&gt;()
</code></pre>
</div>
<p>Note that if the type of the result is known from the context, the type argument
can be omitted as usual due to the type inference.</p>
<h3 id="memory-allocation">Memory allocation</h3>
<p>The native memory can be allocated using the <code>NativePlacement</code> interface, e.g.</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val byteVar = placement.alloc&lt;ByteVar&gt;()
</code></pre>
</div>
<p>or</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val bytePtr = placement.allocArray&lt;ByteVar&gt;(5)
</code></pre>
</div>
<p>The most "natural" placement is in the object <code>nativeHeap</code>.
It corresponds to allocating native memory with <code>malloc</code> and provides an additional
<code>.free()</code> operation to free allocated memory:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val buffer = nativeHeap.allocArray&lt;ByteVar&gt;(size)
&lt;use buffer&gt;
nativeHeap.free(buffer)
</code></pre>
</div>
<p>However, the lifetime of allocated memory is often bound to the lexical scope.
It is possible to define such scope with <code>memScoped { ... }</code>.
Inside the braces, the temporary placement is available as an implicit receiver,
so it is possible to allocate native memory with <code>alloc</code> and <code>allocArray</code>,
and the allocated memory will be automatically freed after leaving the scope.</p>
<p>For example, the C function returning values through pointer parameters can be
used like</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val fileSize = memScoped {
    val statBuf = alloc&lt;stat&gt;()
    val error = stat("/", statBuf.ptr)
    statBuf.st_size
}
</code></pre>
</div>
<h3 id="passing-pointers-to-bindings">Passing pointers to bindings</h3>
<p>Although C pointers are mapped to the <code>CPointer&lt;T&gt;</code> type, the C function
pointer-typed parameters are mapped to <code>CValuesRef&lt;T&gt;</code>. When passing
<code>CPointer&lt;T&gt;</code> as the value of such a parameter, it is passed to the C function as is.
However, the sequence of values can be passed instead of a pointer. In this case
the sequence is passed "by value", i.e., the C function receives the pointer to
the temporary copy of that sequence, which is valid only until the function returns.</p>
<p>The <code>CValuesRef&lt;T&gt;</code> representation of pointer parameters is designed to support
C array literals without explicit native memory allocation.
To construct the immutable self-contained sequence of C values, the following
methods are provided:</p>
<ul>
<li><code>${type}Array.toCValues()</code>, where <code>type</code> is the Kotlin primitive type</li>
<li><code>Array&lt;CPointer&lt;T&gt;?&gt;.toCValues()</code>, <code>List&lt;CPointer&lt;T&gt;?&gt;.toCValues()</code></li>
<li><code>cValuesOf(vararg elements: ${type})</code>, where <code>type</code> is a primitive or pointer</li>
</ul>
<p>For example:</p>
<p>C:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">void foo(int* elements, int count);
...
int elements[] = {1, 2, 3};
foo(elements, 3);
</code></pre>
</div>
<p>Kotlin:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">foo(cValuesOf(1, 2, 3), 3)
</code></pre>
</div>
<h3 id="working-with-the-strings">Working with the strings</h3>
<p>Unlike other pointers, the parameters of type <code>const char*</code> are represented as
a Kotlin <code>String</code>. So it is possible to pass any Kotlin string to a binding
expecting a C string.</p>
<p>There are also some tools available to convert between Kotlin and C strings
manually:</p>
<ul>
<li><code>fun CPointer&lt;ByteVar&gt;.toKString(): String</code></li>
<li>
<p><code>val String.cstr: CValuesRef&lt;ByteVar&gt;</code>.</p>
<p>To get the pointer, <code>.cstr</code> should be allocated in native memory, e.g.</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code>val cString = kotlinString.cstr.getPointer(nativeHeap)
</code></pre>
</div>
</li>
</ul>
<p>In all cases, the C string is supposed to be encoded as UTF-8.</p>
<p>To skip automatic conversion and ensure raw pointers are used in the bindings, a <code>noStringConversion</code>
statement in the <code>.def</code> file could be used, i.e.</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">noStringConversion = LoadCursorA LoadCursorW
</code></pre>
</div>
<p>This way any value of type <code>CPointer&lt;ByteVar&gt;</code> can be passed as an argument of <code>const char*</code> type.
If a Kotlin string should be passed, code like this could be used:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">memScoped {
    LoadCursorA(null, "cursor.bmp".cstr.ptr)   // for ASCII version
    LoadCursorW(null, "cursor.bmp".wcstr.ptr)  // for Unicode version
}
</code></pre>
</div>
<h3 id="scope-local-pointers">Scope-local pointers</h3>
<p>It is possible to create a scope-stable pointer of C representation of <code>CValues&lt;T&gt;</code>
instance using the <code>CValues&lt;T&gt;.ptr</code> extension property, available under <code>memScoped { ... }</code>.
It allows using the APIs which require C pointers with a lifetime bound to a certain <code>MemScope</code>. For example:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">memScoped {
    items = arrayOfNulls&lt;CPointer&lt;ITEM&gt;?&gt;(6)
    arrayOf("one", "two").forEachIndexed { index, value -&gt; items[index] = value.cstr.ptr }
    menu = new_menu("Menu".cstr.ptr, items.toCValues().ptr)
    ...
}
</code></pre>
</div>
<p>In this example, all values passed to the C API <code>new_menu()</code> have a lifetime of the innermost <code>memScope</code>
it belongs to. Once the control flow leaves the <code>memScoped</code> scope the C pointers become invalid.</p>
<h3 id="passing-and-receiving-structs-by-value">Passing and receiving structs by value</h3>
<p>When a C function takes or returns a struct / union <code>T</code> by value, the corresponding
argument type or return type is represented as <code>CValue&lt;T&gt;</code>.</p>
<p><code>CValue&lt;T&gt;</code> is an opaque type, so the structure fields cannot be accessed with
the appropriate Kotlin properties. It should be possible, if an API uses structures
as handles, but if field access is required, there are the following conversion
methods available:</p>
<ul>
<li>
<p><code>fun T.readValue(): CValue&lt;T&gt;</code>. Converts (the lvalue) <code>T</code> to a <code>CValue&lt;T&gt;</code>.
So to construct the <code>CValue&lt;T&gt;</code>, <code>T</code> can be allocated, filled, and then
converted to <code>CValue&lt;T&gt;</code>.</p>
</li>
<li>
<p><code>CValue&lt;T&gt;.useContents(block: T.() -&gt; R): R</code>. Temporarily places the
<code>CValue&lt;T&gt;</code> to memory, and then runs the passed lambda with this placed
value <code>T</code> as receiver. So to read a single field, the following code can be
used:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val fieldValue = structValue.useContents { field }
</code></pre>
</div>
</li>
</ul>
<h3 id="callbacks">Callbacks</h3>
<p>To convert a Kotlin function to a pointer to a C function,
<code>staticCFunction(::kotlinFunction)</code> can be used. It is also able to provide
the lambda instead of a function reference. The function or lambda must not
capture any values.</p>
<p>If the callback doesn't run in the main thread, it is mandatory to init the <em>Kotlin/Native</em>
runtime by calling <code>kotlin.native.initRuntimeIfNeeded()</code>.</p>
<h4 id="passing-user-data-to-callbacks">Passing user data to callbacks</h4>
<p>Often C APIs allow passing some user data to callbacks. Such data is usually
provided by the user when configuring the callback. It is passed to some C function
(or written to the struct) as e.g. <code>void*</code>.
However, references to Kotlin objects can't be directly passed to C.
So they require wrapping before configuring the callback and then unwrapping in
the callback itself, to safely swim from Kotlin to Kotlin through the C world.
Such wrapping is possible with <code>StableRef</code> class.</p>
<p>To wrap the reference:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val stableRef = StableRef.create(kotlinReference)
val voidPtr = stableRef.asCPointer()
</code></pre>
</div>
<p>where the <code>voidPtr</code> is a <code>COpaquePointer</code> and can be passed to the C function.</p>
<p>To unwrap the reference:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">val stableRef = voidPtr.asStableRef&lt;KotlinClass&gt;()
val kotlinReference = stableRef.get()
</code></pre>
</div>
<p>where <code>kotlinReference</code> is the original wrapped reference.</p>
<p>The created <code>StableRef</code> should eventually be manually disposed using
the <code>.dispose()</code> method to prevent memory leaks:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">stableRef.dispose()
</code></pre>
</div>
<p>After that it becomes invalid, so <code>voidPtr</code> can't be unwrapped anymore.</p>
<p>See the <code>samples/libcurl</code> for more details.</p>
<h3 id="macros">Macros</h3>
<p>Every C macro that expands to a constant is represented as a Kotlin property.
Other macros are not supported. However, they can be exposed manually by
wrapping them with supported declarations. E.g. function-like macro <code>FOO</code> can be
exposed as function <code>foo</code> by
<a href="#adding-custom-declarations">adding the custom declaration</a> to the library:</p>
<div class="sample" mode="c" theme="idea">
<pre><code class="language-c">headers = library/base.h

---

static inline int foo(int arg) {
    return FOO(arg);
}
</code></pre>
</div>
<h3 id="definition-file-hints">Definition file hints</h3>
<p>The <code>.def</code> file supports several options for adjusting the generated bindings.</p>
<ul>
<li>
<p><code>excludedFunctions</code> property value specifies a space-separated list of the names
of functions that should be ignored. This may be required because a function
declared in the C header is not generally guaranteed to be really callable, and
it is often hard or impossible to figure this out automatically. This option
can also be used to workaround a bug in the interop itself.</p>
</li>
<li>
<p><code>strictEnums</code> and <code>nonStrictEnums</code> properties values are space-separated
lists of the enums that should be generated as a Kotlin enum or as integral
values correspondingly. If the enum is not included into any of these lists,
then it is generated according to the heuristics.</p>
</li>
<li>
<p><code>noStringConversion</code> property value is space-separated lists of the functions whose
<code>const char*</code> parameters shall not be autoconverted as Kotlin string</p>
</li>
</ul>
<h3 id="portability">Portability</h3>
<p>Sometimes the C libraries have function parameters or struct fields of a
platform-dependent type, e.g. <code>long</code> or <code>size_t</code>. Kotlin itself doesn't provide
neither implicit integer casts nor C-style integer casts (e.g.
<code>(size_t) intValue</code>), so to make writing portable code in such cases easier,
the <code>convert</code> method is provided:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">fun ${type1}.convert&lt;${type2}&gt;(): ${type2}
</code></pre>
</div>
<p>where each of <code>type1</code> and <code>type2</code> must be an integral type, either signed or unsigned.</p>
<p><code>.convert&lt;${type}&gt;</code> has the same semantics as one of the
<code>.toByte</code>, <code>.toShort</code>, <code>.toInt</code>, <code>.toLong</code>,
<code>.toUByte</code>, <code>.toUShort</code>, <code>.toUInt</code> or <code>.toULong</code>
methods, depending on <code>type</code>.</p>
<p>The example of using <code>convert</code>:</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">fun zeroMemory(buffer: COpaquePointer, size: Int) {
    memset(buffer, 0, size.convert&lt;size_t&gt;())
}
</code></pre>
</div>
<p>Also, the type parameter can be inferred automatically and so may be omitted
in some cases.</p>
<h3 id="object-pinning">Object pinning</h3>
<p>Kotlin objects could be pinned, i.e. their position in memory is guaranteed to be stable
until unpinned, and pointers to such objects inner data could be passed to the C functions. For example</p>
<div class="sample" data-highlight-only="" theme="idea">
<pre><code class="language-kotlin">fun readData(fd: Int): String {
    val buffer = ByteArray(1024)
    buffer.usePinned { pinned -&gt;
        while (true) {
            val length = recv(fd, pinned.addressOf(0), buffer.size.convert(), 0).toInt()

            if (length &lt;= 0) {
               break
            }
            // Now `buffer` has raw data obtained from the `recv()` call.
        }
    }
}
</code></pre>
</div>
<p>Here we use service function <code>usePinned</code>, which pins an object, executes block and unpins it on normal and
exception paths.</p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="global-footer-container">
                <div class="global-footer-row">
                    <div class="terms-copyright">
                        采用 <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache
                        2
                        授权许可</a>
                    </div>

                    <div class="terms-foundation">
                        Kotlin 商标受 <a
                            href="/foundation/kotlin-foundation.html">Kotlin 基金会</a>保护
                    </div>
                    <a class="terms-kit"
                            href=/assets/kotlin-media-kit.zip>Press kit</a>
                </div>
                <div class="global-footer-row">
                    <div class="terms-sponsor">
                        由 <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains"
                                                      target="_blank">JetBrains</a> 赞助及开发；
                        由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、<a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a> &nbsp;<a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
                    </div>
                </div>

            </div>
        </div>
    </div>

</footer>
    <script src="/_assets/reference.js"></script>
    <link rel="stylesheet" href="/_assets/reference.css">
<div class="search-popup _hidden" tabindex="1000">
    <div class="search-popup__content">
        <div class="search-popup__controls">
            <div class="search-popup__input"></div>
            <div class="search-popup__close">
                <div class="search-popup__close-icon-wrapper">
                    <div class="search-popup__close-icon"></div>
                </div>
                <div class="search-popup__close-text">esc</div>
            </div>
        </div>
        <div class="search-popup__results"></div>
    </div>
</div></body>
</html>