<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5W8DZRW');</script>
<!-- End Google Tag Manager -->

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content=""/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/tutorials/native/apple-framework.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="编译 Kotlin/Native 代码并在 Objective-C 与 Swift 中使用它">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="">
    <meta name="twitter:description" content="编译 Kotlin/Native 代码并在 Objective-C 与 Swift 中使用它">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->

    <title>Kotlin/Native 开发 Apple Framework - Kotlin 语言中文站</title>

    <script src="/_assets/common.js"></script>
    <link rel="stylesheet" href="/_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5W8DZRW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

<header class="global-header">
    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav class="global-nav">
    <div class="nav-links">
            <a href="https://www.kotliner.cn/" class="nav-item">
                博客
            </a>
            <a href="https://discuss.kotliner.cn/" class="nav-item">
                论坛
            </a>
            <a href="/docs/reference/" class="nav-item">
                学习
            </a>
            <a href="/community/" class="nav-item">
                社区
            </a>
            <a href="https://play.kotlinlang.org" class="nav-item">
                在线试用
            </a>
    </div>

    <div class="search-button">
        <div class="icon"></div>
    </div>
</nav>        </div>
    </div>


    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">
        <nav class="docs-nav">
                <div class="nav-item-wrap">
                        <a href="/docs/reference/" class="nav-item">
                            <span class="nav-item-text">
                                参考
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/tutorials/" class="nav-item is_active">
                            <span class="nav-item-text">
                                教程
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/books.html" class="nav-item">
                            <span class="nav-item-text">
                                图书
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/resources.html" class="nav-item">
                            <span class="nav-item-text">
                                更多资源
                            </span>
                        </a>
                </div>
        </nav>

    <div class="g-grid">
        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav class="side-tree-nav">
                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="开始">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">开始</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/getting-started.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 IntelliJ IDEA 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/getting-started-eclipse.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Eclipse 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/command-line.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用命令行编译器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/quick-run.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">运行代码片段</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/build-tools.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用构建工具</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/koans.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">心印</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/competitive-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">竞技程序设计</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Android">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Android</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Android 开发入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/android-plugin.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin Android 扩展</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/android-frameworks.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Android 框架</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Java 互操作">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Java 互操作</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/mixing-java-kotlin-intellij.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在一个项目中混用 Java 与 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="JavaScript">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">JavaScript</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/kotlin-to-javascript/kotlin-to-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 转 JavaScript</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-gradle/getting-started-with-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Gradle 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-idea/getting-started-with-intellij-idea.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 IntelliJ IDEA 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-maven/getting-started-with-maven.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Maven 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-command-line/command-line-library-js.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用命令行编译器创建 Kotlin JavaScript 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/working-with-modules/working-with-modules.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 与 JavaScript 模块合用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/working-with-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 JavaScript 合用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/debugging-javascript/debugging-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在浏览器中调试 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="多平台项目">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">多平台项目</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/mpp/intro-to-kotlin-mpp.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台项目简介</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mpp-ios-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">iOS 与 Android</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/mpp/multiplatform-library.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台库</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="原生">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">原生</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/intro-to-kotlin-native.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin/Native 简介</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/basic-kotlin-native-app.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本 Kotlin/Native 应用程序</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-primitive-data-types-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的原始数据类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-struct-union-types-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的结构与联合类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-function-pointers-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的函数指针</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-strings-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的字符串</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/dynamic-libraries.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin/Native 开发动态库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active ">
                <div class="marker"></div>
                <div class="text">Kotlin/Native 开发 Apple Framework</div>
            </div>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/multiplatform-library.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">发布 Kotlin/Native 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/curl.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在应用中使用 C 语言互操作与 libcurl</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mpp-ios-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">构建 iOS 与 Android 应用</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="协程">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">协程</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/coroutines/async-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异步程序设计</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/coroutines/coroutines-basic-jvm.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JVM 平台的 Kotlin 协程简介</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/coroutines/intro-to-coroutines-and-channels.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">协程与通道简介</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Web 开发">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Web 开发</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/httpservlets.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">用 Http Servlets 创建 web 应用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/spring-boot-restful.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">用  Spring Boot 创建 RESTful Web 服务</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="工具">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">工具</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-and-ci.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">TeamCity 配置 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="教学">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">教学</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/edu-tools-learner.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通过 EduTools 插件学习 Kotlin</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/edu-tools-educator.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通过 EduTools 插件讲授 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="迁移自 Python">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">迁移自 Python</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/introduction.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">简介</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/hello-world.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Hello World</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/compiling-and-running.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编译与运行</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/declaring-variables.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">声明变量</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/primitive-data-types-and-their-limitations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">原生数据类型及其表示范围</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/strings.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">字符串</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/conditionals.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">条件式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/collections.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/loops.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">循环</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/exceptions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/null-safety.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">空安全</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/functional-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数式编程</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/packages-and-imports.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">包与导入</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/visibility-modifiers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">可见性修饰符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/inheritance.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">继承</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">对象与伴生对象</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/generics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">泛型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/extension-functionsproperties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">扩展函数/属性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/member-references-and-reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">成员引用与反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/annotations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">注解</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/file-io.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">文件 I/O</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/scoped-resource-usage.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">作用域内资源用法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/documentation.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编写文档</span>
            </a>
    </div>

    </div>

    </nav>

            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/tutorials/native/apple-framework.md"
   class="page-link-to-github"
   target="_blank"
   title="在 GitHub 上编辑本页">
        <i class="github-icon"></i>
        <span class="text">编辑本页</span>
</a>
            <h1>
                Kotlin/Native 开发 Apple Framework
            </h1>
            <table>
                    <tr>
                        <td>
                            <strong>作者</strong>
                        </td>
                        <td>
                            Eugene Petrenko，乔禹昂（翻译）
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>最近更新</strong>
                        </td>
                        <td>
                            2019-04-15
                        </td>
                    </tr>
            </table>
                编译 Kotlin/Native 代码并在 Objective-C 与 Swift 中使用它
                <br/>
                <br/>
            
<p>Kotlin/Native 提供与 Objective-C/Swift 的双向互操作性。
Objective-C framework 与库可以在 Kotlin 代码中使用。
Kotlin 模块同样可以在 Swift/Objective-C 代码中使用。
除此之外，Kotlin/Native 也拥有
<a href="https://github.com/JetBrains/kotlin-native/blob/master/INTEROP.md">C 互操作性</a>。
这篇 <a href="dynamic-libraries.html">Kotlin/Native 开发动态库</a><!--
-->教程包含了更多信息。</p>
<p>在本教程中，我们将看到如何在 Objective-C 与 Swift
编写的 macOS 与 iOS 应用程序中使用 Kotlin/Native 代码。
我们将使用 Kotlin 代码构建一个 framework。</p>
<p>在本教程中我们将：</p>
<ul>
<li><a href="#创建一个-kotlin-库">创建一个 Kotlin 库</a>并将它编译为 framework</li>
<li>检查生成的 <a href="#生成framework-头">Objective-C 与 Swift API</a> 代码</li>
<li>在 <a href="#在-objective-c-中使用代码">Objective-C</a> 与 <a href="#在-swift-中使用代码">Swift</a> 中使用 framework</li>
<li>为 <a href="#xcode-与-macos-目标平台">macOS</a> 与 <a href="#xcode-与-ios-目标平台">iOS</a> <a href="#xcode-and-framework-dependencies">配置 Xcode</a> 以使用 framework</li>
</ul>
<h2 id="创建一个-kotlin-库">创建一个 Kotlin 库</h2>
<p>Kotlin/Native 编译器可以使 Kotlin 代码为 macOS 与 iOS
生产一个 framework 的输出。生成的 framework 包含在 Objective-C 与 Swift
中所有使用所需的声明与二进制文件。
理解这项技术的最佳方式是自己进行一下尝试。
我们首先来创建一个小型的 Kotlin 库，并在 Objective-C 程序中使用它。</p>
<p>我们创建该 <code>hello.kt</code> 文件，并在其中编写库的内容：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">package example

object Object {
  val field = "A"
}

interface Interface {
  fun iMember() {}
}

class Clazz : Interface {
  fun member(p: Int): ULong? = 42UL
}

fun forIntegers(b: Byte, s: UShort, i: Int, l: ULong?) { }
fun forFloats(f: Float, d: Double?) { }

fun strings(str: String?) : String {
  return "That is '$str' from C"
}

fun acceptFun(f: (String) -&gt; String?) = f("Kotlin/Native rocks!")
fun supplyFun() : (String) -&gt; String? = { "$it is cool!" }
</code></pre>
</div>
<p>虽然可以使用命令行<!--
-->或直接通过将它与脚本文件（即 sh 或 bat 文件）相结合，但我们应该注意到，
对于拥有数百个文件以及库的大型项目来说，这不能很好地扩展。
所以最好使用附带构建系统的 Kotlin/Native 编译器，它可以<!--
-->帮助下载与缓存 Kotlin/Native 编译器二进制文件与库<!--
-->传递依赖，并运行编译器与测试。
Kotlin/Native 可以通过 <a href="/docs/reference/building-mpp-with-gradle.html">kotlin 多平台</a><!--
-->插件来使用 <a href="https://gradle.org">Gradle</a> 构建系统。</p>
<p><a href="basic-kotlin-native-app.html#create-gradle-project">基本 Kotlin/Native 应用程序</a><!--
-->这篇教程涵盖了使用 Gradle 创建 IDE 兼容工程的<!--
-->基础知识。如果你正在寻找关于第一步的更多细节<!--
-->以及如何开始一个新的 Kotlin/Native 项目并在 IntelliJ IDEA 中打开它的说明，则请你阅读<!--
-->这篇教程，我们将看看关于在 Kotlin/Native 中进行高级的 C 互操作的相关用法<!--
-->以及使用
<a href="/docs/reference/building-mpp-with-gradle.html">multiplatform</a><!--
-->（Kotlin 多平台插件）及 Gradle 进行构建。</p>
<p>首先，让我们创建一个工程目录。在本教程中的所有路径都是相对于这个目录的。有时<!--
-->在添加任何新文件之前，都必须创建缺少的目录。</p>
<p>我们将使用下面的
<span class="multi-language-span" data-lang="groovy">
<code>build.gradle</code>
</span>
<span class="multi-language-span" data-lang="kotlin">
<code>build.gradle.kts</code>
</span>
Gradle 构建文件并添加以下内容：</p>
<div class="multi-language-sample" data-lang="groovy" data-os="macos">
<div class="sample" data-highlight-only="" mode="groovy" theme="idea">
<pre><code>plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.21'
}

repositories {
    mavenCentral()
}

kotlin {
  macosX64("native") {
    binaries {
      framework {
        baseName = "Demo"
      }
    }
  }
}

wrapper {
  gradleVersion = "5.3.1"
  distributionType = "ALL"
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin" data-os="macos">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>plugins {
    kotlin("multiplatform") version "1.3.21"
}

repositories {
    mavenCentral()
}

kotlin {
  macosX64("native") {
    binaries {
      framework {
        baseName = "Demo"
      }
    }
  }
}

tasks.withType&lt;Wrapper&gt; {
  gradleVersion = "5.3.1"
  distributionType = Wrapper.DistributionType.ALL
}
</code></pre>
</div>
</div>
<p>已经准备好的工程源代码可以在这里直接下载：
<span class="multi-language-span" data-lang="groovy" data-os="macos">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-framework-groovy-macos-mac.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="kotlin" data-os="macos">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-framework-kotlin-macos-mac.zip">GitHub</a>.
</span></p>
<p>我们将源文件移动到工程下的
<code>src/nativeMain/kotlin</code> 文件夹。当使用 <a href="/docs/reference/building-mpp-with-gradle.html">kotlin-多平台</a><!--
-->插件的时候这是定位文件的默认路径。
使用插件。我们使用以下代码块来指示配置项目<!--
-->为我们生成动态或共享库：</p>
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
  framework {
    baseName = "Demo"
  }  
}
</code></pre>
</div>
<p><code>macOS X64</code> 是单独的，Kotlin/Native 支持 iOS <code>arm32</code>、<code>arm64</code> 与 <code>X64</code>
目标平台。我们可以使用各自的函数替代 <code>macosX64</code>，
如表所示：</p>
<table class="zebra">
<thead>
<tr>
<th>目标 平台/设备</th>
<th>Gradle 函数</th>
</tr>
</thead>
<tbody>
<tr>
<td>macOS x86_64</td>
<td><code>macosX64()</code></td>
</tr>
<tr>
<td>iOS ARM 32</td>
<td><code>iosArm32()</code></td>
</tr>
<tr>
<td>iOS ARM 64</td>
<td><code>iosArm64()</code></td>
</tr>
<tr>
<td>iOS Simulator (x86_64)</td>
<td><code>iosX64()</code></td>
</tr>
</tbody>
</table>
<p>我们运行 <code>linkNative</code> Gradle 任务，以<a href="basic-kotlin-native-app.html#run-in-ide">在 IDE 中</a><!--
-->构建该库。
或者使用如下的控制台命令：</p>
<div class="multi-language-sample" data-os="linux">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">./gradlew linkNative
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="macos">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">./gradlew linkNative
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="windows">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">gradlew.bat linkNative
</code></pre>
</div>
</div>
<p>依据配置的不同，构建生成的 framework
位于
<code>build/bin/native/debugFramework</code>
或
<code>build/bin/native/releaseFramework</code>
文件夹。
我们来看看里面是什么</p>
<h2 id="生成-framework-头文件">生成 Framework 头文件</h2>
<p>每个创建的 framework 头文件都包含在 <code>&lt;Framework&gt;/Headers/Demo.h</code> 中。
这个头文件不依赖目标平台（至少需要 Kotlin/Native v.0.9.2）。
它包含我们的 Kotlin 代码的定义与一些 Kotlin 级的声明。</p>
<p>注意，Kotlin/Native 导出符号的方式如有变更，恕不另行通知。</p>
<h3 id="kotlinnative-运行时声明">Kotlin/Native 运行时声明</h3>
<p>我们<!--
-->首先来看看 Kotlin 的运行时声明：</p>
<div auto-indent="false" class="sample" data-highlight-only="" mode="obj-c" theme="idea">
<pre><code class="language-obj-c">NS_ASSUME_NONNULL_BEGIN

@interface KotlinBase : NSObject
- (instancetype)init __attribute__((unavailable));
+ (instancetype)new __attribute__((unavailable));
+ (void)initialize __attribute__((objc_requires_super));
@end;

@interface KotlinBase (KotlinBaseCopying) &lt;NSCopying&gt;
@end;

__attribute__((objc_runtime_name("KotlinMutableSet")))
__attribute__((swift_name("KotlinMutableSet")))
@interface DemoMutableSet&lt;ObjectType&gt; : NSMutableSet&lt;ObjectType&gt;
@end;

__attribute__((objc_runtime_name("KotlinMutableDictionary")))
__attribute__((swift_name("KotlinMutableDictionary")))
@interface DemoMutableDictionary&lt;KeyType, ObjectType&gt; : NSMutableDictionary&lt;KeyType, ObjectType&gt;
@end;

@interface NSError (NSErrorKotlinException)
@property (readonly) id _Nullable kotlinException;
@end;
</code></pre>
</div>
<p>Kotlin 类在 Objective-C 中拥有一个 <code>KotlinBase</code> 基类，该类在这里继承自
<code>NSObject</code> 类。我们同样也有集合与异常的包装器。
大多数的集合类型都从另一边映射到了相似的集合类型：</p>
<table class="wide zebra">
<thead>
<tr>
<th>Kotlin</th>
<th>Swift</th>
<th>Objective-C</th>
</tr>
</thead>
<tbody>
<tr>
<td>List</td>
<td>Array</td>
<td>NSArray</td>
</tr>
<tr>
<td>MutableList</td>
<td>NSMutableArray</td>
<td>NSMutableArray</td>
</tr>
<tr>
<td>Set</td>
<td>Set</td>
<td>NSSet</td>
</tr>
<tr>
<td>Map</td>
<td>Dictionary</td>
<td>NSDictionary</td>
</tr>
<tr>
<td>MutableMap</td>
<td>NSMutableDictionary</td>
<td>NSMutableDictionary</td>
</tr>
</tbody>
</table>
<h3 id="kotlin-numbers-与-nsnumber">Kotlin Numbers 与 NSNumber</h3>
<p>下一步，<code>&lt;Framework&gt;/Headers/Demo.h</code> 包含了 Kotlin/Native 数字类型与 <code>NSNumber</code>
之间的映射。我们在 Objective-C 中拥有一个基类名为 <code>DemoNumber</code>，
而在 Swift 中是 <code>KotlinNumber</code>。它继承自 <code>NSNumber</code>。
这里有每个作为子类的 Kotlin 数字类型：</p>
<table class="wide zebra">
<thead>
<tr>
<th>Kotlin</th>
<th>Swift</th>
<th>Objective-C</th>
<th>Simple type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-</code></td>
<td><code>KotlinNumber</code></td>
<td><code>&lt;Package&gt;Number</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>Byte</code></td>
<td><code>KotlinByte</code></td>
<td><code>&lt;Package&gt;Byte</code></td>
<td><code>char</code></td>
</tr>
<tr>
<td><code>UByte</code></td>
<td><code>KotlinUByte</code></td>
<td><code>&lt;Package&gt;UByte</code></td>
<td><code>unsigned char</code></td>
</tr>
<tr>
<td><code>Short</code></td>
<td><code>KotlinShort</code></td>
<td><code>&lt;Package&gt;Short</code></td>
<td><code>short</code></td>
</tr>
<tr>
<td><code>UShort</code></td>
<td><code>KotlinUShort</code></td>
<td><code>&lt;Package&gt;UShort</code></td>
<td><code>unsigned short</code></td>
</tr>
<tr>
<td><code>Int</code></td>
<td><code>KotlinInt</code></td>
<td><code>&lt;Package&gt;Int</code></td>
<td><code>int</code></td>
</tr>
<tr>
<td><code>UInt</code></td>
<td><code>KotlinUInt</code></td>
<td><code>&lt;Package&gt;UInt</code></td>
<td><code>unsigned int</code></td>
</tr>
<tr>
<td><code>Long</code></td>
<td><code>KotlinLong</code></td>
<td><code>&lt;Package&gt;Long</code></td>
<td><code>long long</code></td>
</tr>
<tr>
<td><code>ULong</code></td>
<td><code>KotlinULong</code></td>
<td><code>&lt;Package&gt;ULong</code></td>
<td><code>unsigned long long</code></td>
</tr>
<tr>
<td><code>Float</code></td>
<td><code>KotlinFloat</code></td>
<td><code>&lt;Package&gt;Float</code></td>
<td><code>float</code></td>
</tr>
<tr>
<td><code>Double</code></td>
<td><code>KotlinDouble</code></td>
<td><code>&lt;Package&gt;Double</code></td>
<td><code>double</code></td>
</tr>
<tr>
<td><code>Boolean</code></td>
<td><code>KotlinBoolean</code></td>
<td><code>&lt;Package&gt;Boolean</code></td>
<td><code>BOOL/Bool</code></td>
</tr>
</tbody>
</table>
<p>每个数字类型都有一个类方法，用于从相关的简单类型创建新实例。此外，还有一个实例方法<!--
-->用于提取一个简单的值。原理上，声明看起来像这样：</p>
<div auto-indent="false" clacss="sample" data-highlight-only="" mode="obj-c" theme="idea">
<pre><code class="code _highlighted" data-lang="text/x-objectivec">__attribute__((objc_runtime_name("Kotlin__TYPE__")))
__attribute__((swift_name("Kotlin__TYPE__")))
@interface Demo__TYPE__ : DemoNumber
- (instancetype)initWith__TYPE__:(__CTYPE__)value;
+ (instancetype)numberWith__TYPE__:(__CTYPE__)value;
@end;
</code></pre>
</div>
<p>其中 <code>__TYPE__</code> 是简单类型的名称之一，而 <code>__CTYPE__</code> 是相关的 Objective-C 类型，例如 <code>initWithChar(char)</code>。</p>
<p>这些类型用于将装箱的 Kotlin 数字类型映射到 Objective-C 与 Swift。
在 Swift 中，我们可以简单的调用构造函数来创建一个示例，例如 <code>KotlinLong(value: 42)</code>。</p>
<h3 id="kotlin-中的类与对象">Kotlin 中的类与对象</h3>
<p>我们来看看如何将 <code>class</code> 与 <code>object</code> 映射到 Objective-C 与 Swift。 
生成的 <code>&lt;Framework&gt;/Headers/Demo.h</code> 文件包含
<code>Class</code>、<code>Interface</code> 与 <code>Object</code> 的确切定义：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="obj-c" theme="idea">
<pre><code class="language-obj-c">NS_ASSUME_NONNULL_BEGIN

__attribute__((objc_subclassing_restricted))
__attribute__((swift_name("Object")))
@interface DemoObject : KotlinBase
+ (instancetype)alloc __attribute__((unavailable));
+ (instancetype)allocWithZone:(struct _NSZone *)zone __attribute__((unavailable));
+ (instancetype)object __attribute__((swift_name("init()")));
@property (readonly) NSString *field;
@end;

__attribute__((swift_name("Interface")))
@protocol DemoInterface
@required
- (void)iMember __attribute__((swift_name("iMember()")));
@end;

__attribute__((objc_subclassing_restricted))
__attribute__((swift_name("Clazz")))
@interface DemoClazz : KotlinBase &lt;DemoInterface&gt;
- (instancetype)init __attribute__((swift_name("init()"))) __attribute__((objc_designated_initializer));
+ (instancetype)new __attribute__((availability(swift, unavailable, message="use object initializers instead")));
- (DemoLong * _Nullable)memberP:(int32_t)p __attribute__((swift_name("member(p:)")));
@end;
</code></pre>
</div>
<p>这段代码有各种 Objective-C attribute，旨在提供在
Objective-C 与 Swift 语言中使用该 framework 的帮助。
<code>DemoClazz</code>、<code>DemoInterface</code>、<code>DemoObject</code> 被分别创建为 <code>Clazz</code>、<code>Interface</code> 与
<code>Object</code>。<code>Interface</code> 被转换为 <code>@protocol</code>，同样 <code>class</code> 与 <code>object</code> 都以
<code>@interface</code> 表示。
<code>Demo</code> 前缀来自于 <code>kotlinc-native</code>
编译器的 <code>-output</code> 参数与 framework 的名称。
我们看到这里的可空的返回值类型 <code>ULong?</code> 被转换到 Objective-C 中的 <code>DemoLong*</code>。</p>
<h3 id="kotlin-中的全局声明">Kotlin 中的全局声明</h3>
<p>在 <code>Demo</code> 作为 framework 名称的地方且为 <code>kotlinc-native</code> 设置了 <code>-output</code> 参数时，
所有 Kotlin 中的全局声明<!--
-->都被转化为 Objective-C 中的 <code>DemoLibKt</code> 以及 Swift 中的 <code>LibKt</code>。</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="obj-c" theme="idea">
<pre><code class="language-obj-c">NS_ASSUME_NONNULL_BEGIN

__attribute__((objc_subclassing_restricted))
__attribute__((swift_name("LibKt")))
@interface DemoLibKt : KotlinBase
+ (void)forIntegersB:(int8_t)b s:(int16_t)s i:(int32_t)i l:(DemoLong * _Nullable)l __attribute__((swift_name("forIntegers(b:s:i:l:)")));
+ (void)forFloatsF:(float)f d:(DemoDouble * _Nullable)d __attribute__((swift_name("forFloats(f:d:)")));
+ (NSString *)stringsStr:(NSString * _Nullable)str __attribute__((swift_name("strings(str:)")));
+ (NSString * _Nullable)acceptFunF:(NSString * _Nullable (^)(NSString *))f __attribute__((swift_name("acceptFun(f:)")));
+ (NSString * _Nullable (^)(NSString *))supplyFun __attribute__((swift_name("supplyFun()")));
@end;
</code></pre>
</div>
<p>我们看到 Kotlin <code>String</code> 与 Objective-C <code>NSString *</code> 是透明映射的。
类似地，Kotlin 的 <code>Unit</code> 类型被映射到 <code>void</code>。我们看到原始类型<!--
-->直接映射。不可空的原始类型透明地映射。
可空的原始类型被映射到 <code>Kotlin&lt;TYPE&gt;*</code> 类型，如<a href="#kotlin-numbers-and-nsnumber">上</a>表所示。
包括高阶函数 <code>acceptFunF</code> 与 <code>supplyFun</code>，
都接收一个 Objective-C 块。</p>
<p>更多的关于所有其它类型的映射细节可以在这篇
<a href="/docs/reference/native/objc_interop.html">Objective-C 互操作</a><!--
-->文档中找到。</p>
<h2 id="垃圾回收与引用计数">垃圾回收与引用计数</h2>
<p>Objective-C 与 Swift 使用引用计数。Kotlin/Native 也同样拥有自己的垃圾回收。
Kotlin/Native 的垃圾回收与 Objective-C/Swift
引用计数相集成。我们不需要在 Swift 或 Objective-C 中使用任何其它特别的方式去控制
Kotlin/Native 实例的生命周期。</p>
<h2 id="在-objective-c-中使用代码">在 Objective-C 中使用代码</h2>
<p>让我们在 Objective-C 中调用代码。为此我们使用下面的内容创建
<code>main.m</code> 文件：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="obj-c" theme="idea">
<pre><code class="language-obj-c">#import &lt;Foundation/Foundation.h&gt;
#import &lt;Demo/Demo.h&gt;

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        [[DemoObject object] field];
        
        DemoClazz* clazz = [[ DemoClazz alloc] init];
        [clazz memberP:42];
        
        [DemoLibKt forIntegersB:1 s:1 i:3 l:[DemoULong numberWithUnsignedLongLong:4]];
        [DemoLibKt forIntegersB:1 s:1 i:3 l:nil];
        
        [DemoLibKt forFloatsF:2.71 d:[DemoDouble numberWithDouble:2.71]];
        [DemoLibKt forFloatsF:2.71 d:nil];
        
        NSString* ret = [DemoLibKt acceptFunF:^NSString * _Nullable(NSString * it) {
            return [it stringByAppendingString:@" Kotlin is fun"];
        }];
        
        NSLog(@"%@", ret);
        return 0;
    }
}
</code></pre>
</div>
<p>我们直接在 Objective-C 代码中调用 Kotlin 类。一个 Kotlin <code>object</code> 拥有类<!--
-->方法函数 <code>object</code>，这使我们在想获取对象的唯一实例时调用
<code>object</code> 方法就可以了。
广泛使用的用于创建 <code>Clazz</code> 类实例的模式。我们在
Objective-C 上调用 <code>[[ DemoClazz alloc] init]</code>。我们也可以使用<!--
-->没有参数的构造函数 <code>[DemoClazz new]</code>。
Kotlin 源中的全局声明的作用域位于 Objective-C 中的 <code>DemoLibKt</code> 类之下。
所有的方法都被转化为该类的类方法。
<code>strings</code> 函数转化为 Objective-C 中的 <code>DemoLibKt.stringsStr</code>函数，我们可以<!--
-->给它直接传递 <code>NSString</code>。而返回值也同样可以看作 <code>NSString</code>。</p>
<h2 id="在-swift-中使用代码">在 Swift 中使用代码</h2>
<p>这个使用 Kotlin/Native 编译的 framework 拥有辅助 attribute
来使它在 Swift 中的使用更为容易。我们来将之前的 Objective-C 示例覆盖为
Swift。其结果是，我们将在 <code>main.swift</code> 中包含下面的代码：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="swift" theme="idea">
<pre><code class="language-swift">import Foundation
import Demo

let kotlinObject = Object()
assert(kotlinObject === Object(), "Kotlin object has only one instance")

let field = Object().field

let clazz = Clazz()
clazz.member(p: 42)

LibKt.forIntegers(b: 1, s: 2, i: 3, l: 4)
LibKt.forFloats(f: 2.71, d: nil)

let ret = LibKt.acceptFun { "\($0) Kotlin is fun" }
if (ret != nil) {
  print(ret!)
}
</code></pre>
</div>
<p>这段 Kotlin 代码被转换为看起来非常相似的
Swift 代码。但是它们有一些小差异。在 Kotlin 中任何 <code>object</code>
只拥有一个实例。Kotlin <code>object Object</code> 现在在
Swift 中拥有一个构造函数，我们使用 <code>Object()</code> 语法来访问它唯一的实例。
在 Swift 中该实例总是相同的，所以 
<code>Object() === Object()</code> 为 true。 
方法与属性名称按原样转换。即 Kotlin <code>String</code> 被转换为 Swift <code>String</code>。
Swift 同样隐藏了 <code>NSNumber*</code> 的装箱。我们传递 Swift 闭包给 Kotlin，
与在 Swift 中调用 Kotlin lambda 函数是相同的。</p>
<p>更多关于类型映射的信息可以在这篇
<a href="/docs/reference/native/objc_interop.html">Objective-C 互操作</a><!--
-->文档中找到。</p>
<h1 id="xcode-与-framework-依赖">Xcode 与 Framework 依赖</h1>
<p>我们需要配置一个 Xcode 工程来使用我们的 framework。这个配置依赖于<!--
-->目标平台。</p>
<h2 id="xcode-与-macos-目标平台">Xcode 与 MacOS 目标平台</h2>
<p>首先，我们需要导入该 framework 到 <code>General</code> 选项的 <em>target</em>
配置。选择 <code>Linked Frameworks and Libraries</code> 选项来导入<!--
-->我们的 framework。这将使 Xcode 查看我们的 framework 并同时解决来自
Objective-C 与 Swift 的导入。</p>
<p>第二步是配置 framework 生产的二进制文件的<!--
-->搜索路径。它也被称作 <code>rpath</code> 或<a href="https://en.wikipedia.org/wiki/Rpath">运行时搜索路径</a>。
二进制文件使用路径来查找所需的 framework。我们不推荐，
在不需要的时候在操作系统中去安装其它 framework。我们应该了解<!--
-->未来应用程序的布局，举例来说，
我们可能在应用程序包下有 <code>Frameworks</code> 文件夹，其中包含我们所使用的所有 framework。
<code>@rpath</code> 参数可以被配置到 Xcode。我们需要打开
<em>project</em> 配置项并找到 <code>Runpath Search Paths</code> 选项。在这里我们指定编译
framework 的相对路径。</p>
<h2 id="xcode-与-ios-目标平台">Xcode 与 iOS 目标平台</h2>
<p>首先，我们需要导入编译好的 framework 到 Xcode 工程。为此<!--
-->我们将 framework 添加到 <em>target</em> 配置页的 <code>General</code> 选项的
<code>Embedded Binaries</code> 块。</p>
<p>第二步是将 framework 路径导入到 <em>target</em> 配置页的 <code>Build Settings</code> 选项下的
<code>Framework Search Paths</code> 块。它可以使用 <code>$(PROJECT_DIR)</code>
宏来简化设置。</p>
<p>iOS 模拟器需要一个为 <code>ios_x64</code> 目标平台编译的 framework，它位于我们案例中的
<code>iOS_sim</code> 文件夹。</p>
<p><a href="https://stackoverflow.com/questions/30963294/creating-ios-osx-frameworks-is-it-necessary-to-codesign-them-before-distributin">这个 Stack Overflow 主题</a><!--
-->包含了一些更多的建议。同样，
<a href="https://cocoapods.org/">CocoaPods</a> 包管理器也可能有助于自动化该过程。</p>
<h1 id="接下来">接下来</h1>
<p>Kotlin/Native 与 Objective-C 以及 Swift 语言之间拥有双向互操作性。
Kotlin 对象集成了 Objective-C/Swift 的引用计数。Kotlin
对象可以被自动释放。
这篇 <a href="https://github.com/JetBrains/kotlin-native/blob/master/OBJC_INTEROP.md">Objective-C 互操作</a><!--
-->文档包含了更多关于互操作实现细节的信息。
当然，也可以导入一个外部的 framework 并在 Kotlin 中使用它。Kotlin/Native
附带一套良好的预导入系统 framework。</p>
<p>Kotlin/Native 同样支持 C 互操作。查看这篇
<a href="dynamic-libraries.html">Kotlin/Native 开发动态库</a><!--
-->教程，或者查看这篇
<a href="/docs/reference/native/c_interop.html">C 互操作</a>文档</p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="global-footer-container">
                <div class="global-footer-row">
                    <div class="terms-copyright">
                        采用 <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache
                        2
                        授权许可</a>
                    </div>

                    <div class="terms-foundation">
                        Kotlin 商标受 <a
                            href="/foundation/kotlin-foundation.html">Kotlin 基金会</a>保护
                    </div>
                    <a class="terms-kit"
                            href=/assets/kotlin-media-kit.pdf>宣传资料</a>
                </div>
                <div class="global-footer-row">
                    <div class="terms-sponsor">
                        由 <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains"
                                                      target="_blank">JetBrains</a> 赞助及开发；
                        由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、
                        <a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a>、
                        <a href="https://github.com/qiaoyuang" class="testimonial-company-link" target="_blank" rel="nofollow">Yuang Qiao</a>
                        &nbsp;<a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
                    </div>
                </div>
            </div>
        </div>
    </div>

</footer>
    <script src="/_assets/tutorial.js"></script>
    <link rel="stylesheet" href="/_assets/tutorial.css">
<div class="search-popup _hidden" tabindex="1000">
    <div class="search-popup__content">
        <div class="search-popup__controls">
            <div class="search-popup__input"></div>
            <div class="search-popup__close">
                <div class="search-popup__close-icon-wrapper">
                    <div class="search-popup__close-icon"></div>
                </div>
                <div class="search-popup__close-text">esc</div>
            </div>
        </div>
        <div class="search-popup__results"></div>
    </div>
</div></body>
</html>