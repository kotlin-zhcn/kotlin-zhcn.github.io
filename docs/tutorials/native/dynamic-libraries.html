<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5W8DZRW');</script>
<!-- End Google Tag Manager -->

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content=""/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/tutorials/native/dynamic-libraries.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="将 Kotlin/Native 编译为动态库">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="">
    <meta name="twitter:description" content="将 Kotlin/Native 编译为动态库">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->

    <title>Kotlin/Native 开发动态库 - Kotlin 语言中文站</title>

    <script src="/_assets/common.js"></script>
    <link rel="stylesheet" href="/_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5W8DZRW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

<header class="global-header">
    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav class="global-nav">
    <div class="nav-links">
            <a href="https://www.kotliner.cn/" class="nav-item">
                博客
            </a>
            <a href="https://discuss.kotliner.cn/" class="nav-item">
                论坛
            </a>
            <a href="/docs/reference/" class="nav-item">
                学习
            </a>
            <a href="/community/" class="nav-item">
                社区
            </a>
            <a href="https://play.kotlinlang.org" class="nav-item">
                在线试用
            </a>
    </div>

    <div class="search-button">
        <div class="icon"></div>
    </div>
</nav>        </div>
    </div>


    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">
        <nav class="docs-nav">
                <div class="nav-item-wrap">
                        <a href="/docs/reference/" class="nav-item">
                            <span class="nav-item-text">
                                参考
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/tutorials/" class="nav-item is_active">
                            <span class="nav-item-text">
                                教程
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/books.html" class="nav-item">
                            <span class="nav-item-text">
                                图书
                            </span>
                        </a>
                </div>
                <div class="nav-item-wrap">
                        <a href="/docs/resources.html" class="nav-item">
                            <span class="nav-item-text">
                                更多资源
                            </span>
                        </a>
                </div>
        </nav>

    <div class="g-grid">
        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav class="side-tree-nav">
                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="开始">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">开始</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/getting-started.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 IntelliJ IDEA 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/getting-started-eclipse.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Eclipse 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/command-line.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用命令行编译器</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/quick-run.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">运行代码片段</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/build-tools.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用构建工具</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/koans.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">心印</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/competitive-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">竞技程序设计</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Android">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Android</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Android 开发入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/android-plugin.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin Android 扩展</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/android-frameworks.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Android 框架</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Java 互操作">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Java 互操作</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/mixing-java-kotlin-intellij.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在一个项目中混用 Java 与 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="JavaScript">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">JavaScript</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/kotlin-to-javascript/kotlin-to-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 转 JavaScript</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-gradle/getting-started-with-gradle.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Gradle 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-idea/getting-started-with-intellij-idea.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 IntelliJ IDEA 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-maven/getting-started-with-maven.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">以 Maven 入门</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/getting-started-command-line/command-line-library-js.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">使用命令行编译器创建 Kotlin JavaScript 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/working-with-modules/working-with-modules.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin 与 JavaScript 模块合用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/working-with-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">与 JavaScript 合用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/javascript/debugging-javascript/debugging-javascript.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在浏览器中调试 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="多平台项目">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">多平台项目</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mpp-ios-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">iOS 与 Android</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/multiplatform-library.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">多平台库</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="原生">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">原生</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/basic-kotlin-native-app.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">基本 Kotlin/Native 应用程序</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-primitive-data-types-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的原始数据类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-struct-union-types-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的结构与联合类型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-function-pointers-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的函数指针</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mapping-strings-from-c.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">映射来自 C 语言的字符串</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active ">
                <div class="marker"></div>
                <div class="text">Kotlin/Native 开发动态库</div>
            </div>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/apple-framework.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Kotlin/Native 开发 Apple Framework</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/multiplatform-library.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">发布 Kotlin/Native 库</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/curl.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">在应用中使用 C 语言互操作与 libcurl</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/native/mpp-ios-android.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">构建 iOS 与 Android 应用</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="协程">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">协程</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/coroutines/async-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异步程序设计</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/coroutines/coroutines-basic-jvm.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">JVM 平台的 Kotlin 协程简介</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Web 开发">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">Web 开发</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/httpservlets.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">用 Http Servlets 创建 web 应用</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/spring-boot-restful.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">用  Spring Boot 创建 RESTful Web 服务</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="工具">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">工具</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-and-ci.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">TeamCity 配置 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="教学">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">教学</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/edu-tools-learner.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通过 EduTools 插件学习 Kotlin</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/edu-tools-educator.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">通过 EduTools 插件讲授 Kotlin</span>
            </a>
    </div>

    </div>

                <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="迁移自 Python">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title is_active">
            <div class="marker"></div>
            <div class="text">迁移自 Python</div>
        </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/introduction.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">简介</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/hello-world.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">Hello World</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/compiling-and-running.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编译与运行</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/declaring-variables.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">声明变量</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/primitive-data-types-and-their-limitations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">原生数据类型及其表示范围</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/strings.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">字符串</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/conditionals.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">条件式</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/collections.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">集合</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/loops.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">循环</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/functions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/classes.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">类</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/exceptions.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">异常</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/null-safety.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">空安全</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/functional-programming.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">函数式编程</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/packages-and-imports.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">包与导入</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/visibility-modifiers.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">可见性修饰符</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/inheritance.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">继承</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">对象与伴生对象</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/generics.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">泛型</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/extension-functionsproperties.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">扩展函数/属性</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/member-references-and-reflection.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">成员引用与反射</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/annotations.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">注解</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/file-io.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">文件 I/O</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/scoped-resource-usage.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">作用域内资源用法</span>
            </a>
    </div>

                    <div class="tree-item tree-leaf js-item js-leaf ">
            <a href="/docs/tutorials/kotlin-for-py/documentation.html"
               class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
            >
                <span class="marker"></span>
                <span class="text">编写文档</span>
            </a>
    </div>

    </div>

    </nav>

            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/tutorials/native/dynamic-libraries.md"
   class="page-link-to-github"
   target="_blank"
   title="在 GitHub 上编辑本页">
        <i class="github-icon"></i>
        <span class="text">编辑本页</span>
</a>
            <h1>
                Kotlin/Native 开发动态库
            </h1>
            <table>
                    <tr>
                        <td>
                            <strong>作者</strong>
                        </td>
                        <td>
                            Eugene Petrenko，乔禹昂（翻译）
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>最近更新</strong>
                        </td>
                        <td>
                            2019-04-15
                        </td>
                    </tr>
            </table>
                将 Kotlin/Native 编译为动态库
                <br/>
                <br/>
            
<p>在本教程中，我们将看到如何使用位于已经存在的<!--
-->原生应用程序或库中的代码。为此，我们需要将
Kotlin 代码编译为动态库，例如 <code>.so</code>、<code>.dylib</code> 以及 <code>.dll</code>。</p>
<p>Kotlin/Native 也可以与 Apple 技术紧密集成。
这篇 <a href="apple-framework.html">Kotlin/Native 开发 Apple Framework</a>
教程解释了如何将代码编译为 Swift 与 Objective-C framework。</p>
<p>在这篇教程中，我们将：</p>
<ul>
<li><a href="#创建-kotlin-库">将 Kotlin 代码编译为动态库</a></li>
<li><a href="#生成头文件">生成 C 的头文件</a></li>
<li><a href="#using-generated-headers-from-c">在 C 中调用 Kotlin 动态库</a></li>
<li>将示例代码编译并运行于 <a href="#compiling-and-running-the-example-on-linux-and-macos">Linux 与 Mac</a>
以及 <a href="#compiling-and-running-the-example-on-windows">Windows</a></li>
</ul>
<h2 id="创建-kotlin-库">创建 Kotlin 库</h2>
<p>Kotlin/Native 编译器可以将我们的 Kotlin
代码编译为一个动态库。
动态库常常带有一个头文件，即 <code>.h</code> 文件，
我们将通过它来调用编译后的 C 代码。</p>
<p>理解这些技术的最佳方法是尝试它们。
让我们创建第一个小型的 Kotlin 库，并在 C 程序中使用它。</p>
<p>我们可以先在 Kotlin 中创建一个库文件，然后将其保存为 <code>hello.kt</code>：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">package example

object Object {
  val field = "A"
}

class Clazz {
  fun memberFunction(p: Int): ULong = 42UL
}

fun forIntegers(b: Byte, s: Short, i: UInt, l: Long) { }
fun forFloats(f: Float, d: Double) { }

fun strings(str: String) : String? {
  return "That is '$str' from C"
}

val globalString = "A global String"
</code></pre>
</div>
<p>While it is possible to use the command line, either directly or
by combining it with a script file (i.e., sh or bat file), we should notice,
that it does not scale well for big projects that have hundreds of files and libraries.
It is then better to use the Kotlin/Native compiler with a build system, as it
helps to download and cache the Kotlin/Native compiler binaries and libraries with
transitive dependencies and run the compiler and tests.
Kotlin/Native can use the <a href="https://gradle.org">Gradle</a> build system through the
<a href="/docs/reference/building-mpp-with-gradle.html">kotlin-multiplatform</a> plugin.</p>
<p>We covered the basics of setting up an IDE compatible project with Gradle in the
<a href="basic-kotlin-native-app.html#create-gradle-project">A Basic Kotlin/Native Application</a>
tutorial. Please check it out if you are looking for detailed first steps
and instructions on how to start a new Kotlin/Native project and open it in IntelliJ IDEA.
In this tutorial, we'll look at the advanced C interop related usages of Kotlin/Native 
and
<a href="/docs/reference/building-mpp-with-gradle.html">multiplatform</a>
builds with Gradle.</p>
<p>First, let's create a project folder. All the paths in this tutorial will be relative to this folder. Sometimes
the missing directories will have to be created before any new files can be added.</p>
<p>We'll use the following 
<span class="multi-language-span" data-lang="groovy">
<code>build.gradle</code>
</span>
<span class="multi-language-span" data-lang="kotlin">
<code>build.gradle.kts</code>
</span>
Gradle build file with the following contents:</p>
<div class="multi-language-sample" data-lang="groovy" data-os="linux">
<div class="sample" data-highlight-only="" mode="groovy" theme="idea">
<pre><code>plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.21'
}

repositories {
    mavenCentral()
}

kotlin {
  linuxX64("native") {
    binaries {
      sharedLib {
        baseName = "native"
      }
    }
  }
}

wrapper {
  gradleVersion = "5.3.1"
  distributionType = "ALL"
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="groovy" data-os="macos">
<div class="sample" data-highlight-only="" mode="groovy" theme="idea">
<pre><code>plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.21'
}

repositories {
    mavenCentral()
}

kotlin {
  macosX64("native") {
    binaries {
      sharedLib {
        baseName = "native"
      }
    }
  }
}

wrapper {
  gradleVersion = "5.3.1"
  distributionType = "ALL"
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="groovy" data-os="windows">
<div class="sample" data-highlight-only="" mode="groovy" theme="idea">
<pre><code>plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.21'
}

repositories {
    mavenCentral()
}

kotlin {
  mingwX64("native") {
    binaries {
      sharedLib {
        baseName = "libnative"
      }
    }
  }
}

wrapper {
  gradleVersion = "5.3.1"
  distributionType = "ALL"
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin" data-os="linux">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>plugins {
    kotlin("multiplatform") version "1.3.21"
}

repositories {
    mavenCentral()
}

kotlin {
  linuxX64("native") {
    binaries {
      sharedLib {
        baseName = "native"
      }
    }
  }
}

tasks.withType&lt;Wrapper&gt; {
  gradleVersion = "5.3.1"
  distributionType = Wrapper.DistributionType.ALL
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin" data-os="macos">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>plugins {
    kotlin("multiplatform") version "1.3.21"
}

repositories {
    mavenCentral()
}

kotlin {
  macosX64("native") {
    binaries {
      sharedLib {
        baseName = "native"
      }
    }
  }
}

tasks.withType&lt;Wrapper&gt; {
  gradleVersion = "5.3.1"
  distributionType = Wrapper.DistributionType.ALL
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-lang="kotlin" data-os="windows">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code>plugins {
    kotlin("multiplatform") version "1.3.21"
}

repositories {
    mavenCentral()
}

kotlin {
  mingwX64("native") {
    binaries {
      sharedLib {
        baseName = "libnative"
      }
    }
  }
}

tasks.withType&lt;Wrapper&gt; {
  gradleVersion = "5.3.1"
  distributionType = Wrapper.DistributionType.ALL
}
</code></pre>
</div>
</div>
<p>这个已经准备好的工程源文件可以从这里直接下载：
<span class="multi-language-span" data-lang="groovy" data-os="linux">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-groovy-linux.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="groovy" data-os="macos">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-groovy-macos.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="groovy" data-os="windows">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-groovy-windows.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="kotlin" data-os="linux">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-kotlin-linux.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="kotlin" data-os="macos">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-kotlin-macos.zip">GitHub</a>.
</span>
<span class="multi-language-span" data-lang="kotlin" data-os="windows">
<a href="https://github.com/kotlin/web-site-samples/archive/mpp-kn-shared-lib-kotlin-windows.zip">GitHub</a>.
</span></p>
<p>让我们将工程目录下的源文件移动到 <code>src/nativeMain/kotlin</code>
文件夹下。当使用 <a href="/docs/reference/building-mpp-with-gradle.html">kotlin 多平台</a><!--
-->插件的时候，对于源文件的位置，
这就是默认路径。我们使用以下代码块来指导和配置工程<!--
-->为我们生成动态或共享库：</p>
<div class="multi-language-sample" data-os="macos">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
  sharedLib {
    baseName = "native"
  }  
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="linux">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
  sharedLib {
    baseName = "native"
  }  
}
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="windows">
<div class="sample" data-highlight-only="" mode="kotlin" theme="idea">
<pre><code class="language-kotlin">binaries {
  sharedLib {
    baseName = "libnative"
  }  
}
</code></pre>
</div>
</div>
<p><code>libnative</code> 用作库名，即生成的<!--
-->头文件名前缀。它同样也是该头文件中<!--
-->所有声明的前缀。</p>
<p>现在我们已经准备好<!--
--><a href="basic-kotlin-native-app.html#open-in-ide">在 IntelliJ IDEA 中打开这个工程</a><!--
-->并且可以看到如何修正这个示例工程。在我们这样做的时候，
我们将会研究 C 函数如何映射为 Kotlin/Native 声明。</p>
<p>让我们运行这个 <code>linkNative</code> Gradle 任务来<!--
--><a href="basic-kotlin-native-app.html#run-in-ide">在 IDE 中</a>构建该库。
或者运行下面这行控制台命令：</p>
<div class="multi-language-sample" data-os="linux">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">./gradlew linkNative
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="macos">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">./gradlew linkNative
</code></pre>
</div>
</div>
<div class="multi-language-sample" data-os="windows">
<div class="sample" data-highlight-only="" mode="bash" theme="idea">
<pre><code class="language-bash">gradlew.bat linkNative
</code></pre>
</div>
</div>
<p>构建将会在 <code>build/bin/native/debugShared</code> 文件夹下生成<!--
-->以下文件，并取决于目标操作系统：</p>
<ul>
<li>macOS: <code>libnative_api.h</code> 与 <code>libnative.dylib</code></li>
<li>Linux: <code>libnative_api.h</code> 与 <code>libnative.so</code></li>
<li>Windows: <code>libnative_api.h</code>、<code>libnative_symbols.def</code> 以及 <code>libnative.dll</code></li>
</ul>
<p>Kotlin/Native 编译器用相似的规则在<!--
-->所有的平台上生成 <code>.h</code> 文件。<br/>
来看看我们的 Kotlin 库的 C 语言 API。</p>
<h2 id="生成头文件">生成头文件</h2>
<p>在 <code>libnative_api.h</code> 中，我们将发现如下代码。
我们将探讨其中部分代码，以便更容易理解。</p>
<p>注意，Kotlin/Native 的外部符号如有变更，将不会另外说明。</p>
<p>第一部分包含了标准的 C/C++ 头文件的首尾：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">#ifndef KONAN_DEMO_H
#define KONAN_DEMO_H
#ifdef __cplusplus
extern "C" {
#endif

/// 生成的代码的其余部分在这里

#ifdef __cplusplus
}  /* extern "C" */
#endif
#endif  /* KONAN_DEMO_H */
</code></pre>
</div>
<p>在 <code>libnative_api.h</code> 中的上述内容之后，我们就拥有了一个声明通用类型定义的块：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">#ifdef __cplusplus
typedef bool            libnative_KBoolean;
#else
typedef _Bool           libnative_KBoolean;
#endif
typedef unsigned short     libnative_KChar;
typedef signed char        libnative_KByte;
typedef short              libnative_KShort;
typedef int                libnative_KInt;
typedef long long          libnative_KLong;
typedef unsigned char      libnative_KUByte;
typedef unsigned short     libnative_KUShort;
typedef unsigned int       libnative_KUInt;
typedef unsigned long long libnative_KULong;
typedef float              libnative_KFloat;
typedef double             libnative_KDouble;
typedef void*              libnative_KNativePtr;
</code></pre>
</div>
<p>Kotlin 在已创建的 <code>libnative_api.h</code> 文件中为<!--
-->所有的声明都添加了 <code>libnative_</code> 前缀。让我们以<!--
-->更容易阅读的方式来查看类型的映射：</p>
<table class="zebra">
<thead>
<tr>
<th>Kotlin 定义。</th>
<th>C 类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>libnative_KBoolean</code></td>
<td><code>bool</code> 或 <code>_Bool</code></td>
</tr>
<tr>
<td><code>libnative_KChar</code></td>
<td><code>unsigned short</code></td>
</tr>
<tr>
<td><code>libnative_KByte</code></td>
<td><code>signed char</code></td>
</tr>
<tr>
<td><code>libnative_KShort</code></td>
<td><code>short</code></td>
</tr>
<tr>
<td><code>libnative_KInt</code></td>
<td><code>int</code></td>
</tr>
<tr>
<td><code>libnative_KLong</code></td>
<td><code>long long</code></td>
</tr>
<tr>
<td><code>libnative_KUByte</code></td>
<td><code>unsigned char</code></td>
</tr>
<tr>
<td><code>libnative_KUShort</code></td>
<td><code>unsigned short</code></td>
</tr>
<tr>
<td><code>libnative_KUInt</code></td>
<td><code>unsigned int</code></td>
</tr>
<tr>
<td><code>libnative_KULong</code></td>
<td><code>unsigned long long</code></td>
</tr>
<tr>
<td><code>libnative_KFloat</code></td>
<td><code>float</code></td>
</tr>
<tr>
<td><code>libnative_KDouble</code></td>
<td><code>double</code></td>
</tr>
<tr>
<td><code>libnative_KNativePtr</code></td>
<td><code>void*</code></td>
</tr>
</tbody>
</table>
<p>这个定义部分展示了如何将 Kotlin 的原始类型映射为 C 的原始类型。 
我们在这篇<a href="mapping-primitive-data-types-from-c.html">从 C 语言中映射原始类型</a>教程中讨论了反向映射。</p>
<p><code>libnative_api.h</code> 文件的下一个部分包含了在该库中<!--
-->使用的类型的定义：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">struct libnative_KType;
typedef struct libnative_KType libnative_KType;

typedef struct {
  libnative_KNativePtr pinned;
} libnative_kref_example_Object;

typedef struct {
  libnative_KNativePtr pinned;
} libnative_kref_example_Clazz;
</code></pre>
</div>
<p><code>typedef struct { .. } TYPE_NAME</code> 语法在 C 语言中用于声明一个结构体。
<a href="https://stackoverflow.com/questions/1675351/typedef-struct-vs-struct-definitions">这个问题</a><!--
-->提供了对该模式的更多解释。</p>
<p>我们可以看到其中定义了 Kotlin 的 <code>Object</code> 类映射为
<code>libnative_kref_example_Object</code>，而 <code>Clazz</code> 映射到了 <code>libnative_kref_example_Clazz</code>。
这两个结构体都没有包含任何东西，但是 <code>pinned</code> 字段是一个指针，该字段类型
<code>libnative_KNativePtr</code> 定义在 <code>void*</code> 之上。</p>
<p>C 语言中没有支持命名空间，所以 Kotlin/Native 编译器生成了<!--
-->长名称，以避免与现有原生工程中的其他符号发生任何可能的冲突。</p>
<p>定义的很大一部分位于 <code>libnative_api.h</code> 文件。
它包含了我们的 Kotlin/Native 库世界的定义：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">typedef struct {
  /* Service functions. */
  void (*DisposeStablePointer)(libnative_KNativePtr ptr);
  void (*DisposeString)(const char* string);
  libnative_KBoolean (*IsInstance)(libnative_KNativePtr ref, const libnative_KType* type);

  /* User functions. */
  struct {
    struct {
      struct {
        void (*forIntegers)(libnative_KByte b, libnative_KShort s, libnative_KUInt i, libnative_KLong l);
        void (*forFloats)(libnative_KFloat f, libnative_KDouble d);
        const char* (*strings)(const char* str);
        const char* (*get_globalString)();
        struct {
          libnative_KType* (*_type)(void);
          libnative_kref_example_Object (*_instance)();
          const char* (*get_field)(libnative_kref_example_Object thiz);
        } Object;
        struct {
          libnative_KType* (*_type)(void);
          libnative_kref_example_Clazz (*Clazz)();
          libnative_KULong (*memberFunction)(libnative_kref_example_Clazz thiz, libnative_KInt p);
        } Clazz;
      } example;
    } root;
  } kotlin;
} libnative_ExportedSymbols;
</code></pre>
</div>
<p>这段代码使用了匿名的结构体定义。代码 <code>struct { .. } foo</code>
在结构体外部声明了一个<!--
-->匿名结构体类型，这个类型没有名字。</p>
<p>C 语言同样也不支持对象。人们使用函数指针来模仿<!--
-->对象语义。一个函数指针被声明在 <code>RETURN_TYPE (* FIELD_NAME)(PARAMETERS)</code> 后面。
它的阅读性很差，但我们应该能够从上面的结构体中看到函数指针字段。</p>
<h3 id="运行时函数">运行时函数</h3>
<p>阅读下面的代码。我们拥有这个 <code>libnative_ExportedSymbols</code> 结构体，它定义了所有
Kotlin/Native 中的以及我们的库提供给我们的函数。它使用<!--
-->嵌套匿名结构，以模仿包。<code>libnative_</code> 前缀来源于<!--
-->库的名字。</p>
<p><code>libnative_ExportedSymbols</code> 结构体包含了几个辅助函数：</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">void (*DisposeStablePointer)(libnative_KNativePtr ptr);
void (*DisposeString)(const char* string);
libnative_KBoolean (*IsInstance)(libnative_KNativePtr ref, const libnative_KType* type);
</code></pre>
</div>
<p>这些函数用于处理 Kotlin/Native 的对象。调用
<code>DisposeStablePointer</code> 来释放一个 Kotlin 对象，而 <code>DisposeString</code> 用于释放一个 Kotlin 字符串， 
该字符串具有 C 中的 <code>char*</code> 类型。<code>IsInstance</code> 函数可以用于检查一个
Kotlin 类型或者一个 <code>libnative_KNativePtr</code> 是否是某个类型的实例。实际的<!--
-->生成操作取决于实际的使用情况。</p>
<p>Kotlin/Native 拥有垃圾回收机制，但是它不能帮助我们处理<!--
-->来源于 C 的 Kotlin 对象。Kotlin/Native 可以与 Objective-C 以及
Swift 进行互操作，并且结合了它们的引用计数。 
这篇 <a href="/docs/reference/native/objc_interop.html">Objective-C 互操作</a>
包含了更多关于此内容的细节。当然，也可以参考<!--
-->这篇 <a href="apple-framework.html">Kotlin/Native 开发 Apple Framework</a> 文档。</p>
<h3 id="our-library-functions">Our Library Functions</h3>
<p>Let's take a look at the <code>kotlin.root.example</code> field, it
mimics the package structure of our Kotlin code with a <code>kotlin.root.</code> prefix.</p>
<p>There is a <code>kotlin.root.example.Clazz</code> field that 
represents the <code>Clazz</code> from Kotlin. The <code>Clazz#memberFunction</code> is
accessible with the <code>memberFunction</code> field. The only difference is that 
the <code>memberFunction</code> accepts a <code>this</code> reference as the first parameter. 
The C language does not support objects, and this is the reason to pass a
<code>this</code> pointer explicitly.</p>
<p>There is a constructor in the <code>Clazz</code> field (aka <code>kotlin.root.example.Clazz.Clazz</code>),
which is the constructor function to create an instance of the <code>Clazz</code>.</p>
<p>Kotlin <code>object Object</code> is accessible as <code>kotlin.root.example.Object</code>. There is 
the <code>_instance</code> function to get the only instance of the object.</p>
<p>Properties are translated into functions. The <code>get_</code> and <code>set_</code> prefix
is used to name the getter and the setter functions respectively. For example, 
the read-only property <code>globalString</code> from Kotlin is turned 
into a <code>get_globalString</code> function in C.</p>
<p>Global functions <code>forInts</code>, <code>forFloats</code>, or <code>strings</code> are turned into the functions pointers in
the <code>kotlin.root.example</code> anonymous struct.</p>
<h3 id="the-entry-point">The Entry Point</h3>
<p>We can see how the API is created. To start with, we need to initialize the 
<code>libnative_ExportedSymbols</code> structure. Let's take a look at the latest part 
of the <code>libnative_api.h</code> for this:</p>
<pre><code class="code _highlighted" data-lang="text/x-csrc">extern libnative_ExportedSymbols* libnative_symbols(void);
</code></pre>
<p>The function <code>libnative_symbols</code> allows us to open the way from the native 
code to the Kotlin/Native library. This is the entry point we use. The 
library name is used as a prefix for the function name.</p>
<p>Note, Kotlin/Native object references do not support multi-threaded access. 
Hosting the returned <code>libnative_ExportedSymbols*</code> pointer
per thread might be necessary.</p>
<h2 id="using-generated-headers-from-c">Using Generated Headers from C</h2>
<p>The usage from C is straightforward and uncomplicated. We create a <code>main.c</code> file with the following 
code:</p>
<div auto-indent="false" class="sample" data-highlight-only="1" mode="C" theme="idea">
<pre><code class="language-c">#include "libnative_api.h"
#include "stdio.h"

int main(int argc, char** argv) {
  //obtain reference for calling Kotlin/Native functions
  libnative_ExportedSymbols* lib = libnative_symbols();

  lib-&gt;kotlin.root.example.forIntegers(1, 2, 3, 4);
  lib-&gt;kotlin.root.example.forFloats(1.0f, 2.0);

  //use C and Kotlin/Native strings
  const char* str = "Hello from Native!";
  const char* response = lib-&gt;kotlin.root.example.strings(str);
  printf("in: %s\nout:%s\n", str, response);
  lib-&gt;DisposeString(response);

  //create Kotlin object instance
  libnative_kref_example_Clazz newInstance = lib-&gt;kotlin.root.example.Clazz.Clazz();
  long x = lib-&gt;kotlin.root.example.Clazz.memberFunction(newInstance, 42);
  lib-&gt;DisposeStablePointer(newInstance.pinned);

  printf("DemoClazz returned %ld\n", x);

  return 0;
}
</code></pre>
</div>
<h2 id="compiling-and-running-the-example-on-linux-and-macos">Compiling and Running the Example on Linux and macOS</h2>
<p>On macOS 10.13 with Xcode, we compile the C code and link it with the dynamic library
with the following command:</p>
<pre><code class="code _highlighted" data-lang="text/x-sh">clang main.c libnative.dylib
</code></pre>
<p>On Linux we call a similar command:</p>
<pre><code class="code _highlighted" data-lang="text/x-sh">gcc main.c libnative.so
</code></pre>
<p>The compiler generates an executable called <code>a.out</code>. We need to run it to see in action the Kotlin code
being executed from C library. On Linux, we'll need to include <code>.</code> into the <code>LD_LIBRARY_PATH</code>
to let the application know to load the <code>libnative.so</code> library from the current folder.</p>
<h2 id="compiling-and-running-the-example-on-windows">Compiling and Running the Example on Windows</h2>
<p>To start with, we'll need a Microsoft Visual C++ compiler installed that supports a x64_64 
target. The easiest way to do this is to have a version of Microsoft Visual Studio installed on 
a Windows machine.</p>
<p>We will be using the <code>x64 Native Tools Command Prompt &lt;VERSION&gt;</code> console. We'll see the 
shortcut to open the console in the start menu. It comes with a Microsoft Visual Studio
package.</p>
<p>On Windows, Dynamic libraries are included either via a generated static library wrapper
or with manual code, which deals with the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms684175.aspx">LoadLibrary</a>
or similar Win32API functions. We will follow the first option and generate the static wrapper library
for the <code>libnative.dll</code> on our own.</p>
<p>We call <code>lib.exe</code> from the toolchain to generate the static library 
wrapper <code>libnative.lib</code> that automates the DLL usage from the code:</p>
<pre><code class="code _highlighted" data-lang="text/x-sh">lib /def:libnative_symbols.def /out:libnative.lib
</code></pre>
<p>Now we are ready to compile our <code>main.c</code> into an executable. We include the generated <code>libnative.lib</code> into
the build command and start:</p>
<pre><code class="code _highlighted" data-lang="text/x-sh">cl.exe main.c libnative.lib
</code></pre>
<p>The command produces the <code>main.exe</code> file, which we can run.</p>
<h2 id="next-steps">Next Steps</h2>
<p>Dynamic libraries are the main way to use Kotlin code from existing programs. 
We can use them to share our code with many platforms or languages, including JVM,
<a href="https://github.com/JetBrains/kotlin-native/blob/master/samples/python_extension/src/main/c/kotlin_bridge.c">Python</a>,
iOS, Android, and others.</p>
<p>Kotlin/Native also has tight integration with Objective-C and Swift.
It is covered in the <a href="apple-framework.html">Kotlin/Native as an Apple Framework</a>
tutorial.</p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="global-footer-container">
                <div class="global-footer-row">
                    <div class="terms-copyright">
                        采用 <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache
                        2
                        授权许可</a>
                    </div>

                    <div class="terms-foundation">
                        Kotlin 商标受 <a
                            href="/foundation/kotlin-foundation.html">Kotlin 基金会</a>保护
                    </div>
                    <a class="terms-kit"
                            href=/assets/kotlin-media-kit.zip>宣传资料</a>
                </div>
                <div class="global-footer-row">
                    <div class="terms-sponsor">
                        由 <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains"
                                                      target="_blank">JetBrains</a> 赞助及开发；
                        由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、<a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a> &nbsp;<a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
                    </div>
                </div>

            </div>
        </div>
    </div>

</footer>
    <script src="/_assets/tutorial.js"></script>
    <link rel="stylesheet" href="/_assets/tutorial.css">
<div class="search-popup _hidden" tabindex="1000">
    <div class="search-popup__content">
        <div class="search-popup__controls">
            <div class="search-popup__input"></div>
            <div class="search-popup__close">
                <div class="search-popup__close-icon-wrapper">
                    <div class="search-popup__close-icon"></div>
                </div>
                <div class="search-popup__close-text">esc</div>
            </div>
        </div>
        <div class="search-popup__results"></div>
    </div>
</div></body>
</html>