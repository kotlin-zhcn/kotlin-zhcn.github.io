<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5P98');</script>
<!-- End Google Tag Manager -->


<title>Working with Kotlin and JavaScript Modules - Kotlin 语言中文站</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/0_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content="Working with Kotlin and JavaScript Modules - Kotlin 语言中文站"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/tutorials/javascript/working-with-modules/working-with-modules.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="A look at how to use Kotlin to interact with JavaScript modules.">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="Working with Kotlin and JavaScript Modules - Kotlin 语言中文站">
    <meta name="twitter:description" content="A look at how to use Kotlin to interact with JavaScript modules.">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->
    <script src="/0_assets/default.js"></script>
    <script src="/0_assets/common.js"></script>
    <link rel="stylesheet" href="/0_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

<header class="global-header">

    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav role="navigation" class="global-nav">

    <div class="nav-links">

            <a href="http://www.kotliner.cn/"
               class="nav-item "
            >
                博客
            </a>

            <a href="/docs/reference/"
               class="nav-item "
            >
                学习
            </a>

            <a href="/community/"
               class="nav-item "
            >
                社区
            </a>

            <a href="http://try.kotlinlang.org"
               class="nav-item "
            >
                在线试用
            </a>
    </div>


<div id="global-search" class=" global-search" title="Search">
    <div class="search-button">
        <div class="icon"></div>
    </div>
    <div class="search-box">
        <div class="gcse-searchbox-only"
             data-resultsUrl="/search.html"
             data-newWindow="false"
        ></div>
    </div>
</div></nav>        </div>
        <a class="conference-banner" href="https://kotlinconf.com/?utm_source=kotlinlang&utm_medium=web&utm_campaign=superearlybird">
            <div class="conference-banner__img"></div>
        </a>
    </div>

    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">

    <nav role="navigation" class="docs-nav">
            <div class="nav-item-wrap">
                    <a href="/docs/reference/" class="nav-item">
                    <span class="nav-item-text">
                        参考
                    </span>
                    </a>

            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/tutorials/" class="nav-item is_active">
                        <span class="nav-item-text">
                            教程
                        </span>
                    </a>
            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/books.html" class="nav-item">
                    <span class="nav-item-text">
                        书籍
                    </span>
                    </a>

            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/resources.html" class="nav-item">
                    <span class="nav-item-text">
                        更多资源
                    </span>
                    </a>

            </div>
    </nav>

    <div class="g-grid">
        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav role="navigation" class="side-tree-nav">
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="开始">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">开始</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/getting-started.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 IntelliJ IDEA 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/getting-started-eclipse.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Eclipse 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/command-line.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用命令行编译器</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/build-tools.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用构建工具</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/koans.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">心印</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="Android">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Android</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/kotlin-android.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Android 开发入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/android-plugin.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Kotlin Android 扩展</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/android-frameworks.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Android 框架</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="Java 互操作">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Java 互操作</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/mixing-java-kotlin-intellij.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">在一个项目中混用 Java 和 Kotlin</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _opened"
                 data-id="JavaScript">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">JavaScript</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/kotlin-to-javascript/kotlin-to-javascript.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Kotlin 转 JavaScript</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-gradle/getting-started-with-gradle.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Gradle 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-idea/getting-started-with-intellij-idea.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 IntelliJ IDEA 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-maven/getting-started-with-maven.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Maven 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-command-line/command-line-library-js.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用命令行编译器创建 Kotlin JavaScript 库</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active">
                                <div class="marker"></div>
                                <div class="text">Kotlin 与 JavaScript 模块使用</div>
                            </div>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/working-with-javascript.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">与 JavaScript 合用</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="协程">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">协程</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/coroutines-basic-jvm.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">JVM 平台的 Kotlin 协程简介</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="Web 开发">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Web 开发</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/httpservlets.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">用 Http Servlets 创建 web 应用</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/spring-boot-restful.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">用  Spring Boot 创建 RESTful Web 服务</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="工具">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">工具</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/kotlin-and-ci.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">TeamCity 配置 Kotlin</span>
                            </a>
                    </div>

            </div>
    </nav>

            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/tutorials/javascript/working-with-modules/working-with-modules.md"
   class="page-link-to-github"
   target="_blank"
   title="Edit this page on GitHub">
        <i class="github-icon"></i>
        <span class="text">Edit Page</span>
</a>
            <h1>
                Working with Kotlin and JavaScript Modules
            </h1>
            <table>
                    <tr>
                        <td>
                            <strong>最近更新</strong>
                        </td>
                        <td>
                            2016-09-30
                        </td>
                    </tr>
            </table>
                A look at how to use Kotlin to interact with JavaScript modules.
                <br/>
                <br/>
            
<p>In this tutorial we'll see how to</p>
<ul>
<li><a href="#configuring-modules-with-intellij-idea">Configure modules when using IntelliJ IDEA</a></li>
<li><a href="#configuring-modules-when-using-maven-or-gradle">Configure modules when using Maven or Gradle</a></li>
<li><a href="#using-amd">Use Kotlin in the browser with AMD</a></li>
<li><a href="#using-commonjs">Use Kotlin from node.js with CommonJS</a></li>
</ul>
<h2 id="configuring-modules-with-intellij-idea">Configuring Modules with IntelliJ IDEA</h2>
<p>Kotlin generate JavaScript code that is compatible with Asynchronous Module Definition (AMD), CommonJS and Universal Model Definition (UMD).</p>
<ul>
<li><strong>AMD</strong> is usually used on the client-side in the browser. The idea behind AMD is to load modules asynchronously, thus improving usability and performance.</li>
<li><strong>CommonJS</strong> is the module system used on the server-side, and in particular with node.js. Node modules all abide by this definition. CommonJS modules can also be used in the browser via <a href="http://browserify.org/">Browserify</a>.</li>
<li><strong>UMD</strong> tries to unify both models allowing these to be used either on the client or server.</li>
</ul>
<p>We can configure the Kotlin compiler option to use any of these. The last option (UMD) will generate UMD and fallback to the other options if one is not available.
Currently Kotlin compiler options are per IntelliJ IDEA project as opposed to a Kotlin module.</p>
<p><img alt="Kotlin Compiler Options" src="/assets/images/tutorials/javascript/working-with-modules/kotlin-compiler.png"/></p>
<h2 id="configuring-modules-when-using-maven-or-gradle">Configuring Modules when using Maven or Gradle</h2>
<p>If using Maven or Gradle, we can also configure the module output format. For more information see <a href="http://kotlinlang.org/docs/reference/js-modules.html">JavaScript Modules</a>.</p>
<h2 id="using-amd">Using AMD</h2>
<p>When using AMD, we set the compiler option to use AMD. Once we do that, we can then reference any modules that we've defined as if they were regular AMD ones.</p>
<p>For instance, given</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">class Customer(val id: Int, val name: String, val email: String) {
    var isPreferred = false
    fun makePreferred() {
        isPreferred = true
    }
}
</code></pre>
<p>the following JavaScript code will be generated</p>
<pre><code class="code _highlighted" data-lang="text/javascript">define('customerBL', ['kotlin'], function (Kotlin) {
  'use strict';
  var _ = Kotlin.defineRootPackage(null, /** @lends _ */ {
    Customer: Kotlin.createClass(null, function Customer(id, name, email) {
      this.id = id;
      this.name = name;
      this.email = email;
      this.isPreferred = false;
    }, /** @lends _.Customer.prototype */ {
      makePreferred: function () {
        this.isPreferred = true;
      }
    })
  });
  Kotlin.defineModule('customerBL', _);
  return _;
});
</code></pre>
<p>Assuming we have the following project layout</p>
<p><img alt="Project Structure AMD" src="/assets/images/tutorials/javascript/working-with-modules/project-structure-amd.png"/></p>
<p>we could define our <code>index.html</code> to load <code>require.js</code> along with <code>main.js</code> as the value of the <code>data-main</code> attribute</p>
<pre><code class="code _highlighted" data-lang="application/xml">&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Sample AMD&lt;/title&gt;
    &lt;script data-main="scripts/main"  src="scripts/require.js"&gt;&lt;/script&gt;
&lt;/head&gt;
</code></pre>
<p>The contents of our <code>main.js</code> would be:</p>
<pre><code class="code _highlighted" data-lang="text/javascript">requirejs.config({
    paths: {
        kotlin: 'out/lib/kotlin.js',
        customerBL: 'out/customerBL'
    }
});

requirejs(["customerBL"], function (customerBL) {
    console.log(customerBL)
});
</code></pre>
<p>With this, we can then access any of the functionality defined inside <code>customerBL</code>.</p>
<h2 id="using-commonjs">Using CommonJS</h2>
<p>In order to use Kotlin with node.js, we need to set the compiler option to use CommonJS. Once we do that, the output of the application
should be accessible using the node module system.</p>
<p>For instance, given</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">class Customer(val id: Int, val name: String, val email: String) {
    var isPreferred = false
    fun makePreferred() {
        isPreferred = true
    }
}
</code></pre>
<p>the following JavaScript code will be generated</p>
<pre><code class="code _highlighted" data-lang="text/javascript">module.exports = function (Kotlin) {
  'use strict';
  var _ = Kotlin.defineRootPackage(null, /** @lends _ */ {
    Customer: Kotlin.createClass(null, function Customer(id, name, email) {
      this.id = id;
      this.name = name;
      this.email = email;
      this.isPreferred = false;
    }, /** @lends _.Customer.prototype */ {
      makePreferred: function () {
        this.isPreferred = true;
      }
    })
  });
  Kotlin.defineModule('customerBL', _);
  return _;
}(require('kotlin'));

</code></pre>
<p>The last line is invoking the function itself and passing as argument <code>kotlin</code>, which refers to the standard library. This can be obtained in one of two ways:</p>
<p><em>Local reference</em></p>
<p>When compiling, the compiler always outputs the kotlin.js file. The easiest way to reference this without having to refer to paths, is to set the output library folder for the compiler options 
to <code>node_modules</code>. This way, Node will automatically pick it up as it does an exhaustive search for files under these folders</p>
<p><img alt="Node Modules" src="/assets/images/tutorials/javascript/working-with-modules/node-modules.png"/></p>
<p><em>NPM Directory</em></p>
<p>The Kotlin standard library is available on <a href="https://www.npmjs.com/">npm</a> and we can simply include it in our <code>package.json</code> as a dependency.</p>
<pre><code class="code _highlighted" data-lang="application/json">{
  "name": "node-demo",
  "description": "A sample of using Kotlin with node.js",
  "version": "0.0.1",
  "dependencies": {
    "kotlin": "&gt;=1.0.4-eap-111"
  }
}
</code></pre>
<p>We can simply refer to any class or member function inside our node.js code by simply importing the module using <code>require</code>:</p>
<pre><code class="code _highlighted" data-lang="text/javascript">

var customerBL = require('./scripts/customerBL')

var customer = new customerBL.Customer(1, "Jane Smith", "jane.smith@company.com")

console.dir(customer)
customer.makePreferred()
console.dir(customer)
</code></pre>
<p>In this case, we've set the output of our compilation to the <code>scripts</code> folder. On running the application we should see the following output:</p>
<p><img alt="Output CommonJS" src="/assets/images/tutorials/javascript/working-with-modules/output-commonjs.png"/></p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="terms-copyright">
                Licensed under the <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache 2 license</a>
            </div>

            <div class="terms-sponsor">
            Sponsored and developed by <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains" target="_blank">JetBrains</a>
            由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、<a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a> <a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
            </div>
        </div>
    </div>

</footer>
</body>
</html>