<html>
<head>
<meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5P98');</script>
<!-- End Google Tag Manager -->


<title>使用注释处理的 Android 框架 - Kotlin 语言中文站</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"/>
<link rel="apple-touch-icon" sizes="72x72"
      href="/assets/images/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="114x114"
      href="/assets/images/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="144x144"
      href="/assets/images/apple-touch-icon-144x144.png"/>
<link rel="stylesheet" href="/0_assets/styles.css">


<!-- Social Media tag Starts -->
<!-- Place this data between the <head> tags of your website -->
<!-- Open Graph data -->
<meta property="og:title" content="使用注释处理的 Android 框架 - Kotlin 语言中文站"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://www.kotlincn.net/docs/tutorials/android-frameworks.html"/>
<meta property="og:image" content="https://www.kotlincn.net/assets/images/open-graph/kotlin_250x250.png"/>
    <meta property="og:description" content="本教程介绍如何在 Kotlin 中使用依赖于注释处理的流行的 Android 框架和库。">
<meta property="og:site_name" content="Kotlin"/>

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kotlin">
<meta name="twitter:title" content="使用注释处理的 Android 框架 - Kotlin 语言中文站">
    <meta name="twitter:description" content="本教程介绍如何在 Kotlin 中使用依赖于注释处理的流行的 Android 框架和库。">
<meta name="twitter:image:src" content="https://www.kotlincn.net/assets/images/twitter-card/kotlin_800x320.png">
<!-- Social Media tag Ends -->
    <script src="/0_assets/default.js"></script>
    <script src="/0_assets/common.js"></script>
    <link rel="stylesheet" href="/0_assets/common.css"/>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="global-layout">

<header class="global-header">

    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>
<nav role="navigation" class="global-nav">

    <div class="nav-links">

            <a href="http://www.kotliner.cn/"
               class="nav-item "
            >
                博客
            </a>

            <a href="/docs/reference/"
               class="nav-item "
            >
                学习
            </a>

            <a href="/community/"
               class="nav-item "
            >
                社区
            </a>

            <a href="http://try.kotlinlang.org"
               class="nav-item "
            >
                在线试用
            </a>
    </div>


<div id="global-search" class=" global-search" title="Search">
    <div class="search-button">
        <div class="icon"></div>
    </div>
    <div class="search-box">
        <div class="gcse-searchbox-only"
             data-resultsUrl="/search.html"
             data-newWindow="false"
        ></div>
    </div>
</div></nav>        </div>
        <a class="conference-banner" href="https://kotlinconf.com/?utm_source=kotlinlang&utm_medium=web&utm_campaign=superearlybird">
            <div class="conference-banner__img"></div>
        </a>
    </div>

    <div class="g-layout">
    </div>
</header>
    <div class="g-layout global-content">

    <nav role="navigation" class="docs-nav">
            <div class="nav-item-wrap">
                    <a href="/docs/reference/" class="nav-item">
                    <span class="nav-item-text">
                        参考
                    </span>
                    </a>

            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/tutorials/" class="nav-item is_active">
                        <span class="nav-item-text">
                            教程
                        </span>
                    </a>
            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/books.html" class="nav-item">
                    <span class="nav-item-text">
                        书籍
                    </span>
                    </a>

            </div>
            <div class="nav-item-wrap">
                    <a href="/docs/resources.html" class="nav-item">
                    <span class="nav-item-text">
                        更多资源
                    </span>
                    </a>

            </div>
    </nav>

    <div class="g-grid">
        <aside class="g-3">
            <div class="js-side-tree-nav">
                    <nav role="navigation" class="side-tree-nav">
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="开始">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">开始</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/getting-started.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 IntelliJ IDEA 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/getting-started-eclipse.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Eclipse 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/command-line.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用命令行编译器</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/build-tools.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用构建工具</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/koans.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">心印</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _opened"
                 data-id="Android">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Android</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/kotlin-android.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Android 开发入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/android-plugin.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Kotlin Android 扩展</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active">
                                <div class="marker"></div>
                                <div class="text">Android 框架</div>
                            </div>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="Java 互操作">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Java 互操作</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/mixing-java-kotlin-intellij.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">在一个项目中混用 Java 和 Kotlin</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="JavaScript">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">JavaScript</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/kotlin-to-javascript/kotlin-to-javascript.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Kotlin 转 JavaScript</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-gradle/getting-started-with-gradle.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Gradle 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-idea/getting-started-with-intellij-idea.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 IntelliJ IDEA 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-maven/getting-started-with-maven.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">以 Maven 入门</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/getting-started-command-line/command-line-library-js.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">使用命令行编译器创建 Kotlin JavaScript 库</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/working-with-modules/working-with-modules.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">Kotlin 与 JavaScript 模块使用</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/javascript/working-with-javascript.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">与 JavaScript 合用</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="协程">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">协程</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/coroutines-basic-jvm.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">JVM 平台的 Kotlin 协程简介</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="Web 开发">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">Web 开发</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/httpservlets.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">用 Http Servlets 创建 web 应用</span>
                            </a>
                    </div>
                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/spring-boot-restful.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">用  Spring Boot 创建 RESTful Web 服务</span>
                            </a>
                    </div>

            </div>
            <div class="tree-item tree-branch js-item js-branch _closed"
                 data-id="工具">

                <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
                    <div class="marker"></div>
                    <div class="text">工具</div>
                </div>

                    <div class="tree-item tree-leaf js-item js-leaf">
                            <a href="/docs/tutorials/kotlin-and-ci.html"
                               class="tree-item-title tree-leaf-title js-item-title js-leaf-title"
                            >
                                <span class="marker"></span>
                                <span class="text">TeamCity 配置 Kotlin</span>
                            </a>
                    </div>

            </div>
    </nav>

            </div>
        </aside>

        <article role="main" class="page-content g-9">
<a href="https://github.com/hltj/kotlin-web-site-cn/edit/master/pages/docs/tutorials/android-frameworks.md"
   class="page-link-to-github"
   target="_blank"
   title="Edit this page on GitHub">
        <i class="github-icon"></i>
        <span class="text">Edit Page</span>
</a>
            <h1>
                使用注释处理的 Android 框架
            </h1>
            <table>
            </table>
                本教程介绍如何在 Kotlin 中使用依赖于注释处理的流行的 Android 框架和库。
                <br/>
                <br/>
            
<p>在日常 Android 开发中，流行着数以千计的框架帮助我们提升开发效率。
使用 Kotlin 开发时仍然可以沿用这些框架，而且和使用 Java 同样简单。
本章教程将提供相关示例并重点介绍配置的差异。</p>
<p>教程以 <a href="android-frameworks.html#dagger">Dagger</a>、 <a href="android-frameworks.html#butterknife">Butterknife</a>、 <a href="android-frameworks.html#data-binding">Data Binding</a>、 <a href="android-frameworks.html#auto-parcel">Auto-parcel</a> 以及 <a href="android-frameworks.html#dbflow">DBFlow</a> 为例（其它框架配置基本类似）。
以上框架均基于注解处理方式工作：通过对代码注解自动生成模板代码。
注解有助于减少冗余代码，让代码清晰可读，想要了解运行时的代码，可以直接阅读自动生成的源代码。
但所有生成的代码均为 Java 代码而非 Kotlin。</p>
<p>在 Kotlin 中添加依赖与 Java 中类似，仅需要使用 <a href="/docs/reference/kapt.html">Kotlin 注解处理工具（Kotlin Annotation processing tool）</a>（<code>kapt</code>）替代 <code>annotationProcessor</code> 即可。</p>
<h3 id="dagger">Dagger</h3>
<p><a href="https://google.github.io/dagger//">Dagger</a> 是著名的依赖注入框架。
如果对它还不了解，可以查阅<a href="https://google.github.io/dagger//users-guide.html">用户手册</a>。
我们已经将整个<a href="https://github.com/google/dagger/tree/master/examples/simple">咖啡示例</a> 
使用 Kotlin 重写，详细代码在<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/kotlin-dagger">这里</a>。 
Kotlin 代码与 Java 非常相似；所有示例代码可在同一个<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/kotlin-dagger/src/main/kotlin/Coffee.kt">文件</a>内查看。</p>
<p>与 Java 一样，Dagger 通过 <code>@Inject</code> 对构造函数注解，进而创建类的实例。
而 Kotlin 使用更简洁的语法同时声明属性和构造函数参数。
在 Kotlin 中对构造函数进行注解，必须显式使用 <code>constructor</code> 关键字，并在关键字前声明 <code>@Inject</code>。</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">class Thermosiphon 
@Inject constructor(
        private val heater: Heater
) : Pump {
    // ……
}    
</code></pre>
<p>注解方法看上去完全相同。
在下面的示例中，<code>@Binds</code> 决定了无论何时需要 <code>Pump</code>，使用都是 <code>Thermosiphon</code> 对象，<code>@Provides</code> 指定了 <code>Heater</code> 的构造方式，<code>@Singleton</code> 则表示 <code>Heater</code> 是全局单例：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@Module
abstract class PumpModule {
    @Binds
    abstract fun providePump(pump: Thermosiphon): Pump
}

@Module(includes = arrayOf(PumpModule::class))
class DripCoffeeModule {
    @Provides @Singleton
    fun provideHeater(): Heater = ElectricHeater()
}
</code></pre>
<p><code>@Module</code>-注解的类定义如何提供不同对象。
需要注意的是，作为多参数传递注解参数时，需要显示的使用 <code>arrayOf</code> 进行包装，比如上文示例中的 <code>@Module(includes = arrayOf(PumpModule::class))</code>。</p>
<p>使用 <code>@Component</code> 为类型生成依赖注入的实现。
自动生成类文件的类名带有 Dagger 前缀，比如下文示例 <code>DaggerCoffeeShop</code>：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@Singleton
@Component(modules = arrayOf(DripCoffeeModule::class))
interface CoffeeShop {
    fun maker(): CoffeeMaker
}

fun main(args: Array&lt;String&gt;) {
    val coffee = DaggerCoffeeShop.builder().build()
    coffee.maker().brew()
}
</code></pre>
<p>Dagger 为 <code>CoffeeShop</code> 所生成的实现，允许你获得一个完全注入的 <code>CoffeeMaker</code>。
<code>DaggerCoffeeShop</code> 的具体代码实现可在 IDE 中查看。</p>
<p>我们注意到转换到 Kotlin 时注解代码几乎没有发生改变。
接下来将介绍构建脚本(build script)中需要修改的部分。</p>
<p>在 Java 中需要指定 <code>Dagger</code> 作为 <code>annotationProcessor</code>（或 <code>apt</code>）依赖：</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">dependencies {
  ...
  annotationProcessor "com.google.dagger:dagger-compiler:$dagger-version"
}
</code></pre>
<p>在 Kotlin 中则需要添加 <code>kotlin-kapt</code> 插件激活 <code>kapt</code>，并使用 <code>kapt</code> 替换 <code>annotationProcessor</code>：</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">apply plugin: 'kotlin-kapt'
dependencies {
    ...
    kapt "com.google.dagger:dagger-compiler:$dagger-version"
}
</code></pre>
<p>就是这样。
特别提示：<code>kapt</code> 也能够处理 Java 文件，所以不需要再保留 <code>annotationProcessor</code> 的依赖。</p>
<p>查看示例项目的完整<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/kotlin-dagger/build.gradle">构建脚本</a>，
以及转换后的 <a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-dagger">Android 示例代码</a>。</p>
<h3 id="butterknife">ButterKnife</h3>
<p><a href="http://jakewharton.github.io/butterknife/">ButterKnife</a>可以直接将view和变量进行绑定从而免去调用<code>findViewById</code>。</p>
<p>另外，<a href="https://kotlinlang.org/docs/tutorials/android-plugin.html">Kotlin Android 扩展</a>插件（Android Studio 内置)具有同样的效果：使用简洁明了的代码替换<code>findViewByid</code>。
除非现在你正在使用 ButterKnife 而且没有迁移计划，那么前者非常值得尝试。</p>
<p>在 Kotlin 中使用 <code>ButterKnife</code> 与 Java 中完全一致。
在 Gradle 构建脚本的修改如下，后面将重点介绍代码部分的差异。</p>
<p>在 Gradle 依赖中添加 <code>kotlin-kapt</code> 插件，并使用 <code>kapt</code> 替代 <code>annotationProcessor</code>。</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">apply plugin: 'kotlin-kapt'

dependencies {
    ...
    compile "com.jakewharton:butterknife:$butterknife-version"
    kapt "com.jakewharton:butterknife-compiler:$butterknife-version"
}
</code></pre>
<p>我们已经将整个 ButterKnife <a href="https://github.com/JakeWharton/butterknife/tree/master/sample/app/src/main/java/com/example">示例代码</a>转换为 Kotlin，
参见<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-butterknife">详细代码</a>。</p>
<p>让我门看看发生了什么变化。
在 Java 中使用注解对将变量与之对应的 view 进行绑定：</p>
<pre><code class="code _highlighted" data-lang="text/x-java">@BindView(R2.id.title) TextView title;
</code></pre>
<p>在 Kotlin 中使用<a href="/docs/reference/properties.html">属性</a>而不是直接使用变量。
对属性使用注解:</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@BindView(R2.id.title)
lateinit var title: TextView
</code></pre>
<p><code>@BindView</code> 被定义为仅应用于变量字段，而将注解应用于整个属性时，Kotlin 编译器能够理解并且覆盖相应注解的字段。</p>
<p><a href="/docs/reference/properties.html#延迟初始化属性">lateinit 修饰符</a>允许声明非空类型，并在对象创建后(构造函数调用后)初始化。
不使用 <code>lateinit</code> 则需要声明<a href="/docs/reference/null-safety.html">可空类型</a>并且有额外的空安全检测操作。</p>
<p>使用 ButterKnife 注解可以将方法设置为监听器：</p>
<pre><code class="code _highlighted" data-lang="text/x-java">@OnClick(R2.id.hello)
internal fun sayHello() {
    Toast.makeText(this, "Hello, views!", LENGTH_SHORT).show()
}
</code></pre>
<p>以上代码表示点击“hello”按钮后的事件响应。
然而在 Kotlin 中使用 lambda 表达式会让代码更加简洁清晰：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">hello.setOnClickListener {
    toast("Hello, views!")
}
</code></pre>
<p><a href="https://github.com/Kotlin/anko">Anko</a> 库默认提供 <code>toast</code> 函数。</p>
<h3 id="data-binding">Data Binding</h3>
<p>使用 <a href="https://developer.android.com/topic/libraries/data-binding/index.html">Data Binding 开源库</a>能够让开发者以更简洁的方式将应用程序数据与布局界面进行绑定。</p>
<p>和使用 Java 一样，开发者需要在 gradle 文件中添加并激活配置。</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">android {
    ...
    dataBinding {
        enabled = true
    }
}
</code></pre>
<p>添加 <code>kapt</code> 的依赖后即可与 Kotlin 代码交互：</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">apply plugin: 'kotlin-kapt'
dependencies {
    kapt "com.android.databinding:compiler:$android_plugin_version"
}  
</code></pre>
<p>使用 Kotlin 并不需要修改任何的 xml 文件。
例如，在 <code>data</code> 中使用 <code>variable</code> 来描述可能在布局中使用的变量，
可以使用Kotlin类型声明变量：</p>
<pre><code class="code _highlighted" data-lang="application/xml">&lt;data&gt;
    &lt;variable name="data" type="org.example.kotlin.databinding.WeatherData"/&gt;
&lt;/data&gt;
</code></pre>
<p>现在，可以使用 <code>@{}</code> 语法引用 Kotlin 的<a href="/docs/reference/properties.html">属性</a>：</p>
<pre><code class="code _highlighted" data-lang="application/xml">&lt;ImageView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:src="@{data.imageUrl}"
    android:contentDescription="@string/image" /&gt;
</code></pre>
<p>值得一提的是，数据绑定表达式语言使用和 Kotlin 相同的语法对属性进行引用：<code>data.imageUrl</code>。
在 Kotlin 中可以使用 <code>v.prop</code> 来替代 <code>v.getProp()</code>，尽管 <code>getProp()</code> 是Java中的方法。
类似的，也可以直接向属性赋值，而不再需要调用setter。</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">class MainActivity : AppCompatActivity() {
    // ……
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        val binding: ActivityMainBinding =
                DataBindingUtil.setContentView(this, R.layout.activity_main)

        binding.data = weather
        // 等同于
        // binding.setData(weather)
    }
}
</code></pre>
<p>在 xml 中绑定监听器，并在运行事对相应操作进行响应：</p>
<pre><code class="code _highlighted" data-lang="application/xml">&lt;Button
    android:text="@string/next"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:onClick="startOtherActivity" /&gt;
</code></pre>
<p>例如在 <code>MainActivity</code> 中定义的 <code>startOtherActivity</code> 方法：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">class MainActivity : AppCompatActivity() {
    // ……
    fun startOtherActivity(view: View) = startActivity&lt;OtherActivity&gt;()
}
</code></pre>
<p>本例中使用的效用函数 <code>startActivity</code> 创建一个不带任何数据参数的 intent，并启动一个新的 activity，这些方法都来自于 <a href="https://github.com/Kotlin/anko">Anko</a> 库。
若需要添加参数，则调用 <code>startActivity&lt;OtherActivity&gt;("KEY" to "VALUE")</code>.</p>
<p>请注意，与其在 xml 中声明 lambda 表达式，不如直接使用代码绑定相关动作：</p>
<pre><code class="code _highlighted" data-lang="application/xml">&lt;Button 
    android:layout_width="wrap_content" 
    android:layout_height="wrap_content"
    android:onClick="@{() -&gt; presenter.onSaveClick(task)}" /&gt;
</code></pre>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">// 用 Kotlin 代码写的相同逻辑
button.setOnClickListener { presenter.onSaveClick(task) }
</code></pre>
<p>最后一行中 <code>button</code> 由 <code>id</code> 使用 <a href="https://kotlinlang.org/docs/tutorials/android-plugin.html">Kotlin Android 扩展</a>插件所引用。
使用该插件作为替代方案，既允许在代码中保持绑定逻辑，同时又具有简洁的语法。</p>
<p>查看<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-databinding">完整示例</a>。</p>
<h3 id="dbflow">DBFlow</h3>
<p><a href="https://github.com/Raizlabs/DBFlow">DBFlow</a> 是一个用于简化数据库交互的SQLite开源库。
它非常之依赖于注解处理。</p>
<p>使用 <code>kapt</code> 配置 Kotlin 依赖：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">apply plugin: 'kotlin-kapt'

dependencies {
    kapt "com.github.raizlabs.dbflow:dbflow-processor:$dbflow_version"
    compile "com.github.raizlabs.dbflow:dbflow-core:$dbflow_version"
    compile "com.github.raizlabs.dbflow:dbflow:$dbflow_version"
}
</code></pre>
<p>查看 DBFlow <a href="https://agrosner.gitbooks.io/dbflow/content/including-in-project.html">配置向导</a>。</p>
<p>若您的项目中已在使用 DBFlow，可以安全地将在项目中引入 Kotlin。
并且逐步地将代码转换为 Kotlin（确保每次编译通过）。
转换后的代码与 Java 并无明显差异。
例如，对表的声明和在 Java 中仅有小小的区别，属性声明时必须显示的指定默认值：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@Table(name="users", database = AppDatabase::class)
class User: BaseModel() {

    @PrimaryKey(autoincrement = true)
    @Column(name = "id")
    var id: Long = 0

    @Column
    var name: String? = null
}
</code></pre>
<p>对于 DBFlow 而言，除了将已经有功能代码转换为 Kotlin，还能享受到 Kotlin 的特别支持。
例如，将表声明为<a href="/docs/reference/data-classes.html">数据类</a>：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@Table(database = KotlinDatabase::class)
data class User(@PrimaryKey var id: Long = 0, @Column var name: String? = null)
</code></pre>
<p>DBFlow 定义了一系列符合 Kotlin 语言习惯的扩展功能，这些都可以通过依赖添加：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">dependencies {
    compile "com.github.raizlabs.dbflow:dbflow-kotlinextensions:$dbflow_version"
}
</code></pre>
<p>该扩展可以通过类似 C# 中的 LINQ 语法方式编写查询语句，使用 lambda 表达式可以编写更简单的异步计算代码。
详见<a href="https://agrosner.gitbooks.io/dbflow/content/KotlinSupport.html">此处</a>。</p>
<p>查看完整<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-dbflow">示例程序</a>。</p>
<h3 id="auto-parcel">Auto-Parcel</h3>
<p><a href="https://github.com/frankiesardo/auto-parcel">Auto-Parcel</a> 使用 <code>@AutoValue</code> 的注解为类文件自动生成 <code>Parcelable</code> 对应方法和值。</p>
<p>同样的，gradle 文件中也需要使用 <code>kapt</code> 作为注解处理器来处理 Kotlin 文件：</p>
<pre><code class="code _highlighted" data-lang="text/x-groovy">apply plugin: 'kotlin-kapt'

dependencies {
    ...
    kapt "frankiesardo:auto-parcel:$latest-version"
}
</code></pre>
<p>点击<a href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-auto-parcel">这里</a>查看<a href="https://github.com/frankiesardo/auto-parcel/tree/master/sample">完整示例代码</a>。</p>
<p>对 Kotlin 类文件添加 <code>@AutoValue</code> 注解。
下方的示例展示转换后的 <a href="https://github.com/frankiesardo/auto-parcel/blob/master/sample/src/main/java/model2/Address.java"><code>Address</code></a> 类以及自动生成相应的 <code>Parceable</code> 实现：</p>
<pre><code class="code _highlighted" data-lang="text/x-kotlin">@AutoValue
abstract class Address : Parcelable {
    abstract fun coordinates(): DoubleArray
    abstract fun cityName(): String

    companion object {
        fun create(coordinates: DoubleArray, cityName: String): Address {
            return builder().coordinates(coordinates).cityName(cityName).build()
        }
        
        fun builder(): Builder = `$AutoValue_Address`.Builder()
    }
    
    @AutoValue.Builder
    interface Builder {
        fun coordinates(x: DoubleArray): Builder
        fun cityName(x: String): Builder
        fun build(): Address
    }
}
</code></pre>
<p>由于 Kotlin 中没有 <code>static</code> 方法，因此相应的方法会在 <a href="/docs/reference/object-declarations.html#伴生对象"><code>companion object</code></a>中生成。
如果仍然需要从 Java 中调用这些方法，需要添加<a href="/docs/reference/java-to-kotlin-interop.html#访问静态成员"><code>@JvmStatic</code></a>注解。</p>
<p>如果调用 Java 的类或方法恰好在 Kotlin 中是保留字，可以使用反引号(`)作为<a href="/docs/reference/java-interop.html#将-kotlin-中是关键字的-java-标识符进行转义">转义字符</a>，比如调用上例中生成类的`<code>$AutoValue_Address</code>`。</p>
<p>以上所有经过转换的代码与原生 Java 代码非常相似。</p>

        </article>
    </div>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="terms-copyright">
                Licensed under the <a href="https://github.com/JetBrains/kotlin-web-site/blob/master/LICENSE">Apache 2 license</a>
            </div>

            <div class="terms-sponsor">
            Sponsored and developed by <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains" target="_blank">JetBrains</a>
            由<a href="https://hltj.me/" class="testimonial-company-link" target="_blank" rel="nofollow">灰蓝天际</a>、<a href="http://tanfujun.com" class="testimonial-company-link" target="_blank" rel="nofollow">晓_晨DEV</a> <a href="/contribute.html#中文站翻译贡献者" class="testimonial-company-link" target="_blank" rel="nofollow">等</a>译
            </div>
        </div>
    </div>

</footer>
</body>
</html>